<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="19">
  <HTTPTask id="21" hostname="10.100.22.24:8181" path="/signal/assets/plugin/dictionary/polymer.html" url="http://10.100.22.24:8181/signal/assets/plugin/dictionary/polymer.html" ip="10.100.22.24" port="8181" client_ip="10.202.2.49" client_port="58653" connectionId="2296" origin="Primary" encodingType="ANSI" startDateTime="2020-02-14T15:42:05.621+05:30" startTime="34762" endTime="35294" blockedTime="-1" dnsTime="-1" connectTime="-2" sendTime="258" waitTime="0" receiveTime="273" sslNegotiateTime="-1" responseBodySize="26406">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Referer" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovLzEwLjEwMC4yMi4yNDo4MTgxL3NpZ25hbC9hc3NldHMvcGx1Z2luL2RpY3Rpb25hcnkvY29sdW1uLXZpZXctNjRjMDA4NWM2MDg0NjRmNGE2ZjY2ZTMzZDk4NWFlMjcuaHRtbA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzc5LjAuMzk0NS4xMzAgU2FmYXJpLzUzNy4zNg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCxhcHBsaWNhdGlvbi9zaWduZWQtZXhjaGFuZ2U7dj1iMztxPTAuOQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTAuMTAwLjIyLjI0OjgxODE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>U0VTU0lPTj00OGNhMjRjZS1kNWUyLTQyMjQtODBhZi1lYWE2ZWU0NzFmZDQ7IGR0Q29va2llPXZfNF9zcnZfMV9zbl8zQTg3QzY0RDY5Nzg5QkIyN0MzRjhDRDA3MkU5RDc4RF9wZXJjXzEwMDAwMF9vbF8wX211bF8xOyByeFZpc2l0b3I9MTU4MTA1NDQyNzgxMEs2VkhBUkcwQU1USERQNjRQM09DQ0dCM0kyNTZTM01KOyBkdFBDPTEkNTQ1MzIzNTlfNzcwaDF2TUZCREZFTkVCR1VNSEtJS0NETEhDR0VJSU1KTVVDQ0M7IGR0U2E9dHJ1ZSU3Q0MlN0MtMSU3Q1JlcG9ydGluZyU3Qy0lN0MxNTgxMDU0NTY3MTY3JTdDNTQ1MzIzNTlfNzcwJTdDaHR0cCUzQSUyRiUyRjEwLjEwMC4yMi4yNCUzQTgxODElMkZzaWduYWwlMkYlN0NEYXNoYm9hcmQlN0MxNTgxMDU0NTQyNjUyJTdDJTdDOyBkdExhdEM9Mjsgcnh2dD0xNTgxMDU2MzMyMzcyfDE1ODEwNTQ0Mjc4MTQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9zaWduYWwvYXNzZXRzL3BsdWdpbi9kaWN0aW9uYXJ5L3BvbHltZXIuaHRtbCBIVFRQLzEuMQ0KUmVmZXJlcjogaHR0cDovLzEwLjEwMC4yMi4yNDo4MTgxL3NpZ25hbC9hc3NldHMvcGx1Z2luL2RpY3Rpb25hcnkvY29sdW1uLXZpZXctNjRjMDA4NWM2MDg0NjRmNGE2ZjY2ZTMzZDk4NWFlMjcuaHRtbA0KVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzc5LjAuMzk0NS4xMzAgU2FmYXJpLzUzNy4zNg0KQWNjZXB0LUVuY29kaW5nOiBnemlwLCBkZWZsYXRlDQpBY2NlcHQ6IHRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgsYXBwbGljYXRpb24vc2lnbmVkLWV4Y2hhbmdlO3Y9YjM7cT0wLjkNCkFjY2VwdC1MYW5ndWFnZTogZW4tVVMsZW47cT0wLjkNCkNvbm5lY3Rpb246IEtlZXAtQWxpdmUNCkhvc3Q6IDEwLjEwMC4yMi4yNDo4MTgxDQpDb29raWU6IFNFU1NJT049NDhjYTI0Y2UtZDVlMi00MjI0LTgwYWYtZWFhNmVlNDcxZmQ0OyBkdENvb2tpZT12XzRfc3J2XzFfc25fM0E4N0M2NEQ2OTc4OUJCMjdDM0Y4Q0QwNzJFOUQ3OERfcGVyY18xMDAwMDBfb2xfMF9tdWxfMTsgcnhWaXNpdG9yPTE1ODEwNTQ0Mjc4MTBLNlZIQVJHMEFNVEhEUDY0UDNPQ0NHQjNJMjU2UzNNSjsgZHRQQz0xJDU0NTMyMzU5Xzc3MGgxdk1GQkRGRU5FQkdVTUhLSUtDRExIQ0dFSUlNSk1VQ0NDOyBkdFNhPXRydWUlN0NDJTdDLTElN0NSZXBvcnRpbmclN0MtJTdDMTU4MTA1NDU2NzE2NyU3QzU0NTMyMzU5Xzc3MCU3Q2h0dHAlM0ElMkYlMkYxMC4xMDAuMjIuMjQlM0E4MTgxJTJGc2lnbmFsJTJGJTdDRGFzaGJvYXJkJTdDMTU4MTA1NDU0MjY1MiU3QyU3QzsgZHRMYXRDPTI7IHJ4dnQ9MTU4MTA1NjMzMjM3MnwxNTgxMDU0NDI3ODE0DQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="SESSION" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NDhjYTI0Y2UtZDVlMi00MjI0LTgwYWYtZWFhNmVlNDcxZmQ0</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="dtCookie" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dl80X3Nydl8xX3NuXzNBODdDNjRENjk3ODlCQjI3QzNGOENEMDcyRTlENzhEX3BlcmNfMTAwMDAwX29sXzBfbXVsXzE=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="rxVisitor" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTU4MTA1NDQyNzgxMEs2VkhBUkcwQU1USERQNjRQM09DQ0dCM0kyNTZTM01K</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="dtPC" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MSQ1NDUzMjM1OV83NzBoMXZNRkJERkVORUJHVU1IS0lLQ0RMSENHRUlJTUpNVUNDQw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="dtSa" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dHJ1ZSU3Q0MlN0MtMSU3Q1JlcG9ydGluZyU3Qy0lN0MxNTgxMDU0NTY3MTY3JTdDNTQ1MzIzNTlfNzcwJTdDaHR0cCUzQSUyRiUyRjEwLjEwMC4yMi4yNCUzQTgxODElMkZzaWduYWwlMkYlN0NEYXNoYm9hcmQlN0MxNTgxMDU0NTQyNjUyJTdDJTdD</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="dtLatC" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Mg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="rxvt" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTU4MTA1NjMzMjM3MnwxNTgxMDU0NDI3ODE0</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>0</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="X-OneAgent-JS-Injection" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dHJ1ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>InBsdWdpbi9kaWN0aW9uYXJ5L3BvbHltZXItZGQ4N2E1Y2YyNGI1OTM3YjcwZDBjM2MwNDY0ZDgyZTMuaHRtbDpkdGFnZW50MTAxODUyMDAyMTIwOTU2MThIUjVhIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAxMyBGZWIgMjAyMCAyMzo1Njo1NSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHVibGljLCBtYXgtYWdlPTMxNTM2MDAw</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Transfer-Encoding" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Y2h1bmtlZA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAxNCBGZWIgMjAyMCAxMDoxMjowNSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIA0KWC1PbmVBZ2VudC1KUy1JbmplY3Rpb246IHRydWUNCkVUYWc6ICJwbHVnaW4vZGljdGlvbmFyeS9wb2x5bWVyLWRkODdhNWNmMjRiNTkzN2I3MGQwYzNjMDQ2NGQ4MmUzLmh0bWw6ZHRhZ2VudDEwMTg1MjAwMjEyMDk1NjE4SFI1YSINCkxhc3QtTW9kaWZpZWQ6IFRodSwgMTMgRmViIDIwMjAgMjM6NTY6NTUgR01UDQpWYXJ5OiBBY2NlcHQtRW5jb2RpbmcNCkNhY2hlLUNvbnRyb2w6IHB1YmxpYywgbWF4LWFnZT0zMTUzNjAwMA0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KQ29udGVudC1UeXBlOiB0ZXh0L2h0bWw7Y2hhcnNldD1VVEYtOA0KVHJhbnNmZXItRW5jb2Rpbmc6IGNodW5rZWQNCkRhdGU6IEZyaSwgMTQgRmViIDIwMjAgMTA6MTI6MDUgR01UDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>PCEtLQpAbGljZW5zZQpDb3B5cmlnaHQgKGMpIDIwMTUgVGhlIFBvbHltZXIgUHJvamVjdCBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgpUaGlzIGNvZGUgbWF5IG9ubHkgYmUgdXNlZCB1bmRlciB0aGUgQlNEIHN0eWxlIGxpY2Vuc2UgZm91bmQgYXQgaHR0cDovL3BvbHltZXIuZ2l0aHViLmlvL0xJQ0VOU0UudHh0ClRoZSBjb21wbGV0ZSBzZXQgb2YgYXV0aG9ycyBtYXkgYmUgZm91bmQgYXQgaHR0cDovL3BvbHltZXIuZ2l0aHViLmlvL0FVVEhPUlMudHh0ClRoZSBjb21wbGV0ZSBzZXQgb2YgY29udHJpYnV0b3JzIG1heSBiZSBmb3VuZCBhdCBodHRwOi8vcG9seW1lci5naXRodWIuaW8vQ09OVFJJQlVUT1JTLnR4dApDb2RlIGRpc3RyaWJ1dGVkIGJ5IEdvb2dsZSBhcyBwYXJ0IG9mIHRoZSBwb2x5bWVyIHByb2plY3QgaXMgYWxzbwpzdWJqZWN0IHRvIGFuIGFkZGl0aW9uYWwgSVAgcmlnaHRzIGdyYW50IGZvdW5kIGF0IGh0dHA6Ly9wb2x5bWVyLmdpdGh1Yi5pby9QQVRFTlRTLnR4dAotLT48IS0tCkBsaWNlbnNlCkNvcHlyaWdodCAoYykgMjAxNCBUaGUgUG9seW1lciBQcm9qZWN0IEF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuClRoaXMgY29kZSBtYXkgb25seSBiZSB1c2VkIHVuZGVyIHRoZSBCU0Qgc3R5bGUgbGljZW5zZSBmb3VuZCBhdCBodHRwOi8vcG9seW1lci5naXRodWIuaW8vTElDRU5TRS50eHQKVGhlIGNvbXBsZXRlIHNldCBvZiBhdXRob3JzIG1heSBiZSBmb3VuZCBhdCBodHRwOi8vcG9seW1lci5naXRodWIuaW8vQVVUSE9SUy50eHQKVGhlIGNvbXBsZXRlIHNldCBvZiBjb250cmlidXRvcnMgbWF5IGJlIGZvdW5kIGF0IGh0dHA6Ly9wb2x5bWVyLmdpdGh1Yi5pby9DT05UUklCVVRPUlMudHh0CkNvZGUgZGlzdHJpYnV0ZWQgYnkgR29vZ2xlIGFzIHBhcnQgb2YgdGhlIHBvbHltZXIgcHJvamVjdCBpcyBhbHNvCnN1YmplY3QgdG8gYW4gYWRkaXRpb25hbCBJUCByaWdodHMgZ3JhbnQgZm91bmQgYXQgaHR0cDovL3BvbHltZXIuZ2l0aHViLmlvL1BBVEVOVFMudHh0Ci0tPjxsaW5rIHJlbD0iaW1wb3J0IiBocmVmPSJwb2x5bWVyLW1pbmkuaHRtbCI+Cgo8c2NyaXB0PlBvbHltZXIubmFyID0gW107ClBvbHltZXIuQW5ub3RhdGlvbnMgPSB7CnBhcnNlQW5ub3RhdGlvbnM6IGZ1bmN0aW9uICh0ZW1wbGF0ZSkgewp2YXIgbGlzdCA9IFtdOwp2YXIgY29udGVudCA9IHRlbXBsYXRlLl9jb250ZW50IHx8IHRlbXBsYXRlLmNvbnRlbnQ7CnRoaXMuX3BhcnNlTm9kZUFubm90YXRpb25zKGNvbnRlbnQsIGxpc3QpOwpyZXR1cm4gbGlzdDsKfSwKX3BhcnNlTm9kZUFubm90YXRpb25zOiBmdW5jdGlvbiAobm9kZSwgbGlzdCkgewpyZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUgPyB0aGlzLl9wYXJzZVRleHROb2RlQW5ub3RhdGlvbihub2RlLCBsaXN0KSA6IHRoaXMuX3BhcnNlRWxlbWVudEFubm90YXRpb25zKG5vZGUsIGxpc3QpOwp9LApfdGVzdEVzY2FwZTogZnVuY3Rpb24gKHZhbHVlKSB7CnZhciBlc2NhcGUgPSB2YWx1ZS5zbGljZSgwLCAyKTsKaWYgKGVzY2FwZSA9PT0gJ3t7JyB8fCBlc2NhcGUgPT09ICdbWycpIHsKcmV0dXJuIGVzY2FwZTsKfQp9LApfcGFyc2VUZXh0Tm9kZUFubm90YXRpb246IGZ1bmN0aW9uIChub2RlLCBsaXN0KSB7CnZhciB2ID0gbm9kZS50ZXh0Q29udGVudDsKdmFyIGVzY2FwZSA9IHRoaXMuX3Rlc3RFc2NhcGUodik7CmlmIChlc2NhcGUpIHsKbm9kZS50ZXh0Q29udGVudCA9ICcgJzsKdmFyIGFubm90ZSA9IHsKYmluZGluZ3M6IFt7CmtpbmQ6ICd0ZXh0JywKbW9kZTogZXNjYXBlWzBdLAp2YWx1ZTogdi5zbGljZSgyLCAtMikudHJpbSgpCn1dCn07Cmxpc3QucHVzaChhbm5vdGUpOwpyZXR1cm4gYW5ub3RlOwp9Cn0sCl9wYXJzZUVsZW1lbnRBbm5vdGF0aW9uczogZnVuY3Rpb24gKGVsZW1lbnQsIGxpc3QpIHsKdmFyIGFubm90ZSA9IHsKYmluZGluZ3M6IFtdLApldmVudHM6IFtdCn07CmlmIChlbGVtZW50LmxvY2FsTmFtZSA9PT0gJ2NvbnRlbnQnKSB7Cmxpc3QuX2hhc0NvbnRlbnQgPSB0cnVlOwp9CnRoaXMuX3BhcnNlQ2hpbGROb2Rlc0Fubm90YXRpb25zKGVsZW1lbnQsIGFubm90ZSwgbGlzdCk7CmlmIChlbGVtZW50LmF0dHJpYnV0ZXMpIHsKdGhpcy5fcGFyc2VOb2RlQXR0cmlidXRlQW5ub3RhdGlvbnMoZWxlbWVudCwgYW5ub3RlLCBsaXN0KTsKaWYgKHRoaXMucHJlcEVsZW1lbnQpIHsKdGhpcy5wcmVwRWxlbWVudChlbGVtZW50KTsKfQp9CmlmIChhbm5vdGUuYmluZGluZ3MubGVuZ3RoIHx8IGFubm90ZS5ldmVudHMubGVuZ3RoIHx8IGFubm90ZS5pZCkgewpsaXN0LnB1c2goYW5ub3RlKTsKfQpyZXR1cm4gYW5ub3RlOwp9LApfcGFyc2VDaGlsZE5vZGVzQW5ub3RhdGlvbnM6IGZ1bmN0aW9uIChyb290LCBhbm5vdGUsIGxpc3QsIGNhbGxiYWNrKSB7CmlmIChyb290LmZpcnN0Q2hpbGQpIHsKZm9yICh2YXIgaSA9IDAsIG5vZGUgPSByb290LmZpcnN0Q2hpbGQ7IG5vZGU7IG5vZGUgPSBub2RlLm5leHRTaWJsaW5nLCBpKyspIHsKaWYgKG5vZGUubG9jYWxOYW1lID09PSAndGVtcGxhdGUnICYmICFub2RlLmhhc0F0dHJpYnV0ZSgncHJlc2VydmUtY29udGVudCcpKSB7CnRoaXMuX3BhcnNlVGVtcGxhdGUobm9kZSwgaSwgbGlzdCwgYW5ub3RlKTsKfQppZiAobm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUpIHsKdmFyIG4gPSBub2RlLm5leHRTaWJsaW5nOwp3aGlsZSAobiAmJiBuLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSkgewpub2RlLnRleHRDb250ZW50ICs9IG4udGV4dENvbnRlbnQ7CnJvb3QucmVtb3ZlQ2hpbGQobik7Cm4gPSBuLm5leHRTaWJsaW5nOwp9Cn0KdmFyIGNoaWxkQW5ub3RhdGlvbiA9IHRoaXMuX3BhcnNlTm9kZUFubm90YXRpb25zKG5vZGUsIGxpc3QsIGNhbGxiYWNrKTsKaWYgKGNoaWxkQW5ub3RhdGlvbikgewpjaGlsZEFubm90YXRpb24ucGFyZW50ID0gYW5ub3RlOwpjaGlsZEFubm90YXRpb24uaW5kZXggPSBpOwp9Cn0KfQp9LApfcGFyc2VUZW1wbGF0ZTogZnVuY3Rpb24gKG5vZGUsIGluZGV4LCBsaXN0LCBwYXJlbnQpIHsKdmFyIGNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CmNvbnRlbnQuX25vdGVzID0gdGhpcy5wYXJzZUFubm90YXRpb25zKG5vZGUpOwpjb250ZW50LmFwcGVuZENoaWxkKG5vZGUuY29udGVudCk7Cmxpc3QucHVzaCh7CmJpbmRpbmdzOiBQb2x5bWVyLm5hciwKZXZlbnRzOiBQb2x5bWVyLm5hciwKdGVtcGxhdGVDb250ZW50OiBjb250ZW50LApwYXJlbnQ6IHBhcmVudCwKaW5kZXg6IGluZGV4Cn0pOwp9LApfcGFyc2VOb2RlQXR0cmlidXRlQW5ub3RhdGlvbnM6IGZ1bmN0aW9uIChub2RlLCBhbm5vdGF0aW9uKSB7CmZvciAodmFyIGkgPSBub2RlLmF0dHJpYnV0ZXMubGVuZ3RoIC0gMSwgYTsgYSA9IG5vZGUuYXR0cmlidXRlc1tpXTsgaS0tKSB7CnZhciBuID0gYS5uYW1lLCB2ID0gYS52YWx1ZTsKaWYgKG4gPT09ICdpZCcgJiYgIXRoaXMuX3Rlc3RFc2NhcGUodikpIHsKYW5ub3RhdGlvbi5pZCA9IHY7Cn0gZWxzZSBpZiAobi5zbGljZSgwLCAzKSA9PT0gJ29uLScpIHsKbm9kZS5yZW1vdmVBdHRyaWJ1dGUobik7CmFubm90YXRpb24uZXZlbnRzLnB1c2goewpuYW1lOiBuLnNsaWNlKDMpLAp2YWx1ZTogdgp9KTsKfSBlbHNlIHsKdmFyIGIgPSB0aGlzLl9wYXJzZU5vZGVBdHRyaWJ1dGVBbm5vdGF0aW9uKG5vZGUsIG4sIHYpOwppZiAoYikgewphbm5vdGF0aW9uLmJpbmRpbmdzLnB1c2goYik7Cn0KfQp9Cn0sCl9wYXJzZU5vZGVBdHRyaWJ1dGVBbm5vdGF0aW9uOiBmdW5jdGlvbiAobm9kZSwgbiwgdikgewp2YXIgZXNjYXBlID0gdGhpcy5fdGVzdEVzY2FwZSh2KTsKaWYgKGVzY2FwZSkgewp2YXIgY3VzdG9tRXZlbnQ7CnZhciBuYW1lID0gbjsKdmFyIG1vZGUgPSBlc2NhcGVbMF07CnYgPSB2LnNsaWNlKDIsIC0yKS50cmltKCk7CnZhciBub3QgPSBmYWxzZTsKaWYgKHZbMF0gPT0gJyEnKSB7CnYgPSB2LnN1YnN0cmluZygxKTsKbm90ID0gdHJ1ZTsKfQp2YXIga2luZCA9ICdwcm9wZXJ0eSc7CmlmIChuW24ubGVuZ3RoIC0gMV0gPT0gJyQnKSB7Cm5hbWUgPSBuLnNsaWNlKDAsIC0xKTsKa2luZCA9ICdhdHRyaWJ1dGUnOwp9CnZhciBub3RpZnlFdmVudCwgY29sb247CmlmIChtb2RlID09ICd7JyAmJiAoY29sb24gPSB2LmluZGV4T2YoJzo6JykpID4gMCkgewpub3RpZnlFdmVudCA9IHYuc3Vic3RyaW5nKGNvbG9uICsgMik7CnYgPSB2LnN1YnN0cmluZygwLCBjb2xvbik7CmN1c3RvbUV2ZW50ID0gdHJ1ZTsKfQppZiAobm9kZS5sb2NhbE5hbWUgPT0gJ2lucHV0JyAmJiBuID09ICd2YWx1ZScpIHsKbm9kZS5zZXRBdHRyaWJ1dGUobiwgJycpOwp9Cm5vZGUucmVtb3ZlQXR0cmlidXRlKG4pOwppZiAoa2luZCA9PT0gJ3Byb3BlcnR5JykgewpuYW1lID0gUG9seW1lci5DYXNlTWFwLmRhc2hUb0NhbWVsQ2FzZShuYW1lKTsKfQpyZXR1cm4gewpraW5kOiBraW5kLAptb2RlOiBtb2RlLApuYW1lOiBuYW1lLAp2YWx1ZTogdiwKbmVnYXRlOiBub3QsCmV2ZW50OiBub3RpZnlFdmVudCwKY3VzdG9tRXZlbnQ6IGN1c3RvbUV2ZW50Cn07Cn0KfSwKX2xvY2FsU3ViVHJlZTogZnVuY3Rpb24gKG5vZGUsIGhvc3QpIHsKcmV0dXJuIG5vZGUgPT09IGhvc3QgPyBub2RlLmNoaWxkTm9kZXMgOiBub2RlLl9saWdodENoaWxkcmVuIHx8IG5vZGUuY2hpbGROb2RlczsKfSwKZmluZEFubm90YXRlZE5vZGU6IGZ1bmN0aW9uIChyb290LCBhbm5vdGUpIHsKdmFyIHBhcmVudCA9IGFubm90ZS5wYXJlbnQgJiYgUG9seW1lci5Bbm5vdGF0aW9ucy5maW5kQW5ub3RhdGVkTm9kZShyb290LCBhbm5vdGUucGFyZW50KTsKcmV0dXJuICFwYXJlbnQgPyByb290IDogUG9seW1lci5Bbm5vdGF0aW9ucy5fbG9jYWxTdWJUcmVlKHBhcmVudCwgcm9vdClbYW5ub3RlLmluZGV4XTsKfQp9OwooZnVuY3Rpb24gKCkgewpmdW5jdGlvbiByZXNvbHZlQ3NzKGNzc1RleHQsIG93bmVyRG9jdW1lbnQpIHsKcmV0dXJuIGNzc1RleHQucmVwbGFjZShDU1NfVVJMX1JYLCBmdW5jdGlvbiAobSwgcHJlLCB1cmwsIHBvc3QpIHsKcmV0dXJuIHByZSArICdcJycgKyByZXNvbHZlKHVybC5yZXBsYWNlKC9bIiddL2csICcnKSwgb3duZXJEb2N1bWVudCkgKyAnXCcnICsgcG9zdDsKfSk7Cn0KZnVuY3Rpb24gcmVzb2x2ZUF0dHJzKGVsZW1lbnQsIG93bmVyRG9jdW1lbnQpIHsKZm9yICh2YXIgbmFtZSBpbiBVUkxfQVRUUlMpIHsKdmFyIGEkID0gVVJMX0FUVFJTW25hbWVdOwpmb3IgKHZhciBpID0gMCwgbCA9IGEkLmxlbmd0aCwgYSwgYXQsIHY7IGkgPCBsICYmIChhID0gYSRbaV0pOyBpKyspIHsKaWYgKG5hbWUgPT09ICcqJyB8fCBlbGVtZW50LmxvY2FsTmFtZSA9PT0gbmFtZSkgewphdCA9IGVsZW1lbnQuYXR0cmlidXRlc1thXTsKdiA9IGF0ICYmIGF0LnZhbHVlOwppZiAodiAmJiB2LnNlYXJjaChCSU5ESU5HX1JYKSA8IDApIHsKYXQudmFsdWUgPSBhID09PSAnc3R5bGUnID8gcmVzb2x2ZUNzcyh2LCBvd25lckRvY3VtZW50KSA6IHJlc29sdmUodiwgb3duZXJEb2N1bWVudCk7Cn0KfQp9Cn0KfQpmdW5jdGlvbiByZXNvbHZlKHVybCwgb3duZXJEb2N1bWVudCkgewppZiAodXJsICYmIHVybFswXSA9PT0gJy4uL2RpY3Rpb25hcnktZDQxZDhjZDk4ZjAwYjIwNGU5ODAwOTk4ZWNmODQyN2UubnVsbCcpIHsKcmV0dXJuIHVybDsKfQp2YXIgcmVzb2x2ZXIgPSBnZXRVcmxSZXNvbHZlcihvd25lckRvY3VtZW50KTsKcmVzb2x2ZXIuaHJlZiA9IHVybDsKcmV0dXJuIHJlc29sdmVyLmhyZWYgfHwgdXJsOwp9CnZhciB0ZW1wRG9jOwp2YXIgdGVtcERvY0Jhc2U7CmZ1bmN0aW9uIHJlc29sdmVVcmwodXJsLCBiYXNlVXJpKSB7CmlmICghdGVtcERvYykgewp0ZW1wRG9jID0gZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCd0ZW1wJyk7CnRlbXBEb2NCYXNlID0gdGVtcERvYy5jcmVhdGVFbGVtZW50KCdiYXNlJyk7CnRlbXBEb2MuaGVhZC5hcHBlbmRDaGlsZCh0ZW1wRG9jQmFzZSk7Cn0KdGVtcERvY0Jhc2UuaHJlZiA9IGJhc2VVcmk7CnJldHVybiByZXNvbHZlKHVybCwgdGVtcERvYyk7Cn0KZnVuY3Rpb24gZ2V0VXJsUmVzb2x2ZXIob3duZXJEb2N1bWVudCkgewpyZXR1cm4gb3duZXJEb2N1bWVudC5fX3VybFJlc29sdmVyIHx8IChvd25lckRvY3VtZW50Ll9fdXJsUmVzb2x2ZXIgPSBvd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKSk7Cn0KdmFyIENTU19VUkxfUlggPSAvKHVybFwoKShbXildKikoXCkpL2c7CnZhciBVUkxfQVRUUlMgPSB7CicqJzogWwonaHJlZicsCidzcmMnLAonc3R5bGUnLAondXJsJwpdLApmb3JtOiBbJ2FjdGlvbiddCn07CnZhciBCSU5ESU5HX1JYID0gL1x7XHt8XFtcWy87ClBvbHltZXIuUmVzb2x2ZVVybCA9IHsKcmVzb2x2ZUNzczogcmVzb2x2ZUNzcywKcmVzb2x2ZUF0dHJzOiByZXNvbHZlQXR0cnMsCnJlc29sdmVVcmw6IHJlc29sdmVVcmwKfTsKfSgpKTsKUG9seW1lci5CYXNlLl9hZGRGZWF0dXJlKHsKX3ByZXBBbm5vdGF0aW9uczogZnVuY3Rpb24gKCkgewppZiAoIXRoaXMuX3RlbXBsYXRlKSB7CnRoaXMuX25vdGVzID0gW107Cn0gZWxzZSB7ClBvbHltZXIuQW5ub3RhdGlvbnMucHJlcEVsZW1lbnQgPSB0aGlzLl9wcmVwRWxlbWVudC5iaW5kKHRoaXMpOwppZiAodGhpcy5fdGVtcGxhdGUuX2NvbnRlbnQgJiYgdGhpcy5fdGVtcGxhdGUuX2NvbnRlbnQuX25vdGVzKSB7CnRoaXMuX25vdGVzID0gdGhpcy5fdGVtcGxhdGUuX2NvbnRlbnQuX25vdGVzOwp9IGVsc2Ugewp0aGlzLl9ub3RlcyA9IFBvbHltZXIuQW5ub3RhdGlvbnMucGFyc2VBbm5vdGF0aW9ucyh0aGlzLl90ZW1wbGF0ZSk7Cn0KdGhpcy5fcHJvY2Vzc0Fubm90YXRpb25zKHRoaXMuX25vdGVzKTsKUG9seW1lci5Bbm5vdGF0aW9ucy5wcmVwRWxlbWVudCA9IG51bGw7Cn0KfSwKX3Byb2Nlc3NBbm5vdGF0aW9uczogZnVuY3Rpb24gKG5vdGVzKSB7CmZvciAodmFyIGkgPSAwOyBpIDwgbm90ZXMubGVuZ3RoOyBpKyspIHsKdmFyIG5vdGUgPSBub3Rlc1tpXTsKZm9yICh2YXIgaiA9IDA7IGogPCBub3RlLmJpbmRpbmdzLmxlbmd0aDsgaisrKSB7CnZhciBiID0gbm90ZS5iaW5kaW5nc1tqXTsKYi5zaWduYXR1cmUgPSB0aGlzLl9wYXJzZU1ldGhvZChiLnZhbHVlKTsKaWYgKCFiLnNpZ25hdHVyZSkgewpiLm1vZGVsID0gdGhpcy5fbW9kZWxGb3JQYXRoKGIudmFsdWUpOwp9Cn0KaWYgKG5vdGUudGVtcGxhdGVDb250ZW50KSB7CnRoaXMuX3Byb2Nlc3NBbm5vdGF0aW9ucyhub3RlLnRlbXBsYXRlQ29udGVudC5fbm90ZXMpOwp2YXIgcHAgPSBub3RlLnRlbXBsYXRlQ29udGVudC5fcGFyZW50UHJvcHMgPSB0aGlzLl9kaXNjb3ZlclRlbXBsYXRlUGFyZW50UHJvcHMobm90ZS50ZW1wbGF0ZUNvbnRlbnQuX25vdGVzKTsKdmFyIGJpbmRpbmdzID0gW107CmZvciAodmFyIHByb3AgaW4gcHApIHsKYmluZGluZ3MucHVzaCh7CmluZGV4OiBub3RlLmluZGV4LApraW5kOiAncHJvcGVydHknLAptb2RlOiAneycsCm5hbWU6ICdfcGFyZW50XycgKyBwcm9wLAptb2RlbDogcHJvcCwKdmFsdWU6IHByb3AKfSk7Cn0Kbm90ZS5iaW5kaW5ncyA9IG5vdGUuYmluZGluZ3MuY29uY2F0KGJpbmRpbmdzKTsKfQp9Cn0sCl9kaXNjb3ZlclRlbXBsYXRlUGFyZW50UHJvcHM6IGZ1bmN0aW9uIChub3Rlcykgewp2YXIgcHAgPSB7fTsKbm90ZXMuZm9yRWFjaChmdW5jdGlvbiAobikgewpuLmJpbmRpbmdzLmZvckVhY2goZnVuY3Rpb24gKGIpIHsKaWYgKGIuc2lnbmF0dXJlKSB7CnZhciBhcmdzID0gYi5zaWduYXR1cmUuYXJnczsKZm9yICh2YXIgayA9IDA7IGsgPCBhcmdzLmxlbmd0aDsgaysrKSB7CnBwW2FyZ3Nba10ubW9kZWxdID0gdHJ1ZTsKfQp9IGVsc2UgewpwcFtiLm1vZGVsXSA9IHRydWU7Cn0KfSk7CmlmIChuLnRlbXBsYXRlQ29udGVudCkgewp2YXIgdHBwID0gbi50ZW1wbGF0ZUNvbnRlbnQuX3BhcmVudFByb3BzOwpQb2x5bWVyLkJhc2UubWl4aW4ocHAsIHRwcCk7Cn0KfSk7CnJldHVybiBwcDsKfSwKX3ByZXBFbGVtZW50OiBmdW5jdGlvbiAoZWxlbWVudCkgewpQb2x5bWVyLlJlc29sdmVVcmwucmVzb2x2ZUF0dHJzKGVsZW1lbnQsIHRoaXMuX3RlbXBsYXRlLm93bmVyRG9jdW1lbnQpOwp9LApfZmluZEFubm90YXRlZE5vZGU6IFBvbHltZXIuQW5ub3RhdGlvbnMuZmluZEFubm90YXRlZE5vZGUsCl9tYXJzaGFsQW5ub3RhdGlvblJlZmVyZW5jZXM6IGZ1bmN0aW9uICgpIHsKaWYgKHRoaXMuX3RlbXBsYXRlKSB7CnRoaXMuX21hcnNoYWxJZE5vZGVzKCk7CnRoaXMuX21hcnNoYWxBbm5vdGF0ZWROb2RlcygpOwp0aGlzLl9tYXJzaGFsQW5ub3RhdGVkTGlzdGVuZXJzKCk7Cn0KfSwKX2NvbmZpZ3VyZUFubm90YXRpb25SZWZlcmVuY2VzOiBmdW5jdGlvbiAoKSB7CnRoaXMuX2NvbmZpZ3VyZVRlbXBsYXRlQ29udGVudCgpOwp9LApfY29uZmlndXJlVGVtcGxhdGVDb250ZW50OiBmdW5jdGlvbiAoKSB7CnRoaXMuX25vdGVzLmZvckVhY2goZnVuY3Rpb24gKG5vdGUsIGkpIHsKaWYgKG5vdGUudGVtcGxhdGVDb250ZW50KSB7CnRoaXMuX25vZGVzW2ldLl9jb250ZW50ID0gbm90ZS50ZW1wbGF0ZUNvbnRlbnQ7Cn0KfSwgdGhpcyk7Cn0sCl9tYXJzaGFsSWROb2RlczogZnVuY3Rpb24gKCkgewp0aGlzLiQgPSB7fTsKdGhpcy5fbm90ZXMuZm9yRWFjaChmdW5jdGlvbiAoYSkgewppZiAoYS5pZCkgewp0aGlzLiRbYS5pZF0gPSB0aGlzLl9maW5kQW5ub3RhdGVkTm9kZSh0aGlzLnJvb3QsIGEpOwp9Cn0sIHRoaXMpOwp9LApfbWFyc2hhbEFubm90YXRlZE5vZGVzOiBmdW5jdGlvbiAoKSB7CmlmICh0aGlzLl9ub2Rlcykgewp0aGlzLl9ub2RlcyA9IHRoaXMuX25vZGVzLm1hcChmdW5jdGlvbiAoYSkgewpyZXR1cm4gdGhpcy5fZmluZEFubm90YXRlZE5vZGUodGhpcy5yb290LCBhKTsKfSwgdGhpcyk7Cn0KfSwKX21hcnNoYWxBbm5vdGF0ZWRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsKdGhpcy5fbm90ZXMuZm9yRWFjaChmdW5jdGlvbiAoYSkgewppZiAoYS5ldmVudHMgJiYgYS5ldmVudHMubGVuZ3RoKSB7CnZhciBub2RlID0gdGhpcy5fZmluZEFubm90YXRlZE5vZGUodGhpcy5yb290LCBhKTsKYS5ldmVudHMuZm9yRWFjaChmdW5jdGlvbiAoZSkgewp0aGlzLmxpc3Rlbihub2RlLCBlLm5hbWUsIGUudmFsdWUpOwp9LCB0aGlzKTsKfQp9LCB0aGlzKTsKfQp9KTsKUG9seW1lci5CYXNlLl9hZGRGZWF0dXJlKHsKbGlzdGVuZXJzOiB7fSwKX2xpc3Rlbkxpc3RlbmVyczogZnVuY3Rpb24gKGxpc3RlbmVycykgewp2YXIgbm9kZSwgbmFtZSwga2V5Owpmb3IgKGtleSBpbiBsaXN0ZW5lcnMpIHsKaWYgKGtleS5pbmRleE9mKCcuLi9kaWN0aW9uYXJ5LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlLm51bGwnKSA8IDApIHsKbm9kZSA9IHRoaXM7Cm5hbWUgPSBrZXk7Cn0gZWxzZSB7Cm5hbWUgPSBrZXkuc3BsaXQoJy4uL2RpY3Rpb25hcnktZDQxZDhjZDk4ZjAwYjIwNGU5ODAwOTk4ZWNmODQyN2UubnVsbCcpOwpub2RlID0gdGhpcy4kW25hbWVbMF1dOwpuYW1lID0gbmFtZVsxXTsKfQp0aGlzLmxpc3Rlbihub2RlLCBuYW1lLCBsaXN0ZW5lcnNba2V5XSk7Cn0KfSwKbGlzdGVuOiBmdW5jdGlvbiAobm9kZSwgZXZlbnROYW1lLCBtZXRob2ROYW1lKSB7CnZhciBoYW5kbGVyID0gdGhpcy5fcmVjYWxsRXZlbnRIYW5kbGVyKHRoaXMsIGV2ZW50TmFtZSwgbm9kZSwgbWV0aG9kTmFtZSk7CmlmICghaGFuZGxlcikgewpoYW5kbGVyID0gdGhpcy5fY3JlYXRlRXZlbnRIYW5kbGVyKG5vZGUsIGV2ZW50TmFtZSwgbWV0aG9kTmFtZSk7Cn0KaWYgKGhhbmRsZXIuX2xpc3RlbmluZykgewpyZXR1cm47Cn0KdGhpcy5fbGlzdGVuKG5vZGUsIGV2ZW50TmFtZSwgaGFuZGxlcik7CmhhbmRsZXIuX2xpc3RlbmluZyA9IHRydWU7Cn0sCl9ib3VuZExpc3RlbmVyS2V5OiBmdW5jdGlvbiAoZXZlbnROYW1lLCBtZXRob2ROYW1lKSB7CnJldHVybiBldmVudE5hbWUgKyAnOicgKyBtZXRob2ROYW1lOwp9LApfcmVjb3JkRXZlbnRIYW5kbGVyOiBmdW5jdGlvbiAoaG9zdCwgZXZlbnROYW1lLCB0YXJnZXQsIG1ldGhvZE5hbWUsIGhhbmRsZXIpIHsKdmFyIGhibCA9IGhvc3QuX19ib3VuZExpc3RlbmVyczsKaWYgKCFoYmwpIHsKaGJsID0gaG9zdC5fX2JvdW5kTGlzdGVuZXJzID0gbmV3IFdlYWtNYXAoKTsKfQp2YXIgYmwgPSBoYmwuZ2V0KHRhcmdldCk7CmlmICghYmwpIHsKYmwgPSB7fTsKaGJsLnNldCh0YXJnZXQsIGJsKTsKfQp2YXIga2V5ID0gdGhpcy5fYm91bmRMaXN0ZW5lcktleShldmVudE5hbWUsIG1ldGhvZE5hbWUpOwpibFtrZXldID0gaGFuZGxlcjsKfSwKX3JlY2FsbEV2ZW50SGFuZGxlcjogZnVuY3Rpb24gKGhvc3QsIGV2ZW50TmFtZSwgdGFyZ2V0LCBtZXRob2ROYW1lKSB7CnZhciBoYmwgPSBob3N0Ll9fYm91bmRMaXN0ZW5lcnM7CmlmICghaGJsKSB7CnJldHVybjsKfQp2YXIgYmwgPSBoYmwuZ2V0KHRhcmdldCk7CmlmICghYmwpIHsKcmV0dXJuOwp9CnZhciBrZXkgPSB0aGlzLl9ib3VuZExpc3RlbmVyS2V5KGV2ZW50TmFtZSwgbWV0aG9kTmFtZSk7CnJldHVybiBibFtrZXldOwp9LApfY3JlYXRlRXZlbnRIYW5kbGVyOiBmdW5jdGlvbiAobm9kZSwgZXZlbnROYW1lLCBtZXRob2ROYW1lKSB7CnZhciBob3N0ID0gdGhpczsKdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiAoZSkgewppZiAoaG9zdFttZXRob2ROYW1lXSkgewpob3N0W21ldGhvZE5hbWVdKGUsIGUuZGV0YWlsKTsKfSBlbHNlIHsKaG9zdC5fd2Fybihob3N0Ll9sb2dmKCdfY3JlYXRlRXZlbnRIYW5kbGVyJywgJ2xpc3RlbmVyIG1ldGhvZCBgJyArIG1ldGhvZE5hbWUgKyAnYCBub3QgZGVmaW5lZCcpKTsKfQp9OwpoYW5kbGVyLl9saXN0ZW5pbmcgPSBmYWxzZTsKdGhpcy5fcmVjb3JkRXZlbnRIYW5kbGVyKGhvc3QsIGV2ZW50TmFtZSwgbm9kZSwgbWV0aG9kTmFtZSwgaGFuZGxlcik7CnJldHVybiBoYW5kbGVyOwp9LAp1bmxpc3RlbjogZnVuY3Rpb24gKG5vZGUsIGV2ZW50TmFtZSwgbWV0aG9kTmFtZSkgewp2YXIgaGFuZGxlciA9IHRoaXMuX3JlY2FsbEV2ZW50SGFuZGxlcih0aGlzLCBldmVudE5hbWUsIG5vZGUsIG1ldGhvZE5hbWUpOwppZiAoaGFuZGxlcikgewp0aGlzLl91bmxpc3Rlbihub2RlLCBldmVudE5hbWUsIGhhbmRsZXIpOwpoYW5kbGVyLl9saXN0ZW5pbmcgPSBmYWxzZTsKfQp9LApfbGlzdGVuOiBmdW5jdGlvbiAobm9kZSwgZXZlbnROYW1lLCBoYW5kbGVyKSB7Cm5vZGUuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhhbmRsZXIpOwp9LApfdW5saXN0ZW46IGZ1bmN0aW9uIChub2RlLCBldmVudE5hbWUsIGhhbmRsZXIpIHsKbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGFuZGxlcik7Cn0KfSk7CihmdW5jdGlvbiAoKSB7Cid1c2Ugc3RyaWN0JzsKdmFyIEhBU19OQVRJVkVfVEEgPSB0eXBlb2YgZG9jdW1lbnQuaGVhZC5zdHlsZS50b3VjaEFjdGlvbiA9PT0gJ3N0cmluZyc7CnZhciBHRVNUVVJFX0tFWSA9ICdfX3BvbHltZXJHZXN0dXJlcyc7CnZhciBIQU5ETEVEX09CSiA9ICdfX3BvbHltZXJHZXN0dXJlc0hhbmRsZWQnOwp2YXIgVE9VQ0hfQUNUSU9OID0gJ19fcG9seW1lckdlc3R1cmVzVG91Y2hBY3Rpb24nOwp2YXIgVEFQX0RJU1RBTkNFID0gMjU7CnZhciBUUkFDS19ESVNUQU5DRSA9IDU7CnZhciBUUkFDS19MRU5HVEggPSAyOwp2YXIgTU9VU0VfVElNRU9VVCA9IDI1MDA7CnZhciBNT1VTRV9FVkVOVFMgPSBbCidtb3VzZWRvd24nLAonbW91c2Vtb3ZlJywKJ21vdXNldXAnLAonY2xpY2snCl07CnZhciBNT1VTRV9XSElDSF9UT19CVVRUT05TID0gWwowLAoxLAo0LAoyCl07CnZhciBNT1VTRV9IQVNfQlVUVE9OUyA9IGZ1bmN0aW9uICgpIHsKdHJ5IHsKcmV0dXJuIG5ldyBNb3VzZUV2ZW50KCd0ZXN0JywgeyBidXR0b25zOiAxIH0pLmJ1dHRvbnMgPT09IDE7Cn0gY2F0Y2ggKGUpIHsKcmV0dXJuIGZhbHNlOwp9Cn0oKTsKdmFyIElTX1RPVUNIX09OTFkgPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9pUCg/OltvYV1kfGhvbmUpfEFuZHJvaWQvKTsKdmFyIG1vdXNlQ2FuY2VsbGVyID0gZnVuY3Rpb24gKG1vdXNlRXZlbnQpIHsKbW91c2VFdmVudFtIQU5ETEVEX09CSl0gPSB7IHNraXA6IHRydWUgfTsKaWYgKG1vdXNlRXZlbnQudHlwZSA9PT0gJ2NsaWNrJykgewp2YXIgcGF0aCA9IFBvbHltZXIuZG9tKG1vdXNlRXZlbnQpLnBhdGg7CmZvciAodmFyIGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykgewppZiAocGF0aFtpXSA9PT0gUE9JTlRFUlNUQVRFLm1vdXNlLnRhcmdldCkgewpyZXR1cm47Cn0KfQptb3VzZUV2ZW50LnByZXZlbnREZWZhdWx0KCk7Cm1vdXNlRXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7Cn0KfTsKZnVuY3Rpb24gc2V0dXBUZWFyZG93bk1vdXNlQ2FuY2VsbGVyKHNldHVwKSB7CmZvciAodmFyIGkgPSAwLCBlbjsgaSA8IE1PVVNFX0VWRU5UUy5sZW5ndGg7IGkrKykgewplbiA9IE1PVVNFX0VWRU5UU1tpXTsKaWYgKHNldHVwKSB7CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoZW4sIG1vdXNlQ2FuY2VsbGVyLCB0cnVlKTsKfSBlbHNlIHsKZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihlbiwgbW91c2VDYW5jZWxsZXIsIHRydWUpOwp9Cn0KfQpmdW5jdGlvbiBpZ25vcmVNb3VzZSgpIHsKaWYgKElTX1RPVUNIX09OTFkpIHsKcmV0dXJuOwp9CmlmICghUE9JTlRFUlNUQVRFLm1vdXNlLm1vdXNlSWdub3JlSm9iKSB7CnNldHVwVGVhcmRvd25Nb3VzZUNhbmNlbGxlcih0cnVlKTsKfQp2YXIgdW5zZXQgPSBmdW5jdGlvbiAoKSB7CnNldHVwVGVhcmRvd25Nb3VzZUNhbmNlbGxlcigpOwpQT0lOVEVSU1RBVEUubW91c2UudGFyZ2V0ID0gbnVsbDsKUE9JTlRFUlNUQVRFLm1vdXNlLm1vdXNlSWdub3JlSm9iID0gbnVsbDsKfTsKUE9JTlRFUlNUQVRFLm1vdXNlLm1vdXNlSWdub3JlSm9iID0gUG9seW1lci5EZWJvdW5jZShQT0lOVEVSU1RBVEUubW91c2UubW91c2VJZ25vcmVKb2IsIHVuc2V0LCBNT1VTRV9USU1FT1VUKTsKfQpmdW5jdGlvbiBoYXNMZWZ0TW91c2VCdXR0b24oZXYpIHsKdmFyIHR5cGUgPSBldi50eXBlOwppZiAoTU9VU0VfRVZFTlRTLmluZGV4T2YodHlwZSkgPT09IC0xKSB7CnJldHVybiBmYWxzZTsKfQppZiAodHlwZSA9PT0gJ21vdXNlbW92ZScpIHsKdmFyIGJ1dHRvbnMgPSBldi5idXR0b25zID09PSB1bmRlZmluZWQgPyAxIDogZXYuYnV0dG9uczsKaWYgKGV2IGluc3RhbmNlb2Ygd2luZG93Lk1vdXNlRXZlbnQgJiYgIU1PVVNFX0hBU19CVVRUT05TKSB7CmJ1dHRvbnMgPSBNT1VTRV9XSElDSF9UT19CVVRUT05TW2V2LndoaWNoXSB8fCAwOwp9CnJldHVybiBCb29sZWFuKGJ1dHRvbnMgJiAxKTsKfSBlbHNlIHsKdmFyIGJ1dHRvbiA9IGV2LmJ1dHRvbiA9PT0gdW5kZWZpbmVkID8gMCA6IGV2LmJ1dHRvbjsKcmV0dXJuIGJ1dHRvbiA9PT0gMDsKfQp9CmZ1bmN0aW9uIGlzU3ludGhldGljQ2xpY2soZXYpIHsKaWYgKGV2LnR5cGUgPT09ICdjbGljaycpIHsKaWYgKGV2LmRldGFpbCA9PT0gMCkgewpyZXR1cm4gdHJ1ZTsKfQp2YXIgdCA9IEdlc3R1cmVzLmZpbmRPcmlnaW5hbFRhcmdldChldik7CnZhciBiY3IgPSB0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwp2YXIgeCA9IGV2LnBhZ2VYLCB5ID0gZXYucGFnZVk7CnJldHVybiAhKHggPj0gYmNyLmxlZnQgJiYgeCA8PSBiY3IucmlnaHQgJiYgKHkgPj0gYmNyLnRvcCAmJiB5IDw9IGJjci5ib3R0b20pKTsKfQpyZXR1cm4gZmFsc2U7Cn0KdmFyIFBPSU5URVJTVEFURSA9IHsKbW91c2U6IHsKdGFyZ2V0OiBudWxsLAptb3VzZUlnbm9yZUpvYjogbnVsbAp9LAp0b3VjaDogewp4OiAwLAp5OiAwLAppZDogLTEsCnNjcm9sbERlY2lkZWQ6IGZhbHNlCn0KfTsKZnVuY3Rpb24gZmlyc3RUb3VjaEFjdGlvbihldikgewp2YXIgcGF0aCA9IFBvbHltZXIuZG9tKGV2KS5wYXRoOwp2YXIgdGEgPSAnYXV0byc7CmZvciAodmFyIGkgPSAwLCBuOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykgewpuID0gcGF0aFtpXTsKaWYgKG5bVE9VQ0hfQUNUSU9OXSkgewp0YSA9IG5bVE9VQ0hfQUNUSU9OXTsKYnJlYWs7Cn0KfQpyZXR1cm4gdGE7Cn0KZnVuY3Rpb24gdHJhY2tEb2N1bWVudChzdGF0ZU9iaiwgbW92ZWZuLCB1cGZuKSB7CnN0YXRlT2JqLm1vdmVmbiA9IG1vdmVmbjsKc3RhdGVPYmoudXBmbiA9IHVwZm47CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG1vdmVmbik7CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB1cGZuKTsKfQpmdW5jdGlvbiB1bnRyYWNrRG9jdW1lbnQoc3RhdGVPYmopIHsKZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgc3RhdGVPYmoubW92ZWZuKTsKZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHN0YXRlT2JqLnVwZm4pOwp9CnZhciBHZXN0dXJlcyA9IHsKZ2VzdHVyZXM6IHt9LApyZWNvZ25pemVyczogW10sCmRlZXBUYXJnZXRGaW5kOiBmdW5jdGlvbiAoeCwgeSkgewp2YXIgbm9kZSA9IGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQoeCwgeSk7CnZhciBuZXh0ID0gbm9kZTsKd2hpbGUgKG5leHQgJiYgbmV4dC5zaGFkb3dSb290KSB7Cm5leHQgPSBuZXh0LnNoYWRvd1Jvb3QuZWxlbWVudEZyb21Qb2ludCh4LCB5KTsKaWYgKG5leHQpIHsKbm9kZSA9IG5leHQ7Cn0KfQpyZXR1cm4gbm9kZTsKfSwKZmluZE9yaWdpbmFsVGFyZ2V0OiBmdW5jdGlvbiAoZXYpIHsKaWYgKGV2LnBhdGgpIHsKcmV0dXJuIGV2LnBhdGhbMF07Cn0KcmV0dXJuIGV2LnRhcmdldDsKfSwKaGFuZGxlTmF0aXZlOiBmdW5jdGlvbiAoZXYpIHsKdmFyIGhhbmRsZWQ7CnZhciB0eXBlID0gZXYudHlwZTsKdmFyIG5vZGUgPSBldi5jdXJyZW50VGFyZ2V0Owp2YXIgZ29iaiA9IG5vZGVbR0VTVFVSRV9LRVldOwp2YXIgZ3MgPSBnb2JqW3R5cGVdOwppZiAoIWdzKSB7CnJldHVybjsKfQppZiAoIWV2W0hBTkRMRURfT0JKXSkgewpldltIQU5ETEVEX09CSl0gPSB7fTsKaWYgKHR5cGUuc2xpY2UoMCwgNSkgPT09ICd0b3VjaCcpIHsKdmFyIHQgPSBldi5jaGFuZ2VkVG91Y2hlc1swXTsKaWYgKHR5cGUgPT09ICd0b3VjaHN0YXJ0JykgewppZiAoZXYudG91Y2hlcy5sZW5ndGggPT09IDEpIHsKUE9JTlRFUlNUQVRFLnRvdWNoLmlkID0gdC5pZGVudGlmaWVyOwp9Cn0KaWYgKFBPSU5URVJTVEFURS50b3VjaC5pZCAhPT0gdC5pZGVudGlmaWVyKSB7CnJldHVybjsKfQppZiAoIUhBU19OQVRJVkVfVEEpIHsKaWYgKHR5cGUgPT09ICd0b3VjaHN0YXJ0JyB8fCB0eXBlID09PSAndG91Y2htb3ZlJykgewpHZXN0dXJlcy5oYW5kbGVUb3VjaEFjdGlvbihldik7Cn0KfQppZiAodHlwZSA9PT0gJ3RvdWNoZW5kJykgewpQT0lOVEVSU1RBVEUubW91c2UudGFyZ2V0ID0gUG9seW1lci5kb20oZXYpLnJvb3RUYXJnZXQ7Cmlnbm9yZU1vdXNlKHRydWUpOwp9Cn0KfQpoYW5kbGVkID0gZXZbSEFORExFRF9PQkpdOwppZiAoaGFuZGxlZC5za2lwKSB7CnJldHVybjsKfQp2YXIgcmVjb2duaXplcnMgPSBHZXN0dXJlcy5yZWNvZ25pemVyczsKZm9yICh2YXIgaSA9IDAsIHI7IGkgPCByZWNvZ25pemVycy5sZW5ndGg7IGkrKykgewpyID0gcmVjb2duaXplcnNbaV07CmlmIChnc1tyLm5hbWVdICYmICFoYW5kbGVkW3IubmFtZV0pIHsKaWYgKHIuZmxvdyAmJiByLmZsb3cuc3RhcnQuaW5kZXhPZihldi50eXBlKSA+IC0xKSB7CmlmIChyLnJlc2V0KSB7CnIucmVzZXQoKTsKfQp9Cn0KfQpmb3IgKHZhciBpID0gMCwgcjsgaSA8IHJlY29nbml6ZXJzLmxlbmd0aDsgaSsrKSB7CnIgPSByZWNvZ25pemVyc1tpXTsKaWYgKGdzW3IubmFtZV0gJiYgIWhhbmRsZWRbci5uYW1lXSkgewpoYW5kbGVkW3IubmFtZV0gPSB0cnVlOwpyW3R5cGVdKGV2KTsKfQp9Cn0sCmhhbmRsZVRvdWNoQWN0aW9uOiBmdW5jdGlvbiAoZXYpIHsKdmFyIHQgPSBldi5jaGFuZ2VkVG91Y2hlc1swXTsKdmFyIHR5cGUgPSBldi50eXBlOwppZiAodHlwZSA9PT0gJ3RvdWNoc3RhcnQnKSB7ClBPSU5URVJTVEFURS50b3VjaC54ID0gdC5jbGllbnRYOwpQT0lOVEVSU1RBVEUudG91Y2gueSA9IHQuY2xpZW50WTsKUE9JTlRFUlNUQVRFLnRvdWNoLnNjcm9sbERlY2lkZWQgPSBmYWxzZTsKfSBlbHNlIGlmICh0eXBlID09PSAndG91Y2htb3ZlJykgewppZiAoUE9JTlRFUlNUQVRFLnRvdWNoLnNjcm9sbERlY2lkZWQpIHsKcmV0dXJuOwp9ClBPSU5URVJTVEFURS50b3VjaC5zY3JvbGxEZWNpZGVkID0gdHJ1ZTsKdmFyIHRhID0gZmlyc3RUb3VjaEFjdGlvbihldik7CnZhciBwcmV2ZW50ID0gZmFsc2U7CnZhciBkeCA9IE1hdGguYWJzKFBPSU5URVJTVEFURS50b3VjaC54IC0gdC5jbGllbnRYKTsKdmFyIGR5ID0gTWF0aC5hYnMoUE9JTlRFUlNUQVRFLnRvdWNoLnkgLSB0LmNsaWVudFkpOwppZiAoIWV2LmNhbmNlbGFibGUpIHsKfSBlbHNlIGlmICh0YSA9PT0gJ25vbmUnKSB7CnByZXZlbnQgPSB0cnVlOwp9IGVsc2UgaWYgKHRhID09PSAncGFuLXgnKSB7CnByZXZlbnQgPSBkeSA+IGR4Owp9IGVsc2UgaWYgKHRhID09PSAncGFuLXknKSB7CnByZXZlbnQgPSBkeCA+IGR5Owp9CmlmIChwcmV2ZW50KSB7CmV2LnByZXZlbnREZWZhdWx0KCk7Cn0gZWxzZSB7Ckdlc3R1cmVzLnByZXZlbnQoJ3RyYWNrJyk7Cn0KfQp9LAphZGQ6IGZ1bmN0aW9uIChub2RlLCBldlR5cGUsIGhhbmRsZXIpIHsKdmFyIHJlY29nbml6ZXIgPSB0aGlzLmdlc3R1cmVzW2V2VHlwZV07CnZhciBkZXBzID0gcmVjb2duaXplci5kZXBzOwp2YXIgbmFtZSA9IHJlY29nbml6ZXIubmFtZTsKdmFyIGdvYmogPSBub2RlW0dFU1RVUkVfS0VZXTsKaWYgKCFnb2JqKSB7Cm5vZGVbR0VTVFVSRV9LRVldID0gZ29iaiA9IHt9Owp9CmZvciAodmFyIGkgPSAwLCBkZXAsIGdkOyBpIDwgZGVwcy5sZW5ndGg7IGkrKykgewpkZXAgPSBkZXBzW2ldOwppZiAoSVNfVE9VQ0hfT05MWSAmJiBNT1VTRV9FVkVOVFMuaW5kZXhPZihkZXApID4gLTEpIHsKY29udGludWU7Cn0KZ2QgPSBnb2JqW2RlcF07CmlmICghZ2QpIHsKZ29ialtkZXBdID0gZ2QgPSB7IF9jb3VudDogMCB9Owp9CmlmIChnZC5fY291bnQgPT09IDApIHsKbm9kZS5hZGRFdmVudExpc3RlbmVyKGRlcCwgdGhpcy5oYW5kbGVOYXRpdmUpOwp9CmdkW25hbWVdID0gKGdkW25hbWVdIHx8IDApICsgMTsKZ2QuX2NvdW50ID0gKGdkLl9jb3VudCB8fCAwKSArIDE7Cn0Kbm9kZS5hZGRFdmVudExpc3RlbmVyKGV2VHlwZSwgaGFuZGxlcik7CmlmIChyZWNvZ25pemVyLnRvdWNoQWN0aW9uKSB7CnRoaXMuc2V0VG91Y2hBY3Rpb24obm9kZSwgcmVjb2duaXplci50b3VjaEFjdGlvbik7Cn0KfSwKcmVtb3ZlOiBmdW5jdGlvbiAobm9kZSwgZXZUeXBlLCBoYW5kbGVyKSB7CnZhciByZWNvZ25pemVyID0gdGhpcy5nZXN0dXJlc1tldlR5cGVdOwp2YXIgZGVwcyA9IHJlY29nbml6ZXIuZGVwczsKdmFyIG5hbWUgPSByZWNvZ25pemVyLm5hbWU7CnZhciBnb2JqID0gbm9kZVtHRVNUVVJFX0tFWV07CmlmIChnb2JqKSB7CmZvciAodmFyIGkgPSAwLCBkZXAsIGdkOyBpIDwgZGVwcy5sZW5ndGg7IGkrKykgewpkZXAgPSBkZXBzW2ldOwpnZCA9IGdvYmpbZGVwXTsKaWYgKGdkICYmIGdkW25hbWVdKSB7CmdkW25hbWVdID0gKGdkW25hbWVdIHx8IDEpIC0gMTsKZ2QuX2NvdW50ID0gKGdkLl9jb3VudCB8fCAxKSAtIDE7CmlmIChnZC5fY291bnQgPT09IDApIHsKbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKGRlcCwgdGhpcy5oYW5kbGVOYXRpdmUpOwp9Cn0KfQp9Cm5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihldlR5cGUsIGhhbmRsZXIpOwp9LApyZWdpc3RlcjogZnVuY3Rpb24gKHJlY29nKSB7CnRoaXMucmVjb2duaXplcnMucHVzaChyZWNvZyk7CmZvciAodmFyIGkgPSAwOyBpIDwgcmVjb2cuZW1pdHMubGVuZ3RoOyBpKyspIHsKdGhpcy5nZXN0dXJlc1tyZWNvZy5lbWl0c1tpXV0gPSByZWNvZzsKfQp9LApmaW5kUmVjb2duaXplckJ5RXZlbnQ6IGZ1bmN0aW9uIChldk5hbWUpIHsKZm9yICh2YXIgaSA9IDAsIHI7IGkgPCB0aGlzLnJlY29nbml6ZXJzLmxlbmd0aDsgaSsrKSB7CnIgPSB0aGlzLnJlY29nbml6ZXJzW2ldOwpmb3IgKHZhciBqID0gMCwgbjsgaiA8IHIuZW1pdHMubGVuZ3RoOyBqKyspIHsKbiA9IHIuZW1pdHNbal07CmlmIChuID09PSBldk5hbWUpIHsKcmV0dXJuIHI7Cn0KfQp9CnJldHVybiBudWxsOwp9LApzZXRUb3VjaEFjdGlvbjogZnVuY3Rpb24gKG5vZGUsIHZhbHVlKSB7CmlmIChIQVNfTkFUSVZFX1RBKSB7Cm5vZGUuc3R5bGUudG91Y2hBY3Rpb24gPSB2YWx1ZTsKfQpub2RlW1RPVUNIX0FDVElPTl0gPSB2YWx1ZTsKfSwKZmlyZTogZnVuY3Rpb24gKHRhcmdldCwgdHlwZSwgZGV0YWlsKSB7CnZhciBldiA9IFBvbHltZXIuQmFzZS5maXJlKHR5cGUsIGRldGFpbCwgewpub2RlOiB0YXJnZXQsCmJ1YmJsZXM6IHRydWUsCmNhbmNlbGFibGU6IHRydWUKfSk7CmlmIChldi5kZWZhdWx0UHJldmVudGVkKSB7CnZhciBzZSA9IGRldGFpbC5zb3VyY2VFdmVudDsKaWYgKHNlICYmIHNlLnByZXZlbnREZWZhdWx0KSB7CnNlLnByZXZlbnREZWZhdWx0KCk7Cn0KfQp9LApwcmV2ZW50OiBmdW5jdGlvbiAoZXZOYW1lKSB7CnZhciByZWNvZ25pemVyID0gdGhpcy5maW5kUmVjb2duaXplckJ5RXZlbnQoZXZOYW1lKTsKaWYgKHJlY29nbml6ZXIuaW5mbykgewpyZWNvZ25pemVyLmluZm8ucHJldmVudCA9IHRydWU7Cn0KfQp9OwpHZXN0dXJlcy5yZWdpc3Rlcih7Cm5hbWU6ICdkb3dudXAnLApkZXBzOiBbCidtb3VzZWRvd24nLAondG91Y2hzdGFydCcsCid0b3VjaGVuZCcKXSwKZmxvdzogewpzdGFydDogWwonbW91c2Vkb3duJywKJ3RvdWNoc3RhcnQnCl0sCmVuZDogWwonbW91c2V1cCcsCid0b3VjaGVuZCcKXQp9LAplbWl0czogWwonZG93bicsCid1cCcKXSwKaW5mbzogewptb3ZlZm46IGZ1bmN0aW9uICgpIHsKfSwKdXBmbjogZnVuY3Rpb24gKCkgewp9Cn0sCnJlc2V0OiBmdW5jdGlvbiAoKSB7CnVudHJhY2tEb2N1bWVudCh0aGlzLmluZm8pOwp9LAptb3VzZWRvd246IGZ1bmN0aW9uIChlKSB7CmlmICghaGFzTGVmdE1vdXNlQnV0dG9uKGUpKSB7CnJldHVybjsKfQp2YXIgdCA9IEdlc3R1cmVzLmZpbmRPcmlnaW5hbFRhcmdldChlKTsKdmFyIHNlbGYgPSB0aGlzOwp2YXIgbW92ZWZuID0gZnVuY3Rpb24gbW92ZWZuKGUpIHsKaWYgKCFoYXNMZWZ0TW91c2VCdXR0b24oZSkpIHsKc2VsZi5maXJlKCd1cCcsIHQsIGUpOwp1bnRyYWNrRG9jdW1lbnQoc2VsZi5pbmZvKTsKfQp9Owp2YXIgdXBmbiA9IGZ1bmN0aW9uIHVwZm4oZSkgewppZiAoaGFzTGVmdE1vdXNlQnV0dG9uKGUpKSB7CnNlbGYuZmlyZSgndXAnLCB0LCBlKTsKfQp1bnRyYWNrRG9jdW1lbnQoc2VsZi5pbmZvKTsKfTsKdHJhY2tEb2N1bWVudCh0aGlzLmluZm8sIG1vdmVmbiwgdXBmbik7CnRoaXMuZmlyZSgnZG93bicsIHQsIGUpOwp9LAp0b3VjaHN0YXJ0OiBmdW5jdGlvbiAoZSkgewp0aGlzLmZpcmUoJ2Rvd24nLCBHZXN0dXJlcy5maW5kT3JpZ2luYWxUYXJnZXQoZSksIGUuY2hhbmdlZFRvdWNoZXNbMF0pOwp9LAp0b3VjaGVuZDogZnVuY3Rpb24gKGUpIHsKdGhpcy5maXJlKCd1cCcsIEdlc3R1cmVzLmZpbmRPcmlnaW5hbFRhcmdldChlKSwgZS5jaGFuZ2VkVG91Y2hlc1swXSk7Cn0sCmZpcmU6IGZ1bmN0aW9uICh0eXBlLCB0YXJnZXQsIGV2ZW50KSB7CnZhciBzZWxmID0gdGhpczsKR2VzdHVyZXMuZmlyZSh0YXJnZXQsIHR5cGUsIHsKeDogZXZlbnQuY2xpZW50WCwKeTogZXZlbnQuY2xpZW50WSwKc291cmNlRXZlbnQ6IGV2ZW50LApwcmV2ZW50OiBHZXN0dXJlcy5wcmV2ZW50LmJpbmQoR2VzdHVyZXMpCn0pOwp9Cn0pOwpHZXN0dXJlcy5yZWdpc3Rlcih7Cm5hbWU6ICd0cmFjaycsCnRvdWNoQWN0aW9uOiAnbm9uZScsCmRlcHM6IFsKJ21vdXNlZG93bicsCid0b3VjaHN0YXJ0JywKJ3RvdWNobW92ZScsCid0b3VjaGVuZCcKXSwKZmxvdzogewpzdGFydDogWwonbW91c2Vkb3duJywKJ3RvdWNoc3RhcnQnCl0sCmVuZDogWwonbW91c2V1cCcsCid0b3VjaGVuZCcKXQp9LAplbWl0czogWyd0cmFjayddLAppbmZvOiB7Cng6IDAsCnk6IDAsCnN0YXRlOiAnc3RhcnQnLApzdGFydGVkOiBmYWxzZSwKbW92ZXM6IFtdLAphZGRNb3ZlOiBmdW5jdGlvbiAobW92ZSkgewppZiAodGhpcy5tb3Zlcy5sZW5ndGggPiBUUkFDS19MRU5HVEgpIHsKdGhpcy5tb3Zlcy5zaGlmdCgpOwp9CnRoaXMubW92ZXMucHVzaChtb3ZlKTsKfSwKbW92ZWZuOiBmdW5jdGlvbiAoKSB7Cn0sCnVwZm46IGZ1bmN0aW9uICgpIHsKfSwKcHJldmVudDogZmFsc2UKfSwKcmVzZXQ6IGZ1bmN0aW9uICgpIHsKdGhpcy5pbmZvLnN0YXRlID0gJ3N0YXJ0JzsKdGhpcy5pbmZvLnN0YXJ0ZWQgPSBmYWxzZTsKdGhpcy5pbmZvLm1vdmVzID0gW107CnRoaXMuaW5mby54ID0gMDsKdGhpcy5pbmZvLnkgPSAwOwp0aGlzLmluZm8ucHJldmVudCA9IGZhbHNlOwp1bnRyYWNrRG9jdW1lbnQodGhpcy5pbmZvKTsKfSwKaGFzTW92ZWRFbm91Z2g6IGZ1bmN0aW9uICh4LCB5KSB7CmlmICh0aGlzLmluZm8ucHJldmVudCkgewpyZXR1cm4gZmFsc2U7Cn0KaWYgKHRoaXMuaW5mby5zdGFydGVkKSB7CnJldHVybiB0cnVlOwp9CnZhciBkeCA9IE1hdGguYWJzKHRoaXMuaW5mby54IC0geCk7CnZhciBkeSA9IE1hdGguYWJzKHRoaXMuaW5mby55IC0geSk7CnJldHVybiBkeCA+PSBUUkFDS19ESVNUQU5DRSB8fCBkeSA+PSBUUkFDS19ESVNUQU5DRTsKfSwKbW91c2Vkb3duOiBmdW5jdGlvbiAoZSkgewppZiAoIWhhc0xlZnRNb3VzZUJ1dHRvbihlKSkgewpyZXR1cm47Cn0KdmFyIHQgPSBHZXN0dXJlcy5maW5kT3JpZ2luYWxUYXJnZXQoZSk7CnZhciBzZWxmID0gdGhpczsKdmFyIG1vdmVmbiA9IGZ1bmN0aW9uIG1vdmVmbihlKSB7CnZhciB4ID0gZS5jbGllbnRYLCB5ID0gZS5jbGllbnRZOwppZiAoc2VsZi5oYXNNb3ZlZEVub3VnaCh4LCB5KSkgewpzZWxmLmluZm8uc3RhdGUgPSBzZWxmLmluZm8uc3RhcnRlZCA/IGUudHlwZSA9PT0gJ21vdXNldXAnID8gJ2VuZCcgOiAndHJhY2snIDogJ3N0YXJ0JzsKc2VsZi5pbmZvLmFkZE1vdmUoewp4OiB4LAp5OiB5Cn0pOwppZiAoIWhhc0xlZnRNb3VzZUJ1dHRvbihlKSkgewpzZWxmLmluZm8uc3RhdGUgPSAnZW5kJzsKdW50cmFja0RvY3VtZW50KHNlbGYuaW5mbyk7Cn0Kc2VsZi5maXJlKHQsIGUpOwpzZWxmLmluZm8uc3RhcnRlZCA9IHRydWU7Cn0KfTsKdmFyIHVwZm4gPSBmdW5jdGlvbiB1cGZuKGUpIHsKaWYgKHNlbGYuaW5mby5zdGFydGVkKSB7Ckdlc3R1cmVzLnByZXZlbnQoJ3RhcCcpOwptb3ZlZm4oZSk7Cn0KdW50cmFja0RvY3VtZW50KHNlbGYuaW5mbyk7Cn07CnRyYWNrRG9jdW1lbnQodGhpcy5pbmZvLCBtb3ZlZm4sIHVwZm4pOwp0aGlzLmluZm8ueCA9IGUuY2xpZW50WDsKdGhpcy5pbmZvLnkgPSBlLmNsaWVudFk7Cn0sCnRvdWNoc3RhcnQ6IGZ1bmN0aW9uIChlKSB7CnZhciBjdCA9IGUuY2hhbmdlZFRvdWNoZXNbMF07CnRoaXMuaW5mby54ID0gY3QuY2xpZW50WDsKdGhpcy5pbmZvLnkgPSBjdC5jbGllbnRZOwp9LAp0b3VjaG1vdmU6IGZ1bmN0aW9uIChlKSB7CnZhciB0ID0gR2VzdHVyZXMuZmluZE9yaWdpbmFsVGFyZ2V0KGUpOwp2YXIgY3QgPSBlLmNoYW5nZWRUb3VjaGVzWzBdOwp2YXIgeCA9IGN0LmNsaWVudFgsIHkgPSBjdC5jbGllbnRZOwppZiAodGhpcy5oYXNNb3ZlZEVub3VnaCh4LCB5KSkgewp0aGlzLmluZm8uYWRkTW92ZSh7Cng6IHgsCnk6IHkKfSk7CnRoaXMuZmlyZSh0LCBjdCk7CnRoaXMuaW5mby5zdGF0ZSA9ICd0cmFjayc7CnRoaXMuaW5mby5zdGFydGVkID0gdHJ1ZTsKfQp9LAp0b3VjaGVuZDogZnVuY3Rpb24gKGUpIHsKdmFyIHQgPSBHZXN0dXJlcy5maW5kT3JpZ2luYWxUYXJnZXQoZSk7CnZhciBjdCA9IGUuY2hhbmdlZFRvdWNoZXNbMF07CmlmICh0aGlzLmluZm8uc3RhcnRlZCkgewpHZXN0dXJlcy5wcmV2ZW50KCd0YXAnKTsKdGhpcy5pbmZvLnN0YXRlID0gJ2VuZCc7CnRoaXMuaW5mby5hZGRNb3ZlKHsKeDogY3QuY2xpZW50WCwKeTogY3QuY2xpZW50WQp9KTsKdGhpcy5maXJlKHQsIGN0KTsKfQp9LApmaXJlOiBmdW5jdGlvbiAodGFyZ2V0LCB0b3VjaCkgewp2YXIgc2Vjb25kbGFzdCA9IHRoaXMuaW5mby5tb3Zlc1t0aGlzLmluZm8ubW92ZXMubGVuZ3RoIC0gMl07CnZhciBsYXN0bW92ZSA9IHRoaXMuaW5mby5tb3Zlc1t0aGlzLmluZm8ubW92ZXMubGVuZ3RoIC0gMV07CnZhciBkeCA9IGxhc3Rtb3ZlLnggLSB0aGlzLmluZm8ueDsKdmFyIGR5ID0gbGFzdG1vdmUueSAtIHRoaXMuaW5mby55Owp2YXIgZGR4LCBkZHkgPSAwOwppZiAoc2Vjb25kbGFzdCkgewpkZHggPSBsYXN0bW92ZS54IC0gc2Vjb25kbGFzdC54OwpkZHkgPSBsYXN0bW92ZS55IC0gc2Vjb25kbGFzdC55Owp9CnJldHVybiBHZXN0dXJlcy5maXJlKHRhcmdldCwgJ3RyYWNrJywgewpzdGF0ZTogdGhpcy5pbmZvLnN0YXRlLAp4OiB0b3VjaC5jbGllbnRYLAp5OiB0b3VjaC5jbGllbnRZLApkeDogZHgsCmR5OiBkeSwKZGR4OiBkZHgsCmRkeTogZGR5LApzb3VyY2VFdmVudDogdG91Y2gsCmhvdmVyOiBmdW5jdGlvbiAoKSB7CnJldHVybiBHZXN0dXJlcy5kZWVwVGFyZ2V0RmluZCh0b3VjaC5jbGllbnRYLCB0b3VjaC5jbGllbnRZKTsKfQp9KTsKfQp9KTsKR2VzdHVyZXMucmVnaXN0ZXIoewpuYW1lOiAndGFwJywKZGVwczogWwonbW91c2Vkb3duJywKJ2NsaWNrJywKJ3RvdWNoc3RhcnQnLAondG91Y2hlbmQnCl0sCmZsb3c6IHsKc3RhcnQ6IFsKJ21vdXNlZG93bicsCid0b3VjaHN0YXJ0JwpdLAplbmQ6IFsKJ2NsaWNrJywKJ3RvdWNoZW5kJwpdCn0sCmVtaXRzOiBbJ3RhcCddLAppbmZvOiB7Cng6IE5hTiwKeTogTmFOLApwcmV2ZW50OiBmYWxzZQp9LApyZXNldDogZnVuY3Rpb24gKCkgewp0aGlzLmluZm8ueCA9IE5hTjsKdGhpcy5pbmZvLnkgPSBOYU47CnRoaXMuaW5mby5wcmV2ZW50ID0gZmFsc2U7Cn0sCnNhdmU6IGZ1bmN0aW9uIChlKSB7CnRoaXMuaW5mby54ID0gZS5jbGllbnRYOwp0aGlzLmluZm8ueSA9IGUuY2xpZW50WTsKfSwKbW91c2Vkb3duOiBmdW5jdGlvbiAoZSkgewppZiAoaGFzTGVmdE1vdXNlQnV0dG9uKGUpKSB7CnRoaXMuc2F2ZShlKTsKfQp9LApjbGljazogZnVuY3Rpb24gKGUpIHsKaWYgKGhhc0xlZnRNb3VzZUJ1dHRvbihlKSkgewp0aGlzLmZvcndhcmQoZSk7Cn0KfSwKdG91Y2hzdGFydDogZnVuY3Rpb24gKGUpIHsKdGhpcy5zYXZlKGUuY2hhbmdlZFRvdWNoZXNbMF0pOwp9LAp0b3VjaGVuZDogZnVuY3Rpb24gKGUpIHsKdGhpcy5mb3J3YXJkKGUuY2hhbmdlZFRvdWNoZXNbMF0pOwp9LApmb3J3YXJkOiBmdW5jdGlvbiAoZSkgewp2YXIgZHggPSBNYXRoLmFicyhlLmNsaWVudFggLSB0aGlzLmluZm8ueCk7CnZhciBkeSA9IE1hdGguYWJzKGUuY2xpZW50WSAtIHRoaXMuaW5mby55KTsKdmFyIHQgPSBHZXN0dXJlcy5maW5kT3JpZ2luYWxUYXJnZXQoZSk7CmlmIChpc05hTihkeCkgfHwgaXNOYU4oZHkpIHx8IGR4IDw9IFRBUF9ESVNUQU5DRSAmJiBkeSA8PSBUQVBfRElTVEFOQ0UgfHwgaXNTeW50aGV0aWNDbGljayhlKSkgewppZiAoIXRoaXMuaW5mby5wcmV2ZW50KSB7Ckdlc3R1cmVzLmZpcmUodCwgJ3RhcCcsIHsKeDogZS5jbGllbnRYLAp5OiBlLmNsaWVudFksCnNvdXJjZUV2ZW50OiBlCn0pOwp9Cn0KfQp9KTsKdmFyIERJUkVDVElPTl9NQVAgPSB7Cng6ICdwYW4teCcsCnk6ICdwYW4teScsCm5vbmU6ICdub25lJywKYWxsOiAnYXV0bycKfTsKUG9seW1lci5CYXNlLl9hZGRGZWF0dXJlKHsKX2xpc3RlbjogZnVuY3Rpb24gKG5vZGUsIGV2ZW50TmFtZSwgaGFuZGxlcikgewppZiAoR2VzdHVyZXMuZ2VzdHVyZXNbZXZlbnROYW1lXSkgewpHZXN0dXJlcy5hZGQobm9kZSwgZXZlbnROYW1lLCBoYW5kbGVyKTsKfSBlbHNlIHsKbm9kZS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGFuZGxlcik7Cn0KfSwKX3VubGlzdGVuOiBmdW5jdGlvbiAobm9kZSwgZXZlbnROYW1lLCBoYW5kbGVyKSB7CmlmIChHZXN0dXJlcy5nZXN0dXJlc1tldmVudE5hbWVdKSB7Ckdlc3R1cmVzLnJlbW92ZShub2RlLCBldmVudE5hbWUsIGhhbmRsZXIpOwp9IGVsc2Ugewpub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoYW5kbGVyKTsKfQp9LApzZXRTY3JvbGxEaXJlY3Rpb246IGZ1bmN0aW9uIChkaXJlY3Rpb24sIG5vZGUpIHsKbm9kZSA9IG5vZGUgfHwgdGhpczsKR2VzdHVyZXMuc2V0VG91Y2hBY3Rpb24obm9kZSwgRElSRUNUSU9OX01BUFtkaXJlY3Rpb25dIHx8ICdhdXRvJyk7Cn0KfSk7ClBvbHltZXIuR2VzdHVyZXMgPSBHZXN0dXJlczsKfSgpKTsKUG9seW1lci5Bc3luYyA9IHsKX2N1cnJWYWw6IDAsCl9sYXN0VmFsOiAwLApfY2FsbGJhY2tzOiBbXSwKX3R3aWRkbGVDb250ZW50OiAwLApfdHdpZGRsZTogZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycpLApydW46IGZ1bmN0aW9uIChjYWxsYmFjaywgd2FpdFRpbWUpIHsKaWYgKHdhaXRUaW1lID4gMCkgewpyZXR1cm4gfnNldFRpbWVvdXQoY2FsbGJhY2ssIHdhaXRUaW1lKTsKfSBlbHNlIHsKdGhpcy5fdHdpZGRsZS50ZXh0Q29udGVudCA9IHRoaXMuX3R3aWRkbGVDb250ZW50Kys7CnRoaXMuX2NhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTsKcmV0dXJuIHRoaXMuX2N1cnJWYWwrKzsKfQp9LApjYW5jZWw6IGZ1bmN0aW9uIChoYW5kbGUpIHsKaWYgKGhhbmRsZSA8IDApIHsKY2xlYXJUaW1lb3V0KH5oYW5kbGUpOwp9IGVsc2Ugewp2YXIgaWR4ID0gaGFuZGxlIC0gdGhpcy5fbGFzdFZhbDsKaWYgKGlkeCA+PSAwKSB7CmlmICghdGhpcy5fY2FsbGJhY2tzW2lkeF0pIHsKdGhyb3cgJ2ludmFsaWQgYXN5bmMgaGFuZGxlOiAnICsgaGFuZGxlOwp9CnRoaXMuX2NhbGxiYWNrc1tpZHhdID0gbnVsbDsKfQp9Cn0sCl9hdEVuZE9mTWljcm90YXNrOiBmdW5jdGlvbiAoKSB7CnZhciBsZW4gPSB0aGlzLl9jYWxsYmFja3MubGVuZ3RoOwpmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CnZhciBjYiA9IHRoaXMuX2NhbGxiYWNrc1tpXTsKaWYgKGNiKSB7CnRyeSB7CmNiKCk7Cn0gY2F0Y2ggKGUpIHsKaSsrOwp0aGlzLl9jYWxsYmFja3Muc3BsaWNlKDAsIGkpOwp0aGlzLl9sYXN0VmFsICs9IGk7CnRoaXMuX3R3aWRkbGUudGV4dENvbnRlbnQgPSB0aGlzLl90d2lkZGxlQ29udGVudCsrOwp0aHJvdyBlOwp9Cn0KfQp0aGlzLl9jYWxsYmFja3Muc3BsaWNlKDAsIGxlbik7CnRoaXMuX2xhc3RWYWwgKz0gbGVuOwp9Cn07Cm5ldyAod2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgSnNNdXRhdGlvbk9ic2VydmVyKShQb2x5bWVyLkFzeW5jLl9hdEVuZE9mTWljcm90YXNrLmJpbmQoUG9seW1lci5Bc3luYykpLm9ic2VydmUoUG9seW1lci5Bc3luYy5fdHdpZGRsZSwgeyBjaGFyYWN0ZXJEYXRhOiB0cnVlIH0pOwpQb2x5bWVyLkRlYm91bmNlID0gZnVuY3Rpb24gKCkgewp2YXIgQXN5bmMgPSBQb2x5bWVyLkFzeW5jOwp2YXIgRGVib3VuY2VyID0gZnVuY3Rpb24gKGNvbnRleHQpIHsKdGhpcy5jb250ZXh0ID0gY29udGV4dDsKdGhpcy5ib3VuZENvbXBsZXRlID0gdGhpcy5jb21wbGV0ZS5iaW5kKHRoaXMpOwp9OwpEZWJvdW5jZXIucHJvdG90eXBlID0gewpnbzogZnVuY3Rpb24gKGNhbGxiYWNrLCB3YWl0KSB7CnZhciBoOwp0aGlzLmZpbmlzaCA9IGZ1bmN0aW9uICgpIHsKQXN5bmMuY2FuY2VsKGgpOwp9OwpoID0gQXN5bmMucnVuKHRoaXMuYm91bmRDb21wbGV0ZSwgd2FpdCk7CnRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjazsKfSwKc3RvcDogZnVuY3Rpb24gKCkgewppZiAodGhpcy5maW5pc2gpIHsKdGhpcy5maW5pc2goKTsKdGhpcy5maW5pc2ggPSBudWxsOwp9Cn0sCmNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7CmlmICh0aGlzLmZpbmlzaCkgewp0aGlzLnN0b3AoKTsKdGhpcy5jYWxsYmFjay5jYWxsKHRoaXMuY29udGV4dCk7Cn0KfQp9OwpmdW5jdGlvbiBkZWJvdW5jZShkZWJvdW5jZXIsIGNhbGxiYWNrLCB3YWl0KSB7CmlmIChkZWJvdW5jZXIpIHsKZGVib3VuY2VyLnN0b3AoKTsKfSBlbHNlIHsKZGVib3VuY2VyID0gbmV3IERlYm91bmNlcih0aGlzKTsKfQpkZWJvdW5jZXIuZ28oY2FsbGJhY2ssIHdhaXQpOwpyZXR1cm4gZGVib3VuY2VyOwp9CnJldHVybiBkZWJvdW5jZTsKfSgpOwpQb2x5bWVyLkJhc2UuX2FkZEZlYXR1cmUoewokJDogZnVuY3Rpb24gKHNsY3RyKSB7CnJldHVybiBQb2x5bWVyLmRvbSh0aGlzLnJvb3QpLnF1ZXJ5U2VsZWN0b3Ioc2xjdHIpOwp9LAp0b2dnbGVDbGFzczogZnVuY3Rpb24gKG5hbWUsIGJvb2wsIG5vZGUpIHsKbm9kZSA9IG5vZGUgfHwgdGhpczsKaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgewpib29sID0gIW5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKG5hbWUpOwp9CmlmIChib29sKSB7ClBvbHltZXIuZG9tKG5vZGUpLmNsYXNzTGlzdC5hZGQobmFtZSk7Cn0gZWxzZSB7ClBvbHltZXIuZG9tKG5vZGUpLmNsYXNzTGlzdC5yZW1vdmUobmFtZSk7Cn0KfSwKdG9nZ2xlQXR0cmlidXRlOiBmdW5jdGlvbiAobmFtZSwgYm9vbCwgbm9kZSkgewpub2RlID0gbm9kZSB8fCB0aGlzOwppZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7CmJvb2wgPSAhbm9kZS5oYXNBdHRyaWJ1dGUobmFtZSk7Cn0KaWYgKGJvb2wpIHsKUG9seW1lci5kb20obm9kZSkuc2V0QXR0cmlidXRlKG5hbWUsICcnKTsKfSBlbHNlIHsKUG9seW1lci5kb20obm9kZSkucmVtb3ZlQXR0cmlidXRlKG5hbWUpOwp9Cn0sCmNsYXNzRm9sbG93czogZnVuY3Rpb24gKG5hbWUsIHRvRWxlbWVudCwgZnJvbUVsZW1lbnQpIHsKaWYgKGZyb21FbGVtZW50KSB7ClBvbHltZXIuZG9tKGZyb21FbGVtZW50KS5jbGFzc0xpc3QucmVtb3ZlKG5hbWUpOwp9CmlmICh0b0VsZW1lbnQpIHsKUG9seW1lci5kb20odG9FbGVtZW50KS5jbGFzc0xpc3QuYWRkKG5hbWUpOwp9Cn0sCmF0dHJpYnV0ZUZvbGxvd3M6IGZ1bmN0aW9uIChuYW1lLCB0b0VsZW1lbnQsIGZyb21FbGVtZW50KSB7CmlmIChmcm9tRWxlbWVudCkgewpQb2x5bWVyLmRvbShmcm9tRWxlbWVudCkucmVtb3ZlQXR0cmlidXRlKG5hbWUpOwp9CmlmICh0b0VsZW1lbnQpIHsKUG9seW1lci5kb20odG9FbGVtZW50KS5zZXRBdHRyaWJ1dGUobmFtZSwgJycpOwp9Cn0sCmdldENvbnRlbnRDaGlsZE5vZGVzOiBmdW5jdGlvbiAoc2xjdHIpIHsKdmFyIGNvbnRlbnQgPSBQb2x5bWVyLmRvbSh0aGlzLnJvb3QpLnF1ZXJ5U2VsZWN0b3Ioc2xjdHIgfHwgJ2NvbnRlbnQnKTsKcmV0dXJuIGNvbnRlbnQgPyBQb2x5bWVyLmRvbShjb250ZW50KS5nZXREaXN0cmlidXRlZE5vZGVzKCkgOiBbXTsKfSwKZ2V0Q29udGVudENoaWxkcmVuOiBmdW5jdGlvbiAoc2xjdHIpIHsKcmV0dXJuIHRoaXMuZ2V0Q29udGVudENoaWxkTm9kZXMoc2xjdHIpLmZpbHRlcihmdW5jdGlvbiAobikgewpyZXR1cm4gbi5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREU7Cn0pOwp9LApmaXJlOiBmdW5jdGlvbiAodHlwZSwgZGV0YWlsLCBvcHRpb25zKSB7Cm9wdGlvbnMgPSBvcHRpb25zIHx8IFBvbHltZXIubm9iOwp2YXIgbm9kZSA9IG9wdGlvbnMubm9kZSB8fCB0aGlzOwp2YXIgZGV0YWlsID0gZGV0YWlsID09PSBudWxsIHx8IGRldGFpbCA9PT0gdW5kZWZpbmVkID8gUG9seW1lci5ub2IgOiBkZXRhaWw7CnZhciBidWJibGVzID0gb3B0aW9ucy5idWJibGVzID09PSB1bmRlZmluZWQgPyB0cnVlIDogb3B0aW9ucy5idWJibGVzOwp2YXIgY2FuY2VsYWJsZSA9IEJvb2xlYW4ob3B0aW9ucy5jYW5jZWxhYmxlKTsKdmFyIGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KHR5cGUsIHsKYnViYmxlczogQm9vbGVhbihidWJibGVzKSwKY2FuY2VsYWJsZTogY2FuY2VsYWJsZSwKZGV0YWlsOiBkZXRhaWwKfSk7Cm5vZGUuZGlzcGF0Y2hFdmVudChldmVudCk7CnJldHVybiBldmVudDsKfSwKYXN5bmM6IGZ1bmN0aW9uIChjYWxsYmFjaywgd2FpdFRpbWUpIHsKcmV0dXJuIFBvbHltZXIuQXN5bmMucnVuKGNhbGxiYWNrLmJpbmQodGhpcyksIHdhaXRUaW1lKTsKfSwKY2FuY2VsQXN5bmM6IGZ1bmN0aW9uIChoYW5kbGUpIHsKUG9seW1lci5Bc3luYy5jYW5jZWwoaGFuZGxlKTsKfSwKYXJyYXlEZWxldGU6IGZ1bmN0aW9uIChwYXRoLCBpdGVtKSB7CnZhciBpbmRleDsKaWYgKEFycmF5LmlzQXJyYXkocGF0aCkpIHsKaW5kZXggPSBwYXRoLmluZGV4T2YoaXRlbSk7CmlmIChpbmRleCA+PSAwKSB7CnJldHVybiBwYXRoLnNwbGljZShpbmRleCwgMSk7Cn0KfSBlbHNlIHsKdmFyIGFyciA9IHRoaXMuZ2V0KHBhdGgpOwppbmRleCA9IGFyci5pbmRleE9mKGl0ZW0pOwppZiAoaW5kZXggPj0gMCkgewpyZXR1cm4gdGhpcy5zcGxpY2UocGF0aCwgaW5kZXgsIDEpOwp9Cn0KfSwKdHJhbnNmb3JtOiBmdW5jdGlvbiAodHJhbnNmb3JtLCBub2RlKSB7Cm5vZGUgPSBub2RlIHx8IHRoaXM7Cm5vZGUuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gdHJhbnNmb3JtOwpub2RlLnN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTsKfSwKdHJhbnNsYXRlM2Q6IGZ1bmN0aW9uICh4LCB5LCB6LCBub2RlKSB7Cm5vZGUgPSBub2RlIHx8IHRoaXM7CnRoaXMudHJhbnNmb3JtKCd0cmFuc2xhdGUzZCgnICsgeCArICcsJyArIHkgKyAnLCcgKyB6ICsgJyknLCBub2RlKTsKfSwKaW1wb3J0SHJlZjogZnVuY3Rpb24gKGhyZWYsIG9ubG9hZCwgb25lcnJvcikgewp2YXIgbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTsKbC5yZWwgPSAnaW1wb3J0JzsKbC5ocmVmID0gaHJlZjsKaWYgKG9ubG9hZCkgewpsLm9ubG9hZCA9IG9ubG9hZC5iaW5kKHRoaXMpOwp9CmlmIChvbmVycm9yKSB7Cmwub25lcnJvciA9IG9uZXJyb3IuYmluZCh0aGlzKTsKfQpkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGwpOwpyZXR1cm4gbDsKfSwKY3JlYXRlOiBmdW5jdGlvbiAodGFnLCBwcm9wcykgewp2YXIgZWx0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOwppZiAocHJvcHMpIHsKZm9yICh2YXIgbiBpbiBwcm9wcykgewplbHRbbl0gPSBwcm9wc1tuXTsKfQp9CnJldHVybiBlbHQ7Cn0sCmlzTGlnaHREZXNjZW5kYW50OiBmdW5jdGlvbiAobm9kZSkgewpyZXR1cm4gdGhpcy5jb250YWlucyhub2RlKSAmJiBQb2x5bWVyLmRvbSh0aGlzKS5nZXRPd25lclJvb3QoKSA9PT0gUG9seW1lci5kb20obm9kZSkuZ2V0T3duZXJSb290KCk7Cn0sCmlzTG9jYWxEZXNjZW5kYW50OiBmdW5jdGlvbiAobm9kZSkgewpyZXR1cm4gdGhpcy5yb290ID09PSBQb2x5bWVyLmRvbShub2RlKS5nZXRPd25lclJvb3QoKTsKfQp9KTsKUG9seW1lci5CaW5kID0gewpwcmVwYXJlTW9kZWw6IGZ1bmN0aW9uIChtb2RlbCkgewptb2RlbC5fcHJvcGVydHlFZmZlY3RzID0ge307Cm1vZGVsLl9iaW5kTGlzdGVuZXJzID0gW107ClBvbHltZXIuQmFzZS5taXhpbihtb2RlbCwgdGhpcy5fbW9kZWxBcGkpOwp9LApfbW9kZWxBcGk6IHsKX25vdGlmeUNoYW5nZTogZnVuY3Rpb24gKHByb3BlcnR5KSB7CnZhciBldmVudE5hbWUgPSBQb2x5bWVyLkNhc2VNYXAuY2FtZWxUb0Rhc2hDYXNlKHByb3BlcnR5KSArICctY2hhbmdlZCc7ClBvbHltZXIuQmFzZS5maXJlKGV2ZW50TmFtZSwgeyB2YWx1ZTogdGhpc1twcm9wZXJ0eV0gfSwgewpidWJibGVzOiBmYWxzZSwKbm9kZTogdGhpcwp9KTsKfSwKX3Byb3BlcnR5U2V0dGVyOiBmdW5jdGlvbiAocHJvcGVydHksIHZhbHVlLCBlZmZlY3RzLCBmcm9tQWJvdmUpIHsKdmFyIG9sZCA9IHRoaXMuX19kYXRhX19bcHJvcGVydHldOwppZiAob2xkICE9PSB2YWx1ZSAmJiAob2xkID09PSBvbGQgfHwgdmFsdWUgPT09IHZhbHVlKSkgewp0aGlzLl9fZGF0YV9fW3Byb3BlcnR5XSA9IHZhbHVlOwppZiAodHlwZW9mIHZhbHVlID09ICdvYmplY3QnKSB7CnRoaXMuX2NsZWFyUGF0aChwcm9wZXJ0eSk7Cn0KaWYgKHRoaXMuX3Byb3BlcnR5Q2hhbmdlZCkgewp0aGlzLl9wcm9wZXJ0eUNoYW5nZWQocHJvcGVydHksIHZhbHVlLCBvbGQpOwp9CmlmIChlZmZlY3RzKSB7CnRoaXMuX2VmZmVjdEVmZmVjdHMocHJvcGVydHksIHZhbHVlLCBlZmZlY3RzLCBvbGQsIGZyb21BYm92ZSk7Cn0KfQpyZXR1cm4gb2xkOwp9LApfX3NldFByb3BlcnR5OiBmdW5jdGlvbiAocHJvcGVydHksIHZhbHVlLCBxdWlldCwgbm9kZSkgewpub2RlID0gbm9kZSB8fCB0aGlzOwp2YXIgZWZmZWN0cyA9IG5vZGUuX3Byb3BlcnR5RWZmZWN0cyAmJiBub2RlLl9wcm9wZXJ0eUVmZmVjdHNbcHJvcGVydHldOwppZiAoZWZmZWN0cykgewpub2RlLl9wcm9wZXJ0eVNldHRlcihwcm9wZXJ0eSwgdmFsdWUsIGVmZmVjdHMsIHF1aWV0KTsKfSBlbHNlIHsKbm9kZVtwcm9wZXJ0eV0gPSB2YWx1ZTsKfQp9LApfZWZmZWN0RWZmZWN0czogZnVuY3Rpb24gKHByb3BlcnR5LCB2YWx1ZSwgZWZmZWN0cywgb2xkLCBmcm9tQWJvdmUpIHsKZWZmZWN0cy5mb3JFYWNoKGZ1bmN0aW9uIChmeCkgewp2YXIgZm4gPSBQb2x5bWVyLkJpbmRbJ18nICsgZngua2luZCArICdFZmZlY3QnXTsKaWYgKGZuKSB7CmZuLmNhbGwodGhpcywgcHJvcGVydHksIHZhbHVlLCBmeC5lZmZlY3QsIG9sZCwgZnJvbUFib3ZlKTsKfQp9LCB0aGlzKTsKfSwKX2NsZWFyUGF0aDogZnVuY3Rpb24gKHBhdGgpIHsKZm9yICh2YXIgcHJvcCBpbiB0aGlzLl9fZGF0YV9fKSB7CmlmIChwcm9wLmluZGV4T2YocGF0aCArICcuLi9kaWN0aW9uYXJ5LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlLm51bGwnKSA9PT0gMCkgewp0aGlzLl9fZGF0YV9fW3Byb3BdID0gdW5kZWZpbmVkOwp9Cn0KfQp9LAplbnN1cmVQcm9wZXJ0eUVmZmVjdHM6IGZ1bmN0aW9uIChtb2RlbCwgcHJvcGVydHkpIHsKdmFyIGZ4ID0gbW9kZWwuX3Byb3BlcnR5RWZmZWN0c1twcm9wZXJ0eV07CmlmICghZngpIHsKZnggPSBtb2RlbC5fcHJvcGVydHlFZmZlY3RzW3Byb3BlcnR5XSA9IFtdOwp9CnJldHVybiBmeDsKfSwKYWRkUHJvcGVydHlFZmZlY3Q6IGZ1bmN0aW9uIChtb2RlbCwgcHJvcGVydHksIGtpbmQsIGVmZmVjdCkgewp2YXIgZnggPSB0aGlzLmVuc3VyZVByb3BlcnR5RWZmZWN0cyhtb2RlbCwgcHJvcGVydHkpOwpmeC5wdXNoKHsKa2luZDoga2luZCwKZWZmZWN0OiBlZmZlY3QKfSk7Cn0sCmNyZWF0ZUJpbmRpbmdzOiBmdW5jdGlvbiAobW9kZWwpIHsKdmFyIGZ4JCA9IG1vZGVsLl9wcm9wZXJ0eUVmZmVjdHM7CmlmIChmeCQpIHsKZm9yICh2YXIgbiBpbiBmeCQpIHsKdmFyIGZ4ID0gZngkW25dOwpmeC5zb3J0KHRoaXMuX3NvcnRQcm9wZXJ0eUVmZmVjdHMpOwp0aGlzLl9jcmVhdGVBY2Nlc3NvcnMobW9kZWwsIG4sIGZ4KTsKfQp9Cn0sCl9zb3J0UHJvcGVydHlFZmZlY3RzOiBmdW5jdGlvbiAoKSB7CnZhciBFRkZFQ1RfT1JERVIgPSB7Cidjb21wdXRlJzogMCwKJ2Fubm90YXRpb24nOiAxLAonY29tcHV0ZWRBbm5vdGF0aW9uJzogMiwKJ3JlZmxlY3QnOiAzLAonbm90aWZ5JzogNCwKJ29ic2VydmVyJzogNSwKJ2NvbXBsZXhPYnNlcnZlcic6IDYsCidmdW5jdGlvbic6IDcKfTsKcmV0dXJuIGZ1bmN0aW9uIChhLCBiKSB7CnJldHVybiBFRkZFQ1RfT1JERVJbYS5raW5kXSAtIEVGRkVDVF9PUkRFUltiLmtpbmRdOwp9Owp9KCksCl9jcmVhdGVBY2Nlc3NvcnM6IGZ1bmN0aW9uIChtb2RlbCwgcHJvcGVydHksIGVmZmVjdHMpIHsKdmFyIGRlZnVuID0gewpnZXQ6IGZ1bmN0aW9uICgpIHsKcmV0dXJuIHRoaXMuX19kYXRhX19bcHJvcGVydHldOwp9Cn07CnZhciBzZXR0ZXIgPSBmdW5jdGlvbiAodmFsdWUpIHsKdGhpcy5fcHJvcGVydHlTZXR0ZXIocHJvcGVydHksIHZhbHVlLCBlZmZlY3RzKTsKfTsKdmFyIGluZm8gPSBtb2RlbC5nZXRQcm9wZXJ0eUluZm8gJiYgbW9kZWwuZ2V0UHJvcGVydHlJbmZvKHByb3BlcnR5KTsKaWYgKGluZm8gJiYgaW5mby5yZWFkT25seSkgewppZiAoIWluZm8uY29tcHV0ZWQpIHsKbW9kZWxbJ19zZXQnICsgdGhpcy51cHBlcihwcm9wZXJ0eSldID0gc2V0dGVyOwp9Cn0gZWxzZSB7CmRlZnVuLnNldCA9IHNldHRlcjsKfQpPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kZWwsIHByb3BlcnR5LCBkZWZ1bik7Cn0sCnVwcGVyOiBmdW5jdGlvbiAobmFtZSkgewpyZXR1cm4gbmFtZVswXS50b1VwcGVyQ2FzZSgpICsgbmFtZS5zdWJzdHJpbmcoMSk7Cn0sCl9hZGRBbm5vdGF0ZWRMaXN0ZW5lcjogZnVuY3Rpb24gKG1vZGVsLCBpbmRleCwgcHJvcGVydHksIHBhdGgsIGV2ZW50KSB7CnZhciBmbiA9IHRoaXMuX25vdGVkTGlzdGVuZXJGYWN0b3J5KHByb3BlcnR5LCBwYXRoLCB0aGlzLl9pc1N0cnVjdHVyZWQocGF0aCksIHRoaXMuX2lzRXZlbnRCb2d1cyk7CnZhciBldmVudE5hbWUgPSBldmVudCB8fCBQb2x5bWVyLkNhc2VNYXAuY2FtZWxUb0Rhc2hDYXNlKHByb3BlcnR5KSArICctY2hhbmdlZCc7Cm1vZGVsLl9iaW5kTGlzdGVuZXJzLnB1c2goewppbmRleDogaW5kZXgsCnByb3BlcnR5OiBwcm9wZXJ0eSwKcGF0aDogcGF0aCwKY2hhbmdlZEZuOiBmbiwKZXZlbnQ6IGV2ZW50TmFtZQp9KTsKfSwKX2lzU3RydWN0dXJlZDogZnVuY3Rpb24gKHBhdGgpIHsKcmV0dXJuIHBhdGguaW5kZXhPZignLi4vZGljdGlvbmFyeS1kNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZS5udWxsJykgPiAwOwp9LApfaXNFdmVudEJvZ3VzOiBmdW5jdGlvbiAoZSwgdGFyZ2V0KSB7CnJldHVybiBlLnBhdGggJiYgZS5wYXRoWzBdICE9PSB0YXJnZXQ7Cn0sCl9ub3RlZExpc3RlbmVyRmFjdG9yeTogZnVuY3Rpb24gKHByb3BlcnR5LCBwYXRoLCBpc1N0cnVjdHVyZWQsIGJvZ3VzVGVzdCkgewpyZXR1cm4gZnVuY3Rpb24gKGUsIHRhcmdldCkgewppZiAoIWJvZ3VzVGVzdChlLCB0YXJnZXQpKSB7CmlmIChlLmRldGFpbCAmJiBlLmRldGFpbC5wYXRoKSB7CnRoaXMubm90aWZ5UGF0aCh0aGlzLl9maXhQYXRoKHBhdGgsIHByb3BlcnR5LCBlLmRldGFpbC5wYXRoKSwgZS5kZXRhaWwudmFsdWUpOwp9IGVsc2Ugewp2YXIgdmFsdWUgPSB0YXJnZXRbcHJvcGVydHldOwppZiAoIWlzU3RydWN0dXJlZCkgewp0aGlzW3BhdGhdID0gdGFyZ2V0W3Byb3BlcnR5XTsKfSBlbHNlIHsKaWYgKHRoaXMuX19kYXRhX19bcGF0aF0gIT0gdmFsdWUpIHsKdGhpcy5zZXQocGF0aCwgdmFsdWUpOwp9Cn0KfQp9Cn07Cn0sCnByZXBhcmVJbnN0YW5jZTogZnVuY3Rpb24gKGluc3QpIHsKaW5zdC5fX2RhdGFfXyA9IE9iamVjdC5jcmVhdGUobnVsbCk7Cn0sCnNldHVwQmluZExpc3RlbmVyczogZnVuY3Rpb24gKGluc3QpIHsKaW5zdC5fYmluZExpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uIChpbmZvKSB7CnZhciBub2RlID0gaW5zdC5fbm9kZXNbaW5mby5pbmRleF07Cm5vZGUuYWRkRXZlbnRMaXN0ZW5lcihpbmZvLmV2ZW50LCBpbnN0Ll9ub3RpZnlMaXN0ZW5lci5iaW5kKGluc3QsIGluZm8uY2hhbmdlZEZuKSk7Cn0pOwp9Cn07ClBvbHltZXIuQmFzZS5leHRlbmQoUG9seW1lci5CaW5kLCB7Cl9zaG91bGRBZGRMaXN0ZW5lcjogZnVuY3Rpb24gKGVmZmVjdCkgewpyZXR1cm4gZWZmZWN0Lm5hbWUgJiYgZWZmZWN0Lm1vZGUgPT09ICd7JyAmJiAhZWZmZWN0Lm5lZ2F0ZSAmJiBlZmZlY3Qua2luZCAhPSAnYXR0cmlidXRlJzsKfSwKX2Fubm90YXRpb25FZmZlY3Q6IGZ1bmN0aW9uIChzb3VyY2UsIHZhbHVlLCBlZmZlY3QpIHsKaWYgKHNvdXJjZSAhPSBlZmZlY3QudmFsdWUpIHsKdmFsdWUgPSB0aGlzLmdldChlZmZlY3QudmFsdWUpOwp0aGlzLl9fZGF0YV9fW2VmZmVjdC52YWx1ZV0gPSB2YWx1ZTsKfQp2YXIgY2FsYyA9IGVmZmVjdC5uZWdhdGUgPyAhdmFsdWUgOiB2YWx1ZTsKaWYgKCFlZmZlY3QuY3VzdG9tRXZlbnQgfHwgdGhpcy5fbm9kZXNbZWZmZWN0LmluZGV4XVtlZmZlY3QubmFtZV0gIT09IGNhbGMpIHsKcmV0dXJuIHRoaXMuX2FwcGx5RWZmZWN0VmFsdWUoY2FsYywgZWZmZWN0KTsKfQp9LApfcmVmbGVjdEVmZmVjdDogZnVuY3Rpb24gKHNvdXJjZSkgewp0aGlzLnJlZmxlY3RQcm9wZXJ0eVRvQXR0cmlidXRlKHNvdXJjZSk7Cn0sCl9ub3RpZnlFZmZlY3Q6IGZ1bmN0aW9uIChzb3VyY2UsIHZhbHVlLCBlZmZlY3QsIG9sZCwgZnJvbUFib3ZlKSB7CmlmICghZnJvbUFib3ZlKSB7CnRoaXMuX25vdGlmeUNoYW5nZShzb3VyY2UpOwp9Cn0sCl9mdW5jdGlvbkVmZmVjdDogZnVuY3Rpb24gKHNvdXJjZSwgdmFsdWUsIGZuLCBvbGQsIGZyb21BYm92ZSkgewpmbi5jYWxsKHRoaXMsIHNvdXJjZSwgdmFsdWUsIG9sZCwgZnJvbUFib3ZlKTsKfSwKX29ic2VydmVyRWZmZWN0OiBmdW5jdGlvbiAoc291cmNlLCB2YWx1ZSwgZWZmZWN0LCBvbGQpIHsKdmFyIGZuID0gdGhpc1tlZmZlY3QubWV0aG9kXTsKaWYgKGZuKSB7CmZuLmNhbGwodGhpcywgdmFsdWUsIG9sZCk7Cn0gZWxzZSB7CnRoaXMuX3dhcm4odGhpcy5fbG9nZignX29ic2VydmVyRWZmZWN0JywgJ29ic2VydmVyIG1ldGhvZCBgJyArIGVmZmVjdC5tZXRob2QgKyAnYCBub3QgZGVmaW5lZCcpKTsKfQp9LApfY29tcGxleE9ic2VydmVyRWZmZWN0OiBmdW5jdGlvbiAoc291cmNlLCB2YWx1ZSwgZWZmZWN0KSB7CnZhciBmbiA9IHRoaXNbZWZmZWN0Lm1ldGhvZF07CmlmIChmbikgewp2YXIgYXJncyA9IFBvbHltZXIuQmluZC5fbWFyc2hhbEFyZ3ModGhpcy5fX2RhdGFfXywgZWZmZWN0LCBzb3VyY2UsIHZhbHVlKTsKaWYgKGFyZ3MpIHsKZm4uYXBwbHkodGhpcywgYXJncyk7Cn0KfSBlbHNlIHsKdGhpcy5fd2Fybih0aGlzLl9sb2dmKCdfY29tcGxleE9ic2VydmVyRWZmZWN0JywgJ29ic2VydmVyIG1ldGhvZCBgJyArIGVmZmVjdC5tZXRob2QgKyAnYCBub3QgZGVmaW5lZCcpKTsKfQp9LApfY29tcHV0ZUVmZmVjdDogZnVuY3Rpb24gKHNvdXJjZSwgdmFsdWUsIGVmZmVjdCkgewp2YXIgYXJncyA9IFBvbHltZXIuQmluZC5fbWFyc2hhbEFyZ3ModGhpcy5fX2RhdGFfXywgZWZmZWN0LCBzb3VyY2UsIHZhbHVlKTsKaWYgKGFyZ3MpIHsKdmFyIGZuID0gdGhpc1tlZmZlY3QubWV0aG9kXTsKaWYgKGZuKSB7CnRoaXMuX19zZXRQcm9wZXJ0eShlZmZlY3QucHJvcGVydHksIGZuLmFwcGx5KHRoaXMsIGFyZ3MpKTsKfSBlbHNlIHsKdGhpcy5fd2Fybih0aGlzLl9sb2dmKCdfY29tcHV0ZUVmZmVjdCcsICdjb21wdXRlIG1ldGhvZCBgJyArIGVmZmVjdC5tZXRob2QgKyAnYCBub3QgZGVmaW5lZCcpKTsKfQp9Cn0sCl9hbm5vdGF0ZWRDb21wdXRhdGlvbkVmZmVjdDogZnVuY3Rpb24gKHNvdXJjZSwgdmFsdWUsIGVmZmVjdCkgewp2YXIgY29tcHV0ZWRIb3N0ID0gdGhpcy5fcm9vdERhdGFIb3N0IHx8IHRoaXM7CnZhciBmbiA9IGNvbXB1dGVkSG9zdFtlZmZlY3QubWV0aG9kXTsKaWYgKGZuKSB7CnZhciBhcmdzID0gUG9seW1lci5CaW5kLl9tYXJzaGFsQXJncyh0aGlzLl9fZGF0YV9fLCBlZmZlY3QsIHNvdXJjZSwgdmFsdWUpOwppZiAoYXJncykgewp2YXIgY29tcHV0ZWR2YWx1ZSA9IGZuLmFwcGx5KGNvbXB1dGVkSG9zdCwgYXJncyk7CmlmIChlZmZlY3QubmVnYXRlKSB7CmNvbXB1dGVkdmFsdWUgPSAhY29tcHV0ZWR2YWx1ZTsKfQp0aGlzLl9hcHBseUVmZmVjdFZhbHVlKGNvbXB1dGVkdmFsdWUsIGVmZmVjdCk7Cn0KfSBlbHNlIHsKY29tcHV0ZWRIb3N0Ll93YXJuKGNvbXB1dGVkSG9zdC5fbG9nZignX2Fubm90YXRlZENvbXB1dGF0aW9uRWZmZWN0JywgJ2NvbXB1dGUgbWV0aG9kIGAnICsgZWZmZWN0Lm1ldGhvZCArICdgIG5vdCBkZWZpbmVkJykpOwp9Cn0sCl9tYXJzaGFsQXJnczogZnVuY3Rpb24gKG1vZGVsLCBlZmZlY3QsIHBhdGgsIHZhbHVlKSB7CnZhciB2YWx1ZXMgPSBbXTsKdmFyIGFyZ3MgPSBlZmZlY3QuYXJnczsKZm9yICh2YXIgaSA9IDAsIGwgPSBhcmdzLmxlbmd0aDsgaSA8IGw7IGkrKykgewp2YXIgYXJnID0gYXJnc1tpXTsKdmFyIG5hbWUgPSBhcmcubmFtZTsKdmFyIHY7CmlmIChhcmcubGl0ZXJhbCkgewp2ID0gYXJnLnZhbHVlOwp9IGVsc2UgaWYgKGFyZy5zdHJ1Y3R1cmVkKSB7CnYgPSBQb2x5bWVyLkJhc2UuZ2V0KG5hbWUsIG1vZGVsKTsKfSBlbHNlIHsKdiA9IG1vZGVsW25hbWVdOwp9CmlmIChhcmdzLmxlbmd0aCA+IDEgJiYgdiA9PT0gdW5kZWZpbmVkKSB7CnJldHVybjsKfQppZiAoYXJnLndpbGRjYXJkKSB7CnZhciBiYXNlQ2hhbmdlZCA9IG5hbWUuaW5kZXhPZihwYXRoICsgJy4uL2RpY3Rpb25hcnktZDQxZDhjZDk4ZjAwYjIwNGU5ODAwOTk4ZWNmODQyN2UubnVsbCcpID09PSAwOwp2YXIgbWF0Y2hlcyA9IGVmZmVjdC50cmlnZ2VyLm5hbWUuaW5kZXhPZihuYW1lKSA9PT0gMCAmJiAhYmFzZUNoYW5nZWQ7CnZhbHVlc1tpXSA9IHsKcGF0aDogbWF0Y2hlcyA/IHBhdGggOiBuYW1lLAp2YWx1ZTogbWF0Y2hlcyA/IHZhbHVlIDogdiwKYmFzZTogdgp9Owp9IGVsc2Ugewp2YWx1ZXNbaV0gPSB2Owp9Cn0KcmV0dXJuIHZhbHVlczsKfQp9KTsKUG9seW1lci5CYXNlLl9hZGRGZWF0dXJlKHsKX2FkZFByb3BlcnR5RWZmZWN0OiBmdW5jdGlvbiAocHJvcGVydHksIGtpbmQsIGVmZmVjdCkgewpQb2x5bWVyLkJpbmQuYWRkUHJvcGVydHlFZmZlY3QodGhpcywgcHJvcGVydHksIGtpbmQsIGVmZmVjdCk7Cn0sCl9wcmVwRWZmZWN0czogZnVuY3Rpb24gKCkgewpQb2x5bWVyLkJpbmQucHJlcGFyZU1vZGVsKHRoaXMpOwp0aGlzLl9hZGRBbm5vdGF0aW9uRWZmZWN0cyh0aGlzLl9ub3Rlcyk7Cn0sCl9wcmVwQmluZGluZ3M6IGZ1bmN0aW9uICgpIHsKUG9seW1lci5CaW5kLmNyZWF0ZUJpbmRpbmdzKHRoaXMpOwp9LApfYWRkUHJvcGVydHlFZmZlY3RzOiBmdW5jdGlvbiAocHJvcGVydGllcykgewppZiAocHJvcGVydGllcykgewpmb3IgKHZhciBwIGluIHByb3BlcnRpZXMpIHsKdmFyIHByb3AgPSBwcm9wZXJ0aWVzW3BdOwppZiAocHJvcC5vYnNlcnZlcikgewp0aGlzLl9hZGRPYnNlcnZlckVmZmVjdChwLCBwcm9wLm9ic2VydmVyKTsKfQppZiAocHJvcC5jb21wdXRlZCkgewpwcm9wLnJlYWRPbmx5ID0gdHJ1ZTsKdGhpcy5fYWRkQ29tcHV0ZWRFZmZlY3QocCwgcHJvcC5jb21wdXRlZCk7Cn0KaWYgKHByb3Aubm90aWZ5KSB7CnRoaXMuX2FkZFByb3BlcnR5RWZmZWN0KHAsICdub3RpZnknKTsKfQppZiAocHJvcC5yZWZsZWN0VG9BdHRyaWJ1dGUpIHsKdGhpcy5fYWRkUHJvcGVydHlFZmZlY3QocCwgJ3JlZmxlY3QnKTsKfQppZiAocHJvcC5yZWFkT25seSkgewpQb2x5bWVyLkJpbmQuZW5zdXJlUHJvcGVydHlFZmZlY3RzKHRoaXMsIHApOwp9Cn0KfQp9LApfYWRkQ29tcHV0ZWRFZmZlY3Q6IGZ1bmN0aW9uIChuYW1lLCBleHByZXNzaW9uKSB7CnZhciBzaWcgPSB0aGlzLl9wYXJzZU1ldGhvZChleHByZXNzaW9uKTsKc2lnLmFyZ3MuZm9yRWFjaChmdW5jdGlvbiAoYXJnKSB7CnRoaXMuX2FkZFByb3BlcnR5RWZmZWN0KGFyZy5tb2RlbCwgJ2NvbXB1dGUnLCB7Cm1ldGhvZDogc2lnLm1ldGhvZCwKYXJnczogc2lnLmFyZ3MsCnRyaWdnZXI6IGFyZywKcHJvcGVydHk6IG5hbWUKfSk7Cn0sIHRoaXMpOwp9LApfYWRkT2JzZXJ2ZXJFZmZlY3Q6IGZ1bmN0aW9uIChwcm9wZXJ0eSwgb2JzZXJ2ZXIpIHsKdGhpcy5fYWRkUHJvcGVydHlFZmZlY3QocHJvcGVydHksICdvYnNlcnZlcicsIHsKbWV0aG9kOiBvYnNlcnZlciwKcHJvcGVydHk6IHByb3BlcnR5Cn0pOwp9LApfYWRkQ29tcGxleE9ic2VydmVyRWZmZWN0czogZnVuY3Rpb24gKG9ic2VydmVycykgewppZiAob2JzZXJ2ZXJzKSB7Cm9ic2VydmVycy5mb3JFYWNoKGZ1bmN0aW9uIChvYnNlcnZlcikgewp0aGlzLl9hZGRDb21wbGV4T2JzZXJ2ZXJFZmZlY3Qob2JzZXJ2ZXIpOwp9LCB0aGlzKTsKfQp9LApfYWRkQ29tcGxleE9ic2VydmVyRWZmZWN0OiBmdW5jdGlvbiAob2JzZXJ2ZXIpIHsKdmFyIHNpZyA9IHRoaXMuX3BhcnNlTWV0aG9kKG9ic2VydmVyKTsKc2lnLmFyZ3MuZm9yRWFjaChmdW5jdGlvbiAoYXJnKSB7CnRoaXMuX2FkZFByb3BlcnR5RWZmZWN0KGFyZy5tb2RlbCwgJ2NvbXBsZXhPYnNlcnZlcicsIHsKbWV0aG9kOiBzaWcubWV0aG9kLAphcmdzOiBzaWcuYXJncywKdHJpZ2dlcjogYXJnCn0pOwp9LCB0aGlzKTsKfSwKX2FkZEFubm90YXRpb25FZmZlY3RzOiBmdW5jdGlvbiAobm90ZXMpIHsKdGhpcy5fbm9kZXMgPSBbXTsKbm90ZXMuZm9yRWFjaChmdW5jdGlvbiAobm90ZSkgewp2YXIgaW5kZXggPSB0aGlzLl9ub2Rlcy5wdXNoKG5vdGUpIC0gMTsKbm90ZS5iaW5kaW5ncy5mb3JFYWNoKGZ1bmN0aW9uIChiaW5kaW5nKSB7CnRoaXMuX2FkZEFubm90YXRpb25FZmZlY3QoYmluZGluZywgaW5kZXgpOwp9LCB0aGlzKTsKfSwgdGhpcyk7Cn0sCl9hZGRBbm5vdGF0aW9uRWZmZWN0OiBmdW5jdGlvbiAobm90ZSwgaW5kZXgpIHsKaWYgKFBvbHltZXIuQmluZC5fc2hvdWxkQWRkTGlzdGVuZXIobm90ZSkpIHsKUG9seW1lci5CaW5kLl9hZGRBbm5vdGF0ZWRMaXN0ZW5lcih0aGlzLCBpbmRleCwgbm90ZS5uYW1lLCBub3RlLnZhbHVlLCBub3RlLmV2ZW50KTsKfQppZiAobm90ZS5zaWduYXR1cmUpIHsKdGhpcy5fYWRkQW5ub3RhdGVkQ29tcHV0YXRpb25FZmZlY3Qobm90ZSwgaW5kZXgpOwp9IGVsc2Ugewpub3RlLmluZGV4ID0gaW5kZXg7CnRoaXMuX2FkZFByb3BlcnR5RWZmZWN0KG5vdGUubW9kZWwsICdhbm5vdGF0aW9uJywgbm90ZSk7Cn0KfSwKX2FkZEFubm90YXRlZENvbXB1dGF0aW9uRWZmZWN0OiBmdW5jdGlvbiAobm90ZSwgaW5kZXgpIHsKdmFyIHNpZyA9IG5vdGUuc2lnbmF0dXJlOwppZiAoc2lnLnN0YXRpYykgewp0aGlzLl9fYWRkQW5ub3RhdGVkQ29tcHV0YXRpb25FZmZlY3QoJ19fc3RhdGljX18nLCBpbmRleCwgbm90ZSwgc2lnLCBudWxsKTsKfSBlbHNlIHsKc2lnLmFyZ3MuZm9yRWFjaChmdW5jdGlvbiAoYXJnKSB7CmlmICghYXJnLmxpdGVyYWwpIHsKdGhpcy5fX2FkZEFubm90YXRlZENvbXB1dGF0aW9uRWZmZWN0KGFyZy5tb2RlbCwgaW5kZXgsIG5vdGUsIHNpZywgYXJnKTsKfQp9LCB0aGlzKTsKfQp9LApfX2FkZEFubm90YXRlZENvbXB1dGF0aW9uRWZmZWN0OiBmdW5jdGlvbiAocHJvcGVydHksIGluZGV4LCBub3RlLCBzaWcsIHRyaWdnZXIpIHsKdGhpcy5fYWRkUHJvcGVydHlFZmZlY3QocHJvcGVydHksICdhbm5vdGF0ZWRDb21wdXRhdGlvbicsIHsKaW5kZXg6IGluZGV4LApraW5kOiBub3RlLmtpbmQsCnByb3BlcnR5OiBub3RlLm5hbWUsCm5lZ2F0ZTogbm90ZS5uZWdhdGUsCm1ldGhvZDogc2lnLm1ldGhvZCwKYXJnczogc2lnLmFyZ3MsCnRyaWdnZXI6IHRyaWdnZXIKfSk7Cn0sCl9wYXJzZU1ldGhvZDogZnVuY3Rpb24gKGV4cHJlc3Npb24pIHsKdmFyIG0gPSBleHByZXNzaW9uLm1hdGNoKC8oW15cc10rKVwoKC4qKVwpLyk7CmlmIChtKSB7CnZhciBzaWcgPSB7Cm1ldGhvZDogbVsxXSwKc3RhdGljOiB0cnVlCn07CmlmIChtWzJdLnRyaW0oKSkgewp2YXIgYXJncyA9IG1bMl0ucmVwbGFjZSgvXFwsL2csICcmY29tbWE7Jykuc3BsaXQoJywnKTsKcmV0dXJuIHRoaXMuX3BhcnNlQXJncyhhcmdzLCBzaWcpOwp9IGVsc2UgewpzaWcuYXJncyA9IFBvbHltZXIubmFyOwpyZXR1cm4gc2lnOwp9Cn0KfSwKX3BhcnNlQXJnczogZnVuY3Rpb24gKGFyZ0xpc3QsIHNpZykgewpzaWcuYXJncyA9IGFyZ0xpc3QubWFwKGZ1bmN0aW9uIChyYXdBcmcpIHsKdmFyIGFyZyA9IHRoaXMuX3BhcnNlQXJnKHJhd0FyZyk7CmlmICghYXJnLmxpdGVyYWwpIHsKc2lnLnN0YXRpYyA9IGZhbHNlOwp9CnJldHVybiBhcmc7Cn0sIHRoaXMpOwpyZXR1cm4gc2lnOwp9LApfcGFyc2VBcmc6IGZ1bmN0aW9uIChyYXdBcmcpIHsKdmFyIGFyZyA9IHJhd0FyZy50cmltKCkucmVwbGFjZSgvJmNvbW1hOy9nLCAnLCcpLnJlcGxhY2UoL1xcKC4pL2csICckMScpOwp2YXIgYSA9IHsKbmFtZTogYXJnLAptb2RlbDogdGhpcy5fbW9kZWxGb3JQYXRoKGFyZykKfTsKdmFyIGZjID0gYXJnWzBdOwppZiAoZmMgPT09ICctJykgewpmYyA9IGFyZ1sxXTsKfQppZiAoZmMgPj0gJzAnICYmIGZjIDw9ICc5JykgewpmYyA9ICcuLi9kaWN0aW9uYXJ5LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlLm51bGwnOwp9CnN3aXRjaCAoZmMpIHsKY2FzZSAnXCcnOgpjYXNlICciJzoKYS52YWx1ZSA9IGFyZy5zbGljZSgxLCAtMSk7CmEubGl0ZXJhbCA9IHRydWU7CmJyZWFrOwpjYXNlICcuLi9kaWN0aW9uYXJ5LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlLm51bGwnOgphLnZhbHVlID0gTnVtYmVyKGFyZyk7CmEubGl0ZXJhbCA9IHRydWU7CmJyZWFrOwp9CmlmICghYS5saXRlcmFsKSB7CmEuc3RydWN0dXJlZCA9IGFyZy5pbmRleE9mKCcuLi9kaWN0aW9uYXJ5LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlLm51bGwnKSA+IDA7CmlmIChhLnN0cnVjdHVyZWQpIHsKYS53aWxkY2FyZCA9IGFyZy5zbGljZSgtMikgPT0gJy4qJzsKaWYgKGEud2lsZGNhcmQpIHsKYS5uYW1lID0gYXJnLnNsaWNlKDAsIC0yKTsKfQp9Cn0KcmV0dXJuIGE7Cn0sCl9tYXJzaGFsSW5zdGFuY2VFZmZlY3RzOiBmdW5jdGlvbiAoKSB7ClBvbHltZXIuQmluZC5wcmVwYXJlSW5zdGFuY2UodGhpcyk7ClBvbHltZXIuQmluZC5zZXR1cEJpbmRMaXN0ZW5lcnModGhpcyk7Cn0sCl9hcHBseUVmZmVjdFZhbHVlOiBmdW5jdGlvbiAodmFsdWUsIGluZm8pIHsKdmFyIG5vZGUgPSB0aGlzLl9ub2Rlc1tpbmZvLmluZGV4XTsKdmFyIHByb3BlcnR5ID0gaW5mby5wcm9wZXJ0eSB8fCBpbmZvLm5hbWUgfHwgJ3RleHRDb250ZW50JzsKaWYgKGluZm8ua2luZCA9PSAnYXR0cmlidXRlJykgewp0aGlzLnNlcmlhbGl6ZVZhbHVlVG9BdHRyaWJ1dGUodmFsdWUsIHByb3BlcnR5LCBub2RlKTsKfSBlbHNlIHsKaWYgKHByb3BlcnR5ID09PSAnY2xhc3NOYW1lJykgewp2YWx1ZSA9IHRoaXMuX3Njb3BlRWxlbWVudENsYXNzKG5vZGUsIHZhbHVlKTsKfQppZiAocHJvcGVydHkgPT09ICd0ZXh0Q29udGVudCcgfHwgbm9kZS5sb2NhbE5hbWUgPT0gJ2lucHV0JyAmJiBwcm9wZXJ0eSA9PSAndmFsdWUnKSB7CnZhbHVlID0gdmFsdWUgPT0gdW5kZWZpbmVkID8gJycgOiB2YWx1ZTsKfQpyZXR1cm4gbm9kZVtwcm9wZXJ0eV0gPSB2YWx1ZTsKfQp9LApfZXhlY3V0ZVN0YXRpY0VmZmVjdHM6IGZ1bmN0aW9uICgpIHsKaWYgKHRoaXMuX3Byb3BlcnR5RWZmZWN0cy5fX3N0YXRpY19fKSB7CnRoaXMuX2VmZmVjdEVmZmVjdHMoJ19fc3RhdGljX18nLCBudWxsLCB0aGlzLl9wcm9wZXJ0eUVmZmVjdHMuX19zdGF0aWNfXyk7Cn0KfQp9KTsKUG9seW1lci5CYXNlLl9hZGRGZWF0dXJlKHsKX3NldHVwQ29uZmlndXJlOiBmdW5jdGlvbiAoaW5pdGlhbENvbmZpZykgewp0aGlzLl9jb25maWcgPSB7fTsKZm9yICh2YXIgaSBpbiBpbml0aWFsQ29uZmlnKSB7CmlmIChpbml0aWFsQ29uZmlnW2ldICE9PSB1bmRlZmluZWQpIHsKdGhpcy5fY29uZmlnW2ldID0gaW5pdGlhbENvbmZpZ1tpXTsKfQp9CnRoaXMuX2hhbmRsZXJzID0gW107Cn0sCl9tYXJzaGFsQXR0cmlidXRlczogZnVuY3Rpb24gKCkgewp0aGlzLl90YWtlQXR0cmlidXRlc1RvTW9kZWwodGhpcy5fY29uZmlnKTsKfSwKX2F0dHJpYnV0ZUNoYW5nZWRJbXBsOiBmdW5jdGlvbiAobmFtZSkgewp2YXIgbW9kZWwgPSB0aGlzLl9jbGllbnRzUmVhZGllZCA/IHRoaXMgOiB0aGlzLl9jb25maWc7CnRoaXMuX3NldEF0dHJpYnV0ZVRvUHJvcGVydHkobW9kZWwsIG5hbWUpOwp9LApfY29uZmlnVmFsdWU6IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkgewp0aGlzLl9jb25maWdbbmFtZV0gPSB2YWx1ZTsKfSwKX2JlZm9yZUNsaWVudHNSZWFkeTogZnVuY3Rpb24gKCkgewp0aGlzLl9jb25maWd1cmUoKTsKfSwKX2NvbmZpZ3VyZTogZnVuY3Rpb24gKCkgewp0aGlzLl9jb25maWd1cmVBbm5vdGF0aW9uUmVmZXJlbmNlcygpOwp0aGlzLl9hYm92ZUNvbmZpZyA9IHRoaXMubWl4aW4oe30sIHRoaXMuX2NvbmZpZyk7CnZhciBjb25maWcgPSB7fTsKdGhpcy5iZWhhdmlvcnMuZm9yRWFjaChmdW5jdGlvbiAoYikgewp0aGlzLl9jb25maWd1cmVQcm9wZXJ0aWVzKGIucHJvcGVydGllcywgY29uZmlnKTsKfSwgdGhpcyk7CnRoaXMuX2NvbmZpZ3VyZVByb3BlcnRpZXModGhpcy5wcm9wZXJ0aWVzLCBjb25maWcpOwp0aGlzLl9taXhpbkNvbmZpZ3VyZShjb25maWcsIHRoaXMuX2Fib3ZlQ29uZmlnKTsKdGhpcy5fY29uZmlnID0gY29uZmlnOwp0aGlzLl9kaXN0cmlidXRlQ29uZmlnKHRoaXMuX2NvbmZpZyk7Cn0sCl9jb25maWd1cmVQcm9wZXJ0aWVzOiBmdW5jdGlvbiAocHJvcGVydGllcywgY29uZmlnKSB7CmZvciAodmFyIGkgaW4gcHJvcGVydGllcykgewp2YXIgYyA9IHByb3BlcnRpZXNbaV07CmlmIChjLnZhbHVlICE9PSB1bmRlZmluZWQpIHsKdmFyIHZhbHVlID0gYy52YWx1ZTsKaWYgKHR5cGVvZiB2YWx1ZSA9PSAnZnVuY3Rpb24nKSB7CnZhbHVlID0gdmFsdWUuY2FsbCh0aGlzLCB0aGlzLl9jb25maWcpOwp9CmNvbmZpZ1tpXSA9IHZhbHVlOwp9Cn0KfSwKX21peGluQ29uZmlndXJlOiBmdW5jdGlvbiAoYSwgYikgewpmb3IgKHZhciBwcm9wIGluIGIpIHsKaWYgKCF0aGlzLmdldFByb3BlcnR5SW5mbyhwcm9wKS5yZWFkT25seSkgewphW3Byb3BdID0gYltwcm9wXTsKfQp9Cn0sCl9kaXN0cmlidXRlQ29uZmlnOiBmdW5jdGlvbiAoY29uZmlnKSB7CnZhciBmeCQgPSB0aGlzLl9wcm9wZXJ0eUVmZmVjdHM7CmlmIChmeCQpIHsKZm9yICh2YXIgcCBpbiBjb25maWcpIHsKdmFyIGZ4ID0gZngkW3BdOwppZiAoZngpIHsKZm9yICh2YXIgaSA9IDAsIGwgPSBmeC5sZW5ndGgsIHg7IGkgPCBsICYmICh4ID0gZnhbaV0pOyBpKyspIHsKaWYgKHgua2luZCA9PT0gJ2Fubm90YXRpb24nKSB7CnZhciBub2RlID0gdGhpcy5fbm9kZXNbeC5lZmZlY3QuaW5kZXhdOwppZiAobm9kZS5fY29uZmlnVmFsdWUpIHsKdmFyIHZhbHVlID0gcCA9PT0geC5lZmZlY3QudmFsdWUgPyBjb25maWdbcF0gOiB0aGlzLmdldCh4LmVmZmVjdC52YWx1ZSwgY29uZmlnKTsKbm9kZS5fY29uZmlnVmFsdWUoeC5lZmZlY3QubmFtZSwgdmFsdWUpOwp9Cn0KfQp9Cn0KfQp9LApfYWZ0ZXJDbGllbnRzUmVhZHk6IGZ1bmN0aW9uICgpIHsKdGhpcy5fZXhlY3V0ZVN0YXRpY0VmZmVjdHMoKTsKdGhpcy5fYXBwbHlDb25maWcodGhpcy5fY29uZmlnLCB0aGlzLl9hYm92ZUNvbmZpZyk7CnRoaXMuX2ZsdXNoSGFuZGxlcnMoKTsKfSwKX2FwcGx5Q29uZmlnOiBmdW5jdGlvbiAoY29uZmlnLCBhYm92ZUNvbmZpZykgewpmb3IgKHZhciBuIGluIGNvbmZpZykgewppZiAodGhpc1tuXSA9PT0gdW5kZWZpbmVkKSB7CnRoaXMuX19zZXRQcm9wZXJ0eShuLCBjb25maWdbbl0sIG4gaW4gYWJvdmVDb25maWcpOwp9Cn0KfSwKX25vdGlmeUxpc3RlbmVyOiBmdW5jdGlvbiAoZm4sIGUpIHsKaWYgKCF0aGlzLl9jbGllbnRzUmVhZGllZCkgewp0aGlzLl9xdWV1ZUhhbmRsZXIoWwpmbiwKZSwKZS50YXJnZXQKXSk7Cn0gZWxzZSB7CnJldHVybiBmbi5jYWxsKHRoaXMsIGUsIGUudGFyZ2V0KTsKfQp9LApfcXVldWVIYW5kbGVyOiBmdW5jdGlvbiAoYXJncykgewp0aGlzLl9oYW5kbGVycy5wdXNoKGFyZ3MpOwp9LApfZmx1c2hIYW5kbGVyczogZnVuY3Rpb24gKCkgewp2YXIgaCQgPSB0aGlzLl9oYW5kbGVyczsKZm9yICh2YXIgaSA9IDAsIGwgPSBoJC5sZW5ndGgsIGg7IGkgPCBsICYmIChoID0gaCRbaV0pOyBpKyspIHsKaFswXS5jYWxsKHRoaXMsIGhbMV0sIGhbMl0pOwp9CnRoaXMuX2hhbmRsZXJzID0gW107Cn0KfSk7CihmdW5jdGlvbiAoKSB7Cid1c2Ugc3RyaWN0JzsKUG9seW1lci5CYXNlLl9hZGRGZWF0dXJlKHsKbm90aWZ5UGF0aDogZnVuY3Rpb24gKHBhdGgsIHZhbHVlLCBmcm9tQWJvdmUpIHsKdmFyIG9sZCA9IHRoaXMuX3Byb3BlcnR5U2V0dGVyKHBhdGgsIHZhbHVlKTsKaWYgKG9sZCAhPT0gdmFsdWUgJiYgKG9sZCA9PT0gb2xkIHx8IHZhbHVlID09PSB2YWx1ZSkpIHsKdGhpcy5fcGF0aEVmZmVjdG9yKHBhdGgsIHZhbHVlKTsKaWYgKCFmcm9tQWJvdmUpIHsKdGhpcy5fbm90aWZ5UGF0aChwYXRoLCB2YWx1ZSk7Cn0KcmV0dXJuIHRydWU7Cn0KfSwKX2dldFBhdGhQYXJ0czogZnVuY3Rpb24gKHBhdGgpIHsKaWYgKEFycmF5LmlzQXJyYXkocGF0aCkpIHsKdmFyIHBhcnRzID0gW107CmZvciAodmFyIGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykgewp2YXIgYXJncyA9IHBhdGhbaV0udG9TdHJpbmcoKS5zcGxpdCgnLi4vZGljdGlvbmFyeS1kNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZS5udWxsJyk7CmZvciAodmFyIGogPSAwOyBqIDwgYXJncy5sZW5ndGg7IGorKykgewpwYXJ0cy5wdXNoKGFyZ3Nbal0pOwp9Cn0KcmV0dXJuIHBhcnRzOwp9IGVsc2UgewpyZXR1cm4gcGF0aC50b1N0cmluZygpLnNwbGl0KCcuLi9kaWN0aW9uYXJ5LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlLm51bGwnKTsKfQp9LApzZXQ6IGZ1bmN0aW9uIChwYXRoLCB2YWx1ZSwgcm9vdCkgewp2YXIgcHJvcCA9IHJvb3QgfHwgdGhpczsKdmFyIHBhcnRzID0gdGhpcy5fZ2V0UGF0aFBhcnRzKHBhdGgpOwp2YXIgYXJyYXk7CnZhciBsYXN0ID0gcGFydHNbcGFydHMubGVuZ3RoIC0gMV07CmlmIChwYXJ0cy5sZW5ndGggPiAxKSB7CmZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoIC0gMTsgaSsrKSB7CnZhciBwYXJ0ID0gcGFydHNbaV07CnByb3AgPSBwcm9wW3BhcnRdOwppZiAoYXJyYXkgJiYgcGFyc2VJbnQocGFydCkgPT0gcGFydCkgewpwYXJ0c1tpXSA9IFBvbHltZXIuQ29sbGVjdGlvbi5nZXQoYXJyYXkpLmdldEtleShwcm9wKTsKfQppZiAoIXByb3ApIHsKcmV0dXJuOwp9CmFycmF5ID0gQXJyYXkuaXNBcnJheShwcm9wKSA/IHByb3AgOiBudWxsOwp9CmlmIChhcnJheSAmJiBwYXJzZUludChsYXN0KSA9PSBsYXN0KSB7CnZhciBjb2xsID0gUG9seW1lci5Db2xsZWN0aW9uLmdldChhcnJheSk7CnZhciBvbGQgPSBwcm9wW2xhc3RdOwp2YXIga2V5ID0gY29sbC5nZXRLZXkob2xkKTsKcGFydHNbaV0gPSBrZXk7CmNvbGwuc2V0SXRlbShrZXksIHZhbHVlKTsKfQpwcm9wW2xhc3RdID0gdmFsdWU7CmlmICghcm9vdCkgewp0aGlzLm5vdGlmeVBhdGgocGFydHMuam9pbignLi4vZGljdGlvbmFyeS1kNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZS5udWxsJyksIHZhbHVlKTsKfQp9IGVsc2Ugewpwcm9wW3BhdGhdID0gdmFsdWU7Cn0KfSwKZ2V0OiBmdW5jdGlvbiAocGF0aCwgcm9vdCkgewp2YXIgcHJvcCA9IHJvb3QgfHwgdGhpczsKdmFyIHBhcnRzID0gdGhpcy5fZ2V0UGF0aFBhcnRzKHBhdGgpOwp2YXIgbGFzdCA9IHBhcnRzLnBvcCgpOwp3aGlsZSAocGFydHMubGVuZ3RoKSB7CnByb3AgPSBwcm9wW3BhcnRzLnNoaWZ0KCldOwppZiAoIXByb3ApIHsKcmV0dXJuOwp9Cn0KcmV0dXJuIHByb3BbbGFzdF07Cn0sCl9wYXRoRWZmZWN0b3I6IGZ1bmN0aW9uIChwYXRoLCB2YWx1ZSkgewp2YXIgbW9kZWwgPSB0aGlzLl9tb2RlbEZvclBhdGgocGF0aCk7CnZhciBmeCQgPSB0aGlzLl9wcm9wZXJ0eUVmZmVjdHNbbW9kZWxdOwppZiAoZngkKSB7CmZ4JC5mb3JFYWNoKGZ1bmN0aW9uIChmeCkgewp2YXIgZnhGbiA9IHRoaXNbJ18nICsgZngua2luZCArICdQYXRoRWZmZWN0J107CmlmIChmeEZuKSB7CmZ4Rm4uY2FsbCh0aGlzLCBwYXRoLCB2YWx1ZSwgZnguZWZmZWN0KTsKfQp9LCB0aGlzKTsKfQppZiAodGhpcy5fYm91bmRQYXRocykgewp0aGlzLl9ub3RpZnlCb3VuZFBhdGhzKHBhdGgsIHZhbHVlKTsKfQp9LApfYW5ub3RhdGlvblBhdGhFZmZlY3Q6IGZ1bmN0aW9uIChwYXRoLCB2YWx1ZSwgZWZmZWN0KSB7CmlmIChlZmZlY3QudmFsdWUgPT09IHBhdGggfHwgZWZmZWN0LnZhbHVlLmluZGV4T2YocGF0aCArICcuLi9kaWN0aW9uYXJ5LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlLm51bGwnKSA9PT0gMCkgewpQb2x5bWVyLkJpbmQuX2Fubm90YXRpb25FZmZlY3QuY2FsbCh0aGlzLCBwYXRoLCB2YWx1ZSwgZWZmZWN0KTsKfSBlbHNlIGlmIChwYXRoLmluZGV4T2YoZWZmZWN0LnZhbHVlICsgJy4uL2RpY3Rpb25hcnktZDQxZDhjZDk4ZjAwYjIwNGU5ODAwOTk4ZWNmODQyN2UubnVsbCcpID09PSAwICYmICFlZmZlY3QubmVnYXRlKSB7CnZhciBub2RlID0gdGhpcy5fbm9kZXNbZWZmZWN0LmluZGV4XTsKaWYgKG5vZGUgJiYgbm9kZS5ub3RpZnlQYXRoKSB7CnZhciBwID0gdGhpcy5fZml4UGF0aChlZmZlY3QubmFtZSwgZWZmZWN0LnZhbHVlLCBwYXRoKTsKbm9kZS5ub3RpZnlQYXRoKHAsIHZhbHVlLCB0cnVlKTsKfQp9Cn0sCl9jb21wbGV4T2JzZXJ2ZXJQYXRoRWZmZWN0OiBmdW5jdGlvbiAocGF0aCwgdmFsdWUsIGVmZmVjdCkgewppZiAodGhpcy5fcGF0aE1hdGNoZXNFZmZlY3QocGF0aCwgZWZmZWN0KSkgewpQb2x5bWVyLkJpbmQuX2NvbXBsZXhPYnNlcnZlckVmZmVjdC5jYWxsKHRoaXMsIHBhdGgsIHZhbHVlLCBlZmZlY3QpOwp9Cn0sCl9jb21wdXRlUGF0aEVmZmVjdDogZnVuY3Rpb24gKHBhdGgsIHZhbHVlLCBlZmZlY3QpIHsKaWYgKHRoaXMuX3BhdGhNYXRjaGVzRWZmZWN0KHBhdGgsIGVmZmVjdCkpIHsKUG9seW1lci5CaW5kLl9jb21wdXRlRWZmZWN0LmNhbGwodGhpcywgcGF0aCwgdmFsdWUsIGVmZmVjdCk7Cn0KfSwKX2Fubm90YXRlZENvbXB1dGF0aW9uUGF0aEVmZmVjdDogZnVuY3Rpb24gKHBhdGgsIHZhbHVlLCBlZmZlY3QpIHsKaWYgKHRoaXMuX3BhdGhNYXRjaGVzRWZmZWN0KHBhdGgsIGVmZmVjdCkpIHsKUG9seW1lci5CaW5kLl9hbm5vdGF0ZWRDb21wdXRhdGlvbkVmZmVjdC5jYWxsKHRoaXMsIHBhdGgsIHZhbHVlLCBlZmZlY3QpOwp9Cn0sCl9wYXRoTWF0Y2hlc0VmZmVjdDogZnVuY3Rpb24gKHBhdGgsIGVmZmVjdCkgewp2YXIgZWZmZWN0QXJnID0gZWZmZWN0LnRyaWdnZXIubmFtZTsKcmV0dXJuIGVmZmVjdEFyZyA9PSBwYXRoIHx8IGVmZmVjdEFyZy5pbmRleE9mKHBhdGggKyAnLi4vZGljdGlvbmFyeS1kNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZS5udWxsJykgPT09IDAgfHwgZWZmZWN0LnRyaWdnZXIud2lsZGNhcmQgJiYgcGF0aC5pbmRleE9mKGVmZmVjdEFyZykgPT09IDA7Cn0sCmxpbmtQYXRoczogZnVuY3Rpb24gKHRvLCBmcm9tKSB7CnRoaXMuX2JvdW5kUGF0aHMgPSB0aGlzLl9ib3VuZFBhdGhzIHx8IHt9OwppZiAoZnJvbSkgewp0aGlzLl9ib3VuZFBhdGhzW3RvXSA9IGZyb207Cn0gZWxzZSB7CnRoaXMudW5saW5rUGF0aHModG8pOwp9Cn0sCnVubGlua1BhdGhzOiBmdW5jdGlvbiAocGF0aCkgewppZiAodGhpcy5fYm91bmRQYXRocykgewpkZWxldGUgdGhpcy5fYm91bmRQYXRoc1twYXRoXTsKfQp9LApfbm90aWZ5Qm91bmRQYXRoczogZnVuY3Rpb24gKHBhdGgsIHZhbHVlKSB7CmZvciAodmFyIGEgaW4gdGhpcy5fYm91bmRQYXRocykgewp2YXIgYiA9IHRoaXMuX2JvdW5kUGF0aHNbYV07CmlmIChwYXRoLmluZGV4T2YoYSArICcuLi9kaWN0aW9uYXJ5LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlLm51bGwnKSA9PSAwKSB7CnRoaXMubm90aWZ5UGF0aCh0aGlzLl9maXhQYXRoKGIsIGEsIHBhdGgpLCB2YWx1ZSk7Cn0gZWxzZSBpZiAocGF0aC5pbmRleE9mKGIgKyAnLi4vZGljdGlvbmFyeS1kNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZS5udWxsJykgPT0gMCkgewp0aGlzLm5vdGlmeVBhdGgodGhpcy5fZml4UGF0aChhLCBiLCBwYXRoKSwgdmFsdWUpOwp9Cn0KfSwKX2ZpeFBhdGg6IGZ1bmN0aW9uIChwcm9wZXJ0eSwgcm9vdCwgcGF0aCkgewpyZXR1cm4gcHJvcGVydHkgKyBwYXRoLnNsaWNlKHJvb3QubGVuZ3RoKTsKfSwKX25vdGlmeVBhdGg6IGZ1bmN0aW9uIChwYXRoLCB2YWx1ZSkgewp2YXIgcm9vdE5hbWUgPSB0aGlzLl9tb2RlbEZvclBhdGgocGF0aCk7CnZhciBkYXNoQ2FzZU5hbWUgPSBQb2x5bWVyLkNhc2VNYXAuY2FtZWxUb0Rhc2hDYXNlKHJvb3ROYW1lKTsKdmFyIGV2ZW50TmFtZSA9IGRhc2hDYXNlTmFtZSArIHRoaXMuX0VWRU5UX0NIQU5HRUQ7CnRoaXMuZmlyZShldmVudE5hbWUsIHsKcGF0aDogcGF0aCwKdmFsdWU6IHZhbHVlCn0sIHsgYnViYmxlczogZmFsc2UgfSk7Cn0sCl9tb2RlbEZvclBhdGg6IGZ1bmN0aW9uIChwYXRoKSB7CnZhciBkb3QgPSBwYXRoLmluZGV4T2YoJy4uL2RpY3Rpb25hcnktZDQxZDhjZDk4ZjAwYjIwNGU5ODAwOTk4ZWNmODQyN2UubnVsbCcpOwpyZXR1cm4gZG90IDwgMCA/IHBhdGggOiBwYXRoLnNsaWNlKDAsIGRvdCk7Cn0sCl9FVkVOVF9DSEFOR0VEOiAnLWNoYW5nZWQnLApfbm90aWZ5U3BsaWNlOiBmdW5jdGlvbiAoYXJyYXksIHBhdGgsIGluZGV4LCBhZGRlZCwgcmVtb3ZlZCkgewp2YXIgc3BsaWNlcyA9IFt7CmluZGV4OiBpbmRleCwKYWRkZWRDb3VudDogYWRkZWQsCnJlbW92ZWQ6IHJlbW92ZWQsCm9iamVjdDogYXJyYXksCnR5cGU6ICdzcGxpY2UnCn1dOwp2YXIgY2hhbmdlID0gewprZXlTcGxpY2VzOiBQb2x5bWVyLkNvbGxlY3Rpb24uYXBwbHlTcGxpY2VzKGFycmF5LCBzcGxpY2VzKSwKaW5kZXhTcGxpY2VzOiBzcGxpY2VzCn07CnRoaXMuc2V0KHBhdGggKyAnLnNwbGljZXMnLCBjaGFuZ2UpOwppZiAoYWRkZWQgIT0gcmVtb3ZlZC5sZW5ndGgpIHsKdGhpcy5ub3RpZnlQYXRoKHBhdGggKyAnLmxlbmd0aCcsIGFycmF5Lmxlbmd0aCk7Cn0KY2hhbmdlLmtleVNwbGljZXMgPSBudWxsOwpjaGFuZ2UuaW5kZXhTcGxpY2VzID0gbnVsbDsKfSwKcHVzaDogZnVuY3Rpb24gKHBhdGgpIHsKdmFyIGFycmF5ID0gdGhpcy5nZXQocGF0aCk7CnZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKdmFyIGxlbiA9IGFycmF5Lmxlbmd0aDsKdmFyIHJldCA9IGFycmF5LnB1c2guYXBwbHkoYXJyYXksIGFyZ3MpOwppZiAoYXJncy5sZW5ndGgpIHsKdGhpcy5fbm90aWZ5U3BsaWNlKGFycmF5LCBwYXRoLCBsZW4sIGFyZ3MubGVuZ3RoLCBbXSk7Cn0KcmV0dXJuIHJldDsKfSwKcG9wOiBmdW5jdGlvbiAocGF0aCkgewp2YXIgYXJyYXkgPSB0aGlzLmdldChwYXRoKTsKdmFyIGhhZExlbmd0aCA9IEJvb2xlYW4oYXJyYXkubGVuZ3RoKTsKdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwp2YXIgcmV0ID0gYXJyYXkucG9wLmFwcGx5KGFycmF5LCBhcmdzKTsKaWYgKGhhZExlbmd0aCkgewp0aGlzLl9ub3RpZnlTcGxpY2UoYXJyYXksIHBhdGgsIGFycmF5Lmxlbmd0aCwgMCwgW3JldF0pOwp9CnJldHVybiByZXQ7Cn0sCnNwbGljZTogZnVuY3Rpb24gKHBhdGgsIHN0YXJ0LCBkZWxldGVDb3VudCkgewp2YXIgYXJyYXkgPSB0aGlzLmdldChwYXRoKTsKaWYgKHN0YXJ0IDwgMCkgewpzdGFydCA9IGFycmF5Lmxlbmd0aCAtIE1hdGguZmxvb3IoLXN0YXJ0KTsKfSBlbHNlIHsKc3RhcnQgPSBNYXRoLmZsb29yKHN0YXJ0KTsKfQppZiAoIXN0YXJ0KSB7CnN0YXJ0ID0gMDsKfQp2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CnZhciByZXQgPSBhcnJheS5zcGxpY2UuYXBwbHkoYXJyYXksIGFyZ3MpOwp2YXIgYWRkZWRDb3VudCA9IE1hdGgubWF4KGFyZ3MubGVuZ3RoIC0gMiwgMCk7CmlmIChhZGRlZENvdW50IHx8IHJldC5sZW5ndGgpIHsKdGhpcy5fbm90aWZ5U3BsaWNlKGFycmF5LCBwYXRoLCBzdGFydCwgYWRkZWRDb3VudCwgcmV0KTsKfQpyZXR1cm4gcmV0Owp9LApzaGlmdDogZnVuY3Rpb24gKHBhdGgpIHsKdmFyIGFycmF5ID0gdGhpcy5nZXQocGF0aCk7CnZhciBoYWRMZW5ndGggPSBCb29sZWFuKGFycmF5Lmxlbmd0aCk7CnZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKdmFyIHJldCA9IGFycmF5LnNoaWZ0LmFwcGx5KGFycmF5LCBhcmdzKTsKaWYgKGhhZExlbmd0aCkgewp0aGlzLl9ub3RpZnlTcGxpY2UoYXJyYXksIHBhdGgsIDAsIDAsIFtyZXRdKTsKfQpyZXR1cm4gcmV0Owp9LAp1bnNoaWZ0OiBmdW5jdGlvbiAocGF0aCkgewp2YXIgYXJyYXkgPSB0aGlzLmdldChwYXRoKTsKdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwp2YXIgcmV0ID0gYXJyYXkudW5zaGlmdC5hcHBseShhcnJheSwgYXJncyk7CmlmIChhcmdzLmxlbmd0aCkgewp0aGlzLl9ub3RpZnlTcGxpY2UoYXJyYXksIHBhdGgsIDAsIGFyZ3MubGVuZ3RoLCBbXSk7Cn0KcmV0dXJuIHJldDsKfSwKcHJlcGFyZU1vZGVsTm90aWZ5UGF0aDogZnVuY3Rpb24gKG1vZGVsKSB7CnRoaXMubWl4aW4obW9kZWwsIHsKZmlyZTogUG9seW1lci5CYXNlLmZpcmUsCm5vdGlmeVBhdGg6IFBvbHltZXIuQmFzZS5ub3RpZnlQYXRoLApfRVZFTlRfQ0hBTkdFRDogUG9seW1lci5CYXNlLl9FVkVOVF9DSEFOR0VELApfbm90aWZ5UGF0aDogUG9seW1lci5CYXNlLl9ub3RpZnlQYXRoLApfcGF0aEVmZmVjdG9yOiBQb2x5bWVyLkJhc2UuX3BhdGhFZmZlY3RvciwKX2Fubm90YXRpb25QYXRoRWZmZWN0OiBQb2x5bWVyLkJhc2UuX2Fubm90YXRpb25QYXRoRWZmZWN0LApfY29tcGxleE9ic2VydmVyUGF0aEVmZmVjdDogUG9seW1lci5CYXNlLl9jb21wbGV4T2JzZXJ2ZXJQYXRoRWZmZWN0LApfYW5ub3RhdGVkQ29tcHV0YXRpb25QYXRoRWZmZWN0OiBQb2x5bWVyLkJhc2UuX2Fubm90YXRlZENvbXB1dGF0aW9uUGF0aEVmZmVjdCwKX2NvbXB1dGVQYXRoRWZmZWN0OiBQb2x5bWVyLkJhc2UuX2NvbXB1dGVQYXRoRWZmZWN0LApfbW9kZWxGb3JQYXRoOiBQb2x5bWVyLkJhc2UuX21vZGVsRm9yUGF0aCwKX3BhdGhNYXRjaGVzRWZmZWN0OiBQb2x5bWVyLkJhc2UuX3BhdGhNYXRjaGVzRWZmZWN0LApfbm90aWZ5Qm91bmRQYXRoczogUG9seW1lci5CYXNlLl9ub3RpZnlCb3VuZFBhdGhzCn0pOwp9Cn0pOwp9KCkpOwpQb2x5bWVyLkJhc2UuX2FkZEZlYXR1cmUoewpyZXNvbHZlVXJsOiBmdW5jdGlvbiAodXJsKSB7CnZhciBtb2R1bGUgPSBQb2x5bWVyLkRvbU1vZHVsZS5pbXBvcnQodGhpcy5pcyk7CnZhciByb290ID0gJyc7CmlmIChtb2R1bGUpIHsKdmFyIGFzc2V0UGF0aCA9IG1vZHVsZS5nZXRBdHRyaWJ1dGUoJ2Fzc2V0cGF0aCcpIHx8ICcnOwpyb290ID0gUG9seW1lci5SZXNvbHZlVXJsLnJlc29sdmVVcmwoYXNzZXRQYXRoLCBtb2R1bGUub3duZXJEb2N1bWVudC5iYXNlVVJJKTsKfQpyZXR1cm4gUG9seW1lci5SZXNvbHZlVXJsLnJlc29sdmVVcmwodXJsLCByb290KTsKfQp9KTsKUG9seW1lci5Dc3NQYXJzZSA9IGZ1bmN0aW9uICgpIHsKdmFyIGFwaSA9IHsKcGFyc2U6IGZ1bmN0aW9uICh0ZXh0KSB7CnRleHQgPSB0aGlzLl9jbGVhbih0ZXh0KTsKcmV0dXJuIHRoaXMuX3BhcnNlQ3NzKHRoaXMuX2xleCh0ZXh0KSwgdGV4dCk7Cn0sCl9jbGVhbjogZnVuY3Rpb24gKGNzc1RleHQpIHsKcmV0dXJuIGNzc1RleHQucmVwbGFjZSh0aGlzLl9yeC5jb21tZW50cywgJycpLnJlcGxhY2UodGhpcy5fcngucG9ydCwgJycpOwp9LApfbGV4OiBmdW5jdGlvbiAodGV4dCkgewp2YXIgcm9vdCA9IHsKc3RhcnQ6IDAsCmVuZDogdGV4dC5sZW5ndGgKfTsKdmFyIG4gPSByb290Owpmb3IgKHZhciBpID0gMCwgcyA9IDAsIGwgPSB0ZXh0Lmxlbmd0aDsgaSA8IGw7IGkrKykgewpzd2l0Y2ggKHRleHRbaV0pIHsKY2FzZSB0aGlzLk9QRU5fQlJBQ0U6CmlmICghbi5ydWxlcykgewpuLnJ1bGVzID0gW107Cn0KdmFyIHAgPSBuOwp2YXIgcHJldmlvdXMgPSBwLnJ1bGVzW3AucnVsZXMubGVuZ3RoIC0gMV07Cm4gPSB7CnN0YXJ0OiBpICsgMSwKcGFyZW50OiBwLApwcmV2aW91czogcHJldmlvdXMKfTsKcC5ydWxlcy5wdXNoKG4pOwpicmVhazsKY2FzZSB0aGlzLkNMT1NFX0JSQUNFOgpuLmVuZCA9IGkgKyAxOwpuID0gbi5wYXJlbnQgfHwgcm9vdDsKYnJlYWs7Cn0KfQpyZXR1cm4gcm9vdDsKfSwKX3BhcnNlQ3NzOiBmdW5jdGlvbiAobm9kZSwgdGV4dCkgewp2YXIgdCA9IHRleHQuc3Vic3RyaW5nKG5vZGUuc3RhcnQsIG5vZGUuZW5kIC0gMSk7Cm5vZGUucGFyc2VkQ3NzVGV4dCA9IG5vZGUuY3NzVGV4dCA9IHQudHJpbSgpOwppZiAobm9kZS5wYXJlbnQpIHsKdmFyIHNzID0gbm9kZS5wcmV2aW91cyA/IG5vZGUucHJldmlvdXMuZW5kIDogbm9kZS5wYXJlbnQuc3RhcnQ7CnQgPSB0ZXh0LnN1YnN0cmluZyhzcywgbm9kZS5zdGFydCAtIDEpOwp0ID0gdC5zdWJzdHJpbmcodC5sYXN0SW5kZXhPZignOycpICsgMSk7CnZhciBzID0gbm9kZS5wYXJzZWRTZWxlY3RvciA9IG5vZGUuc2VsZWN0b3IgPSB0LnRyaW0oKTsKbm9kZS5hdFJ1bGUgPSBzLmluZGV4T2YodGhpcy5BVF9TVEFSVCkgPT09IDA7CmlmIChub2RlLmF0UnVsZSkgewppZiAocy5pbmRleE9mKHRoaXMuTUVESUFfU1RBUlQpID09PSAwKSB7Cm5vZGUudHlwZSA9IHRoaXMudHlwZXMuTUVESUFfUlVMRTsKfSBlbHNlIGlmIChzLm1hdGNoKHRoaXMuX3J4LmtleWZyYW1lc1J1bGUpKSB7Cm5vZGUudHlwZSA9IHRoaXMudHlwZXMuS0VZRlJBTUVTX1JVTEU7Cn0KfSBlbHNlIHsKaWYgKHMuaW5kZXhPZih0aGlzLlZBUl9TVEFSVCkgPT09IDApIHsKbm9kZS50eXBlID0gdGhpcy50eXBlcy5NSVhJTl9SVUxFOwp9IGVsc2Ugewpub2RlLnR5cGUgPSB0aGlzLnR5cGVzLlNUWUxFX1JVTEU7Cn0KfQp9CnZhciByJCA9IG5vZGUucnVsZXM7CmlmIChyJCkgewpmb3IgKHZhciBpID0gMCwgbCA9IHIkLmxlbmd0aCwgcjsgaSA8IGwgJiYgKHIgPSByJFtpXSk7IGkrKykgewp0aGlzLl9wYXJzZUNzcyhyLCB0ZXh0KTsKfQp9CnJldHVybiBub2RlOwp9LApzdHJpbmdpZnk6IGZ1bmN0aW9uIChub2RlLCBwcmVzZXJ2ZVByb3BlcnRpZXMsIHRleHQpIHsKdGV4dCA9IHRleHQgfHwgJyc7CnZhciBjc3NUZXh0ID0gJyc7CmlmIChub2RlLmNzc1RleHQgfHwgbm9kZS5ydWxlcykgewp2YXIgciQgPSBub2RlLnJ1bGVzOwppZiAociQgJiYgKHByZXNlcnZlUHJvcGVydGllcyB8fCAhdGhpcy5faGFzTWl4aW5SdWxlcyhyJCkpKSB7CmZvciAodmFyIGkgPSAwLCBsID0gciQubGVuZ3RoLCByOyBpIDwgbCAmJiAociA9IHIkW2ldKTsgaSsrKSB7CmNzc1RleHQgPSB0aGlzLnN0cmluZ2lmeShyLCBwcmVzZXJ2ZVByb3BlcnRpZXMsIGNzc1RleHQpOwp9Cn0gZWxzZSB7CmNzc1RleHQgPSBwcmVzZXJ2ZVByb3BlcnRpZXMgPyBub2RlLmNzc1RleHQgOiB0aGlzLnJlbW92ZUN1c3RvbVByb3BzKG5vZGUuY3NzVGV4dCk7CmNzc1RleHQgPSBjc3NUZXh0LnRyaW0oKTsKaWYgKGNzc1RleHQpIHsKY3NzVGV4dCA9ICcgICcgKyBjc3NUZXh0ICsgJ1xuJzsKfQp9Cn0KaWYgKGNzc1RleHQpIHsKaWYgKG5vZGUuc2VsZWN0b3IpIHsKdGV4dCArPSBub2RlLnNlbGVjdG9yICsgJyAnICsgdGhpcy5PUEVOX0JSQUNFICsgJ1xuJzsKfQp0ZXh0ICs9IGNzc1RleHQ7CmlmIChub2RlLnNlbGVjdG9yKSB7CnRleHQgKz0gdGhpcy5DTE9TRV9CUkFDRSArICdcblxuJzsKfQp9CnJldHVybiB0ZXh0Owp9LApfaGFzTWl4aW5SdWxlczogZnVuY3Rpb24gKHJ1bGVzKSB7CnJldHVybiBydWxlc1swXS5zZWxlY3Rvci5pbmRleE9mKHRoaXMuVkFSX1NUQVJUKSA+PSAwOwp9LApyZW1vdmVDdXN0b21Qcm9wczogZnVuY3Rpb24gKGNzc1RleHQpIHsKY3NzVGV4dCA9IHRoaXMucmVtb3ZlQ3VzdG9tUHJvcEFzc2lnbm1lbnQoY3NzVGV4dCk7CnJldHVybiB0aGlzLnJlbW92ZUN1c3RvbVByb3BBcHBseShjc3NUZXh0KTsKfSwKcmVtb3ZlQ3VzdG9tUHJvcEFzc2lnbm1lbnQ6IGZ1bmN0aW9uIChjc3NUZXh0KSB7CnJldHVybiBjc3NUZXh0LnJlcGxhY2UodGhpcy5fcnguY3VzdG9tUHJvcCwgJycpLnJlcGxhY2UodGhpcy5fcngubWl4aW5Qcm9wLCAnJyk7Cn0sCnJlbW92ZUN1c3RvbVByb3BBcHBseTogZnVuY3Rpb24gKGNzc1RleHQpIHsKcmV0dXJuIGNzc1RleHQucmVwbGFjZSh0aGlzLl9yeC5taXhpbkFwcGx5LCAnJykucmVwbGFjZSh0aGlzLl9yeC52YXJBcHBseSwgJycpOwp9LAp0eXBlczogewpTVFlMRV9SVUxFOiAxLApLRVlGUkFNRVNfUlVMRTogNywKTUVESUFfUlVMRTogNCwKTUlYSU5fUlVMRTogMTAwMAp9LApPUEVOX0JSQUNFOiAneycsCkNMT1NFX0JSQUNFOiAnfScsCl9yeDogewpjb21tZW50czogL1wvXCpbXipdKlwqKyhbXlwvKl1bXipdKlwqKykqXC8vZ2ltLApwb3J0OiAvQGltcG9ydFteO10qOy9naW0sCmN1c3RvbVByb3A6IC8oPzpefFtccztdKS0tW147e10qPzpbXnt9O10qPyg/Ols7XG5dfCQpL2dpbSwKbWl4aW5Qcm9wOiAvKD86XnxbXHM7XSktLVteO3tdKj86W157O10qP3tbXn1dKj99KD86Wztcbl18JCk/L2dpbSwKbWl4aW5BcHBseTogL0BhcHBseVtcc10qXChbXildKj9cKVtcc10qKD86Wztcbl18JCk/L2dpbSwKdmFyQXBwbHk6IC9bXjs6XSo/OlteO10qdmFyW147XSooPzpbO1xuXXwkKT8vZ2ltLAprZXlmcmFtZXNSdWxlOiAvXkBbXlxzXSprZXlmcmFtZXMvCn0sClZBUl9TVEFSVDogJy0tJywKTUVESUFfU1RBUlQ6ICdAbWVkaWEnLApBVF9TVEFSVDogJ0AnCn07CnJldHVybiBhcGk7Cn0oKTsKUG9seW1lci5TdHlsZVV0aWwgPSBmdW5jdGlvbiAoKSB7CnJldHVybiB7Ck1PRFVMRV9TVFlMRVNfU0VMRUNUT1I6ICdzdHlsZSwgbGlua1tyZWw9aW1wb3J0XVt0eXBlfj1jc3NdLCB0ZW1wbGF0ZScsCklOQ0xVREVfQVRUUjogJ2luY2x1ZGUnLAp0b0Nzc1RleHQ6IGZ1bmN0aW9uIChydWxlcywgY2FsbGJhY2ssIHByZXNlcnZlUHJvcGVydGllcykgewppZiAodHlwZW9mIHJ1bGVzID09PSAnc3RyaW5nJykgewpydWxlcyA9IHRoaXMucGFyc2VyLnBhcnNlKHJ1bGVzKTsKfQppZiAoY2FsbGJhY2spIHsKdGhpcy5mb3JFYWNoU3R5bGVSdWxlKHJ1bGVzLCBjYWxsYmFjayk7Cn0KcmV0dXJuIHRoaXMucGFyc2VyLnN0cmluZ2lmeShydWxlcywgcHJlc2VydmVQcm9wZXJ0aWVzKTsKfSwKZm9yUnVsZXNJblN0eWxlczogZnVuY3Rpb24gKHN0eWxlcywgY2FsbGJhY2spIHsKaWYgKHN0eWxlcykgewpmb3IgKHZhciBpID0gMCwgbCA9IHN0eWxlcy5sZW5ndGgsIHM7IGkgPCBsICYmIChzID0gc3R5bGVzW2ldKTsgaSsrKSB7CnRoaXMuZm9yRWFjaFN0eWxlUnVsZSh0aGlzLnJ1bGVzRm9yU3R5bGUocyksIGNhbGxiYWNrKTsKfQp9Cn0sCnJ1bGVzRm9yU3R5bGU6IGZ1bmN0aW9uIChzdHlsZSkgewppZiAoIXN0eWxlLl9fY3NzUnVsZXMgJiYgc3R5bGUudGV4dENvbnRlbnQpIHsKc3R5bGUuX19jc3NSdWxlcyA9IHRoaXMucGFyc2VyLnBhcnNlKHN0eWxlLnRleHRDb250ZW50KTsKfQpyZXR1cm4gc3R5bGUuX19jc3NSdWxlczsKfSwKY2xlYXJTdHlsZVJ1bGVzOiBmdW5jdGlvbiAoc3R5bGUpIHsKc3R5bGUuX19jc3NSdWxlcyA9IG51bGw7Cn0sCmZvckVhY2hTdHlsZVJ1bGU6IGZ1bmN0aW9uIChub2RlLCBjYWxsYmFjaykgewppZiAoIW5vZGUpIHsKcmV0dXJuOwp9CnZhciBzID0gbm9kZS5wYXJzZWRTZWxlY3RvcjsKdmFyIHNraXBSdWxlcyA9IGZhbHNlOwppZiAobm9kZS50eXBlID09PSB0aGlzLnJ1bGVUeXBlcy5TVFlMRV9SVUxFKSB7CmNhbGxiYWNrKG5vZGUpOwp9IGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gdGhpcy5ydWxlVHlwZXMuS0VZRlJBTUVTX1JVTEUgfHwgbm9kZS50eXBlID09PSB0aGlzLnJ1bGVUeXBlcy5NSVhJTl9SVUxFKSB7CnNraXBSdWxlcyA9IHRydWU7Cn0KdmFyIHIkID0gbm9kZS5ydWxlczsKaWYgKHIkICYmICFza2lwUnVsZXMpIHsKZm9yICh2YXIgaSA9IDAsIGwgPSByJC5sZW5ndGgsIHI7IGkgPCBsICYmIChyID0gciRbaV0pOyBpKyspIHsKdGhpcy5mb3JFYWNoU3R5bGVSdWxlKHIsIGNhbGxiYWNrKTsKfQp9Cn0sCmFwcGx5Q3NzOiBmdW5jdGlvbiAoY3NzVGV4dCwgbW9uaWtlciwgdGFyZ2V0LCBhZnRlck5vZGUpIHsKdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKaWYgKG1vbmlrZXIpIHsKc3R5bGUuc2V0QXR0cmlidXRlKCdzY29wZScsIG1vbmlrZXIpOwp9CnN0eWxlLnRleHRDb250ZW50ID0gY3NzVGV4dDsKdGFyZ2V0ID0gdGFyZ2V0IHx8IGRvY3VtZW50LmhlYWQ7CmlmICghYWZ0ZXJOb2RlKSB7CnZhciBuJCA9IHRhcmdldC5xdWVyeVNlbGVjdG9yQWxsKCdzdHlsZVtzY29wZV0nKTsKYWZ0ZXJOb2RlID0gbiRbbiQubGVuZ3RoIC0gMV07Cn0KdGFyZ2V0Lmluc2VydEJlZm9yZShzdHlsZSwgYWZ0ZXJOb2RlICYmIGFmdGVyTm9kZS5uZXh0U2libGluZyB8fCB0YXJnZXQuZmlyc3RDaGlsZCk7CnJldHVybiBzdHlsZTsKfSwKY3NzRnJvbU1vZHVsZXM6IGZ1bmN0aW9uIChtb2R1bGVJZHMsIHdhcm5JZk5vdEZvdW5kKSB7CnZhciBtb2R1bGVzID0gbW9kdWxlSWRzLnRyaW0oKS5zcGxpdCgnICcpOwp2YXIgY3NzVGV4dCA9ICcnOwpmb3IgKHZhciBpID0gMDsgaSA8IG1vZHVsZXMubGVuZ3RoOyBpKyspIHsKY3NzVGV4dCArPSB0aGlzLmNzc0Zyb21Nb2R1bGUobW9kdWxlc1tpXSwgd2FybklmTm90Rm91bmQpOwp9CnJldHVybiBjc3NUZXh0Owp9LApjc3NGcm9tTW9kdWxlOiBmdW5jdGlvbiAobW9kdWxlSWQsIHdhcm5JZk5vdEZvdW5kKSB7CnZhciBtID0gUG9seW1lci5Eb21Nb2R1bGUuaW1wb3J0KG1vZHVsZUlkKTsKaWYgKG0gJiYgIW0uX2Nzc1RleHQpIHsKbS5fY3NzVGV4dCA9IHRoaXMuX2Nzc0Zyb21FbGVtZW50KG0pOwp9CmlmICghbSAmJiB3YXJuSWZOb3RGb3VuZCkgewpjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBmaW5kIHN0eWxlIGRhdGEgaW4gbW9kdWxlIG5hbWVkJywgbW9kdWxlSWQpOwp9CnJldHVybiBtICYmIG0uX2Nzc1RleHQgfHwgJyc7Cn0sCl9jc3NGcm9tRWxlbWVudDogZnVuY3Rpb24gKGVsZW1lbnQpIHsKdmFyIGNzc1RleHQgPSAnJzsKdmFyIGNvbnRlbnQgPSBlbGVtZW50LmNvbnRlbnQgfHwgZWxlbWVudDsKdmFyIGUkID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoY29udGVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuTU9EVUxFX1NUWUxFU19TRUxFQ1RPUikpOwpmb3IgKHZhciBpID0gMCwgZTsgaSA8IGUkLmxlbmd0aDsgaSsrKSB7CmUgPSBlJFtpXTsKaWYgKGUubG9jYWxOYW1lID09PSAndGVtcGxhdGUnKSB7CmNzc1RleHQgKz0gdGhpcy5fY3NzRnJvbUVsZW1lbnQoZSk7Cn0gZWxzZSB7CmlmIChlLmxvY2FsTmFtZSA9PT0gJ3N0eWxlJykgewp2YXIgaW5jbHVkZSA9IGUuZ2V0QXR0cmlidXRlKHRoaXMuSU5DTFVERV9BVFRSKTsKaWYgKGluY2x1ZGUpIHsKY3NzVGV4dCArPSB0aGlzLmNzc0Zyb21Nb2R1bGVzKGluY2x1ZGUsIHRydWUpOwp9CmUgPSBlLl9fYXBwbGllZEVsZW1lbnQgfHwgZTsKZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGUpOwpjc3NUZXh0ICs9IHRoaXMucmVzb2x2ZUNzcyhlLnRleHRDb250ZW50LCBlbGVtZW50Lm93bmVyRG9jdW1lbnQpOwp9IGVsc2UgaWYgKGUuaW1wb3J0ICYmIGUuaW1wb3J0LmJvZHkpIHsKY3NzVGV4dCArPSB0aGlzLnJlc29sdmVDc3MoZS5pbXBvcnQuYm9keS50ZXh0Q29udGVudCwgZS5pbXBvcnQpOwp9Cn0KfQpyZXR1cm4gY3NzVGV4dDsKfSwKcmVzb2x2ZUNzczogUG9seW1lci5SZXNvbHZlVXJsLnJlc29sdmVDc3MsCnBhcnNlcjogUG9seW1lci5Dc3NQYXJzZSwKcnVsZVR5cGVzOiBQb2x5bWVyLkNzc1BhcnNlLnR5cGVzCn07Cn0oKTsKUG9seW1lci5TdHlsZVRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKCkgewp2YXIgbmF0aXZlU2hhZG93ID0gUG9seW1lci5TZXR0aW5ncy51c2VOYXRpdmVTaGFkb3c7CnZhciBzdHlsZVV0aWwgPSBQb2x5bWVyLlN0eWxlVXRpbDsKdmFyIGFwaSA9IHsKZG9tOiBmdW5jdGlvbiAobm9kZSwgc2NvcGUsIHVzZUF0dHIsIHNob3VsZFJlbW92ZVNjb3BlKSB7CnRoaXMuX3RyYW5zZm9ybURvbShub2RlLCBzY29wZSB8fCAnJywgdXNlQXR0ciwgc2hvdWxkUmVtb3ZlU2NvcGUpOwp9LApfdHJhbnNmb3JtRG9tOiBmdW5jdGlvbiAobm9kZSwgc2VsZWN0b3IsIHVzZUF0dHIsIHNob3VsZFJlbW92ZVNjb3BlKSB7CmlmIChub2RlLnNldEF0dHJpYnV0ZSkgewp0aGlzLmVsZW1lbnQobm9kZSwgc2VsZWN0b3IsIHVzZUF0dHIsIHNob3VsZFJlbW92ZVNjb3BlKTsKfQp2YXIgYyQgPSBQb2x5bWVyLmRvbShub2RlKS5jaGlsZE5vZGVzOwpmb3IgKHZhciBpID0gMDsgaSA8IGMkLmxlbmd0aDsgaSsrKSB7CnRoaXMuX3RyYW5zZm9ybURvbShjJFtpXSwgc2VsZWN0b3IsIHVzZUF0dHIsIHNob3VsZFJlbW92ZVNjb3BlKTsKfQp9LAplbGVtZW50OiBmdW5jdGlvbiAoZWxlbWVudCwgc2NvcGUsIHVzZUF0dHIsIHNob3VsZFJlbW92ZVNjb3BlKSB7CmlmICh1c2VBdHRyKSB7CmlmIChzaG91bGRSZW1vdmVTY29wZSkgewplbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShTQ09QRV9OQU1FKTsKfSBlbHNlIHsKZWxlbWVudC5zZXRBdHRyaWJ1dGUoU0NPUEVfTkFNRSwgc2NvcGUpOwp9Cn0gZWxzZSB7CmlmIChzY29wZSkgewppZiAoZWxlbWVudC5jbGFzc0xpc3QpIHsKaWYgKHNob3VsZFJlbW92ZVNjb3BlKSB7CmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShTQ09QRV9OQU1FKTsKZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNjb3BlKTsKfSBlbHNlIHsKZWxlbWVudC5jbGFzc0xpc3QuYWRkKFNDT1BFX05BTUUpOwplbGVtZW50LmNsYXNzTGlzdC5hZGQoc2NvcGUpOwp9Cn0gZWxzZSBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUpIHsKdmFyIGMgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShDTEFTUyk7CmlmIChzaG91bGRSZW1vdmVTY29wZSkgewppZiAoYykgewplbGVtZW50LnNldEF0dHJpYnV0ZShDTEFTUywgYy5yZXBsYWNlKFNDT1BFX05BTUUsICcnKS5yZXBsYWNlKHNjb3BlLCAnJykpOwp9Cn0gZWxzZSB7CmVsZW1lbnQuc2V0QXR0cmlidXRlKENMQVNTLCBjICsgKGMgPyAnICcgOiAnJykgKyBTQ09QRV9OQU1FICsgJyAnICsgc2NvcGUpOwp9Cn0KfQp9Cn0sCmVsZW1lbnRTdHlsZXM6IGZ1bmN0aW9uIChlbGVtZW50LCBjYWxsYmFjaykgewp2YXIgc3R5bGVzID0gZWxlbWVudC5fc3R5bGVzOwp2YXIgY3NzVGV4dCA9ICcnOwpmb3IgKHZhciBpID0gMCwgbCA9IHN0eWxlcy5sZW5ndGgsIHMsIHRleHQ7IGkgPCBsICYmIChzID0gc3R5bGVzW2ldKTsgaSsrKSB7CnZhciBydWxlcyA9IHN0eWxlVXRpbC5ydWxlc0ZvclN0eWxlKHMpOwpjc3NUZXh0ICs9IG5hdGl2ZVNoYWRvdyA/IHN0eWxlVXRpbC50b0Nzc1RleHQocnVsZXMsIGNhbGxiYWNrKSA6IHRoaXMuY3NzKHJ1bGVzLCBlbGVtZW50LmlzLCBlbGVtZW50LmV4dGVuZHMsIGNhbGxiYWNrLCBlbGVtZW50Ll9zY29wZUNzc1ZpYUF0dHIpICsgJ1xuXG4nOwp9CnJldHVybiBjc3NUZXh0LnRyaW0oKTsKfSwKY3NzOiBmdW5jdGlvbiAocnVsZXMsIHNjb3BlLCBleHQsIGNhbGxiYWNrLCB1c2VBdHRyKSB7CnZhciBob3N0U2NvcGUgPSB0aGlzLl9jYWxjSG9zdFNjb3BlKHNjb3BlLCBleHQpOwpzY29wZSA9IHRoaXMuX2NhbGNFbGVtZW50U2NvcGUoc2NvcGUsIHVzZUF0dHIpOwp2YXIgc2VsZiA9IHRoaXM7CnJldHVybiBzdHlsZVV0aWwudG9Dc3NUZXh0KHJ1bGVzLCBmdW5jdGlvbiAocnVsZSkgewppZiAoIXJ1bGUuaXNTY29wZWQpIHsKc2VsZi5ydWxlKHJ1bGUsIHNjb3BlLCBob3N0U2NvcGUpOwpydWxlLmlzU2NvcGVkID0gdHJ1ZTsKfQppZiAoY2FsbGJhY2spIHsKY2FsbGJhY2socnVsZSwgc2NvcGUsIGhvc3RTY29wZSk7Cn0KfSk7Cn0sCl9jYWxjRWxlbWVudFNjb3BlOiBmdW5jdGlvbiAoc2NvcGUsIHVzZUF0dHIpIHsKaWYgKHNjb3BlKSB7CnJldHVybiB1c2VBdHRyID8gQ1NTX0FUVFJfUFJFRklYICsgc2NvcGUgKyBDU1NfQVRUUl9TVUZGSVggOiBDU1NfQ0xBU1NfUFJFRklYICsgc2NvcGU7Cn0gZWxzZSB7CnJldHVybiAnJzsKfQp9LApfY2FsY0hvc3RTY29wZTogZnVuY3Rpb24gKHNjb3BlLCBleHQpIHsKcmV0dXJuIGV4dCA/ICdbaXM9JyArIHNjb3BlICsgJ10nIDogc2NvcGU7Cn0sCnJ1bGU6IGZ1bmN0aW9uIChydWxlLCBzY29wZSwgaG9zdFNjb3BlKSB7CnRoaXMuX3RyYW5zZm9ybVJ1bGUocnVsZSwgdGhpcy5fdHJhbnNmb3JtQ29tcGxleFNlbGVjdG9yLCBzY29wZSwgaG9zdFNjb3BlKTsKfSwKX3RyYW5zZm9ybVJ1bGU6IGZ1bmN0aW9uIChydWxlLCB0cmFuc2Zvcm1lciwgc2NvcGUsIGhvc3RTY29wZSkgewp2YXIgcCQgPSBydWxlLnNlbGVjdG9yLnNwbGl0KENPTVBMRVhfU0VMRUNUT1JfU0VQKTsKZm9yICh2YXIgaSA9IDAsIGwgPSBwJC5sZW5ndGgsIHA7IGkgPCBsICYmIChwID0gcCRbaV0pOyBpKyspIHsKcCRbaV0gPSB0cmFuc2Zvcm1lci5jYWxsKHRoaXMsIHAsIHNjb3BlLCBob3N0U2NvcGUpOwp9CnJ1bGUuc2VsZWN0b3IgPSBydWxlLnRyYW5zZm9ybWVkU2VsZWN0b3IgPSBwJC5qb2luKENPTVBMRVhfU0VMRUNUT1JfU0VQKTsKfSwKX3RyYW5zZm9ybUNvbXBsZXhTZWxlY3RvcjogZnVuY3Rpb24gKHNlbGVjdG9yLCBzY29wZSwgaG9zdFNjb3BlKSB7CnZhciBzdG9wID0gZmFsc2U7CnZhciBob3N0Q29udGV4dCA9IGZhbHNlOwp2YXIgc2VsZiA9IHRoaXM7CnNlbGVjdG9yID0gc2VsZWN0b3IucmVwbGFjZShTSU1QTEVfU0VMRUNUT1JfU0VQLCBmdW5jdGlvbiAobSwgYywgcykgewppZiAoIXN0b3ApIHsKdmFyIGluZm8gPSBzZWxmLl90cmFuc2Zvcm1Db21wb3VuZFNlbGVjdG9yKHMsIGMsIHNjb3BlLCBob3N0U2NvcGUpOwpzdG9wID0gc3RvcCB8fCBpbmZvLnN0b3A7Cmhvc3RDb250ZXh0ID0gaG9zdENvbnRleHQgfHwgaW5mby5ob3N0Q29udGV4dDsKYyA9IGluZm8uY29tYmluYXRvcjsKcyA9IGluZm8udmFsdWU7Cn0gZWxzZSB7CnMgPSBzLnJlcGxhY2UoU0NPUEVfSlVNUCwgJyAnKTsKfQpyZXR1cm4gYyArIHM7Cn0pOwppZiAoaG9zdENvbnRleHQpIHsKc2VsZWN0b3IgPSBzZWxlY3Rvci5yZXBsYWNlKEhPU1RfQ09OVEVYVF9QQVJFTiwgZnVuY3Rpb24gKG0sIHByZSwgcGFyZW4sIHBvc3QpIHsKcmV0dXJuIHByZSArIHBhcmVuICsgJyAnICsgaG9zdFNjb3BlICsgcG9zdCArIENPTVBMRVhfU0VMRUNUT1JfU0VQICsgJyAnICsgcHJlICsgaG9zdFNjb3BlICsgcGFyZW4gKyBwb3N0Owp9KTsKfQpyZXR1cm4gc2VsZWN0b3I7Cn0sCl90cmFuc2Zvcm1Db21wb3VuZFNlbGVjdG9yOiBmdW5jdGlvbiAoc2VsZWN0b3IsIGNvbWJpbmF0b3IsIHNjb3BlLCBob3N0U2NvcGUpIHsKdmFyIGp1bXBJbmRleCA9IHNlbGVjdG9yLnNlYXJjaChTQ09QRV9KVU1QKTsKdmFyIGhvc3RDb250ZXh0ID0gZmFsc2U7CmlmIChzZWxlY3Rvci5pbmRleE9mKEhPU1RfQ09OVEVYVCkgPj0gMCkgewpob3N0Q29udGV4dCA9IHRydWU7Cn0gZWxzZSBpZiAoc2VsZWN0b3IuaW5kZXhPZihIT1NUKSA+PSAwKSB7CnNlbGVjdG9yID0gc2VsZWN0b3IucmVwbGFjZShIT1NUX1BBUkVOLCBmdW5jdGlvbiAobSwgaG9zdCwgcGFyZW4pIHsKcmV0dXJuIGhvc3RTY29wZSArIHBhcmVuOwp9KTsKc2VsZWN0b3IgPSBzZWxlY3Rvci5yZXBsYWNlKEhPU1QsIGhvc3RTY29wZSk7Cn0gZWxzZSBpZiAoanVtcEluZGV4ICE9PSAwKSB7CnNlbGVjdG9yID0gc2NvcGUgPyB0aGlzLl90cmFuc2Zvcm1TaW1wbGVTZWxlY3RvcihzZWxlY3Rvciwgc2NvcGUpIDogc2VsZWN0b3I7Cn0KaWYgKHNlbGVjdG9yLmluZGV4T2YoQ09OVEVOVCkgPj0gMCkgewpjb21iaW5hdG9yID0gJyc7Cn0KdmFyIHN0b3A7CmlmIChqdW1wSW5kZXggPj0gMCkgewpzZWxlY3RvciA9IHNlbGVjdG9yLnJlcGxhY2UoU0NPUEVfSlVNUCwgJyAnKTsKc3RvcCA9IHRydWU7Cn0KcmV0dXJuIHsKdmFsdWU6IHNlbGVjdG9yLApjb21iaW5hdG9yOiBjb21iaW5hdG9yLApzdG9wOiBzdG9wLApob3N0Q29udGV4dDogaG9zdENvbnRleHQKfTsKfSwKX3RyYW5zZm9ybVNpbXBsZVNlbGVjdG9yOiBmdW5jdGlvbiAoc2VsZWN0b3IsIHNjb3BlKSB7CnZhciBwJCA9IHNlbGVjdG9yLnNwbGl0KFBTRVVET19QUkVGSVgpOwpwJFswXSArPSBzY29wZTsKcmV0dXJuIHAkLmpvaW4oUFNFVURPX1BSRUZJWCk7Cn0sCmRvY3VtZW50UnVsZTogZnVuY3Rpb24gKHJ1bGUpIHsKcnVsZS5zZWxlY3RvciA9IHJ1bGUucGFyc2VkU2VsZWN0b3I7CnRoaXMubm9ybWFsaXplUm9vdFNlbGVjdG9yKHJ1bGUpOwppZiAoIW5hdGl2ZVNoYWRvdykgewp0aGlzLl90cmFuc2Zvcm1SdWxlKHJ1bGUsIHRoaXMuX3RyYW5zZm9ybURvY3VtZW50U2VsZWN0b3IpOwp9Cn0sCm5vcm1hbGl6ZVJvb3RTZWxlY3RvcjogZnVuY3Rpb24gKHJ1bGUpIHsKaWYgKHJ1bGUuc2VsZWN0b3IgPT09IFJPT1QpIHsKcnVsZS5zZWxlY3RvciA9ICdib2R5JzsKfQp9LApfdHJhbnNmb3JtRG9jdW1lbnRTZWxlY3RvcjogZnVuY3Rpb24gKHNlbGVjdG9yKSB7CnJldHVybiBzZWxlY3Rvci5tYXRjaChTQ09QRV9KVU1QKSA/IHRoaXMuX3RyYW5zZm9ybUNvbXBsZXhTZWxlY3RvcihzZWxlY3RvciwgU0NPUEVfRE9DX1NFTEVDVE9SKSA6IHRoaXMuX3RyYW5zZm9ybVNpbXBsZVNlbGVjdG9yKHNlbGVjdG9yLnRyaW0oKSwgU0NPUEVfRE9DX1NFTEVDVE9SKTsKfSwKU0NPUEVfTkFNRTogJ3N0eWxlLXNjb3BlJwp9Owp2YXIgU0NPUEVfTkFNRSA9IGFwaS5TQ09QRV9OQU1FOwp2YXIgU0NPUEVfRE9DX1NFTEVDVE9SID0gJzpub3QoWycgKyBTQ09QRV9OQU1FICsgJ10pJyArICc6bm90KC4nICsgU0NPUEVfTkFNRSArICcpJzsKdmFyIENPTVBMRVhfU0VMRUNUT1JfU0VQID0gJywnOwp2YXIgU0lNUExFX1NFTEVDVE9SX1NFUCA9IC8oXnxbXHM+K35dKykoW15ccz4rfl0rKS9nOwp2YXIgSE9TVCA9ICc6aG9zdCc7CnZhciBST09UID0gJzpyb290JzsKdmFyIEhPU1RfUEFSRU4gPSAvKFw6aG9zdCkoPzpcKCgoPzpcKFteKShdKlwpfFteKShdKikrPylcKSkvZzsKdmFyIEhPU1RfQ09OVEVYVCA9ICc6aG9zdC1jb250ZXh0JzsKdmFyIEhPU1RfQ09OVEVYVF9QQVJFTiA9IC8oLiopKD86XDpob3N0LWNvbnRleHQpKD86XCgoKD86XChbXikoXSpcKXxbXikoXSopKz8pXCkpKC4qKS87CnZhciBDT05URU5UID0gJzo6Y29udGVudCc7CnZhciBTQ09QRV9KVU1QID0gL1w6XDpjb250ZW50fFw6XDpzaGFkb3d8XC9kZWVwXC8vOwp2YXIgQ1NTX0NMQVNTX1BSRUZJWCA9ICcuLi9kaWN0aW9uYXJ5LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlLm51bGwnOwp2YXIgQ1NTX0FUVFJfUFJFRklYID0gJ1snICsgU0NPUEVfTkFNRSArICd+PSc7CnZhciBDU1NfQVRUUl9TVUZGSVggPSAnXSc7CnZhciBQU0VVRE9fUFJFRklYID0gJzonOwp2YXIgQ0xBU1MgPSAnY2xhc3MnOwpyZXR1cm4gYXBpOwp9KCk7ClBvbHltZXIuU3R5bGVFeHRlbmRzID0gZnVuY3Rpb24gKCkgewp2YXIgc3R5bGVVdGlsID0gUG9seW1lci5TdHlsZVV0aWw7CnJldHVybiB7Cmhhc0V4dGVuZHM6IGZ1bmN0aW9uIChjc3NUZXh0KSB7CnJldHVybiBCb29sZWFuKGNzc1RleHQubWF0Y2godGhpcy5yeC5FWFRFTkQpKTsKfSwKdHJhbnNmb3JtOiBmdW5jdGlvbiAoc3R5bGUpIHsKdmFyIHJ1bGVzID0gc3R5bGVVdGlsLnJ1bGVzRm9yU3R5bGUoc3R5bGUpOwp2YXIgc2VsZiA9IHRoaXM7CnN0eWxlVXRpbC5mb3JFYWNoU3R5bGVSdWxlKHJ1bGVzLCBmdW5jdGlvbiAocnVsZSkgewp2YXIgbWFwID0gc2VsZi5fbWFwUnVsZShydWxlKTsKaWYgKHJ1bGUucGFyZW50KSB7CnZhciBtOwp3aGlsZSAobSA9IHNlbGYucnguRVhURU5ELmV4ZWMocnVsZS5jc3NUZXh0KSkgewp2YXIgZXh0ZW5kID0gbVsxXTsKdmFyIGV4dGVuZG9yID0gc2VsZi5fZmluZEV4dGVuZG9yKGV4dGVuZCwgcnVsZSk7CmlmIChleHRlbmRvcikgewpzZWxmLl9leHRlbmRSdWxlKHJ1bGUsIGV4dGVuZG9yKTsKfQp9Cn0KcnVsZS5jc3NUZXh0ID0gcnVsZS5jc3NUZXh0LnJlcGxhY2Uoc2VsZi5yeC5FWFRFTkQsICcnKTsKfSk7CnJldHVybiBzdHlsZVV0aWwudG9Dc3NUZXh0KHJ1bGVzLCBmdW5jdGlvbiAocnVsZSkgewppZiAocnVsZS5zZWxlY3Rvci5tYXRjaChzZWxmLnJ4LlNUUklQKSkgewpydWxlLmNzc1RleHQgPSAnJzsKfQp9LCB0cnVlKTsKfSwKX21hcFJ1bGU6IGZ1bmN0aW9uIChydWxlKSB7CmlmIChydWxlLnBhcmVudCkgewp2YXIgbWFwID0gcnVsZS5wYXJlbnQubWFwIHx8IChydWxlLnBhcmVudC5tYXAgPSB7fSk7CnZhciBwYXJ0cyA9IHJ1bGUuc2VsZWN0b3Iuc3BsaXQoJywnKTsKZm9yICh2YXIgaSA9IDAsIHA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykgewpwID0gcGFydHNbaV07Cm1hcFtwLnRyaW0oKV0gPSBydWxlOwp9CnJldHVybiBtYXA7Cn0KfSwKX2ZpbmRFeHRlbmRvcjogZnVuY3Rpb24gKGV4dGVuZCwgcnVsZSkgewpyZXR1cm4gcnVsZS5wYXJlbnQgJiYgcnVsZS5wYXJlbnQubWFwICYmIHJ1bGUucGFyZW50Lm1hcFtleHRlbmRdIHx8IHRoaXMuX2ZpbmRFeHRlbmRvcihleHRlbmQsIHJ1bGUucGFyZW50KTsKfSwKX2V4dGVuZFJ1bGU6IGZ1bmN0aW9uICh0YXJnZXQsIHNvdXJjZSkgewppZiAodGFyZ2V0LnBhcmVudCAhPT0gc291cmNlLnBhcmVudCkgewp0aGlzLl9jbG9uZUFuZEFkZFJ1bGVUb1BhcmVudChzb3VyY2UsIHRhcmdldC5wYXJlbnQpOwp9CnRhcmdldC5leHRlbmRzID0gdGFyZ2V0LmV4dGVuZHMgfHwgKHRhcmdldC5leHRlbmRzID0gW10pOwp0YXJnZXQuZXh0ZW5kcy5wdXNoKHNvdXJjZSk7CnNvdXJjZS5zZWxlY3RvciA9IHNvdXJjZS5zZWxlY3Rvci5yZXBsYWNlKHRoaXMucnguU1RSSVAsICcnKTsKc291cmNlLnNlbGVjdG9yID0gKHNvdXJjZS5zZWxlY3RvciAmJiBzb3VyY2Uuc2VsZWN0b3IgKyAnLFxuJykgKyB0YXJnZXQuc2VsZWN0b3I7CmlmIChzb3VyY2UuZXh0ZW5kcykgewpzb3VyY2UuZXh0ZW5kcy5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CnRoaXMuX2V4dGVuZFJ1bGUodGFyZ2V0LCBlKTsKfSwgdGhpcyk7Cn0KfSwKX2Nsb25lQW5kQWRkUnVsZVRvUGFyZW50OiBmdW5jdGlvbiAocnVsZSwgcGFyZW50KSB7CnJ1bGUgPSBPYmplY3QuY3JlYXRlKHJ1bGUpOwpydWxlLnBhcmVudCA9IHBhcmVudDsKaWYgKHJ1bGUuZXh0ZW5kcykgewpydWxlLmV4dGVuZHMgPSBydWxlLmV4dGVuZHMuc2xpY2UoKTsKfQpwYXJlbnQucnVsZXMucHVzaChydWxlKTsKfSwKcng6IHsKRVhURU5EOiAvQGV4dGVuZHNcKChbXildKilcKVxzKj87L2dpbSwKU1RSSVA6IC8lW14sXSokLwp9Cn07Cn0oKTsKKGZ1bmN0aW9uICgpIHsKdmFyIHByZXBFbGVtZW50ID0gUG9seW1lci5CYXNlLl9wcmVwRWxlbWVudDsKdmFyIG5hdGl2ZVNoYWRvdyA9IFBvbHltZXIuU2V0dGluZ3MudXNlTmF0aXZlU2hhZG93Owp2YXIgc3R5bGVVdGlsID0gUG9seW1lci5TdHlsZVV0aWw7CnZhciBzdHlsZVRyYW5zZm9ybWVyID0gUG9seW1lci5TdHlsZVRyYW5zZm9ybWVyOwp2YXIgc3R5bGVFeHRlbmRzID0gUG9seW1lci5TdHlsZUV4dGVuZHM7ClBvbHltZXIuQmFzZS5fYWRkRmVhdHVyZSh7Cl9wcmVwRWxlbWVudDogZnVuY3Rpb24gKGVsZW1lbnQpIHsKaWYgKHRoaXMuX2VuY2Fwc3VsYXRlU3R5bGUpIHsKc3R5bGVUcmFuc2Zvcm1lci5lbGVtZW50KGVsZW1lbnQsIHRoaXMuaXMsIHRoaXMuX3Njb3BlQ3NzVmlhQXR0cik7Cn0KcHJlcEVsZW1lbnQuY2FsbCh0aGlzLCBlbGVtZW50KTsKfSwKX3ByZXBTdHlsZXM6IGZ1bmN0aW9uICgpIHsKaWYgKHRoaXMuX2VuY2Fwc3VsYXRlU3R5bGUgPT09IHVuZGVmaW5lZCkgewp0aGlzLl9lbmNhcHN1bGF0ZVN0eWxlID0gIW5hdGl2ZVNoYWRvdyAmJiBCb29sZWFuKHRoaXMuX3RlbXBsYXRlKTsKfQp0aGlzLl9zdHlsZXMgPSB0aGlzLl9jb2xsZWN0U3R5bGVzKCk7CnZhciBjc3NUZXh0ID0gc3R5bGVUcmFuc2Zvcm1lci5lbGVtZW50U3R5bGVzKHRoaXMpOwppZiAoY3NzVGV4dCAmJiB0aGlzLl90ZW1wbGF0ZSkgewp2YXIgc3R5bGUgPSBzdHlsZVV0aWwuYXBwbHlDc3MoY3NzVGV4dCwgdGhpcy5pcywgbmF0aXZlU2hhZG93ID8gdGhpcy5fdGVtcGxhdGUuY29udGVudCA6IG51bGwpOwppZiAoIW5hdGl2ZVNoYWRvdykgewp0aGlzLl9zY29wZVN0eWxlID0gc3R5bGU7Cn0KfQp9LApfY29sbGVjdFN0eWxlczogZnVuY3Rpb24gKCkgewp2YXIgc3R5bGVzID0gW107CnZhciBjc3NUZXh0ID0gJycsIG0kID0gdGhpcy5zdHlsZU1vZHVsZXM7CmlmIChtJCkgewpmb3IgKHZhciBpID0gMCwgbCA9IG0kLmxlbmd0aCwgbTsgaSA8IGwgJiYgKG0gPSBtJFtpXSk7IGkrKykgewpjc3NUZXh0ICs9IHN0eWxlVXRpbC5jc3NGcm9tTW9kdWxlKG0pOwp9Cn0KY3NzVGV4dCArPSBzdHlsZVV0aWwuY3NzRnJvbU1vZHVsZSh0aGlzLmlzKTsKaWYgKGNzc1RleHQpIHsKdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKc3R5bGUudGV4dENvbnRlbnQgPSBjc3NUZXh0OwppZiAoc3R5bGVFeHRlbmRzLmhhc0V4dGVuZHMoc3R5bGUudGV4dENvbnRlbnQpKSB7CmNzc1RleHQgPSBzdHlsZUV4dGVuZHMudHJhbnNmb3JtKHN0eWxlKTsKfQpzdHlsZXMucHVzaChzdHlsZSk7Cn0KcmV0dXJuIHN0eWxlczsKfSwKX2VsZW1lbnRBZGQ6IGZ1bmN0aW9uIChub2RlKSB7CmlmICh0aGlzLl9lbmNhcHN1bGF0ZVN0eWxlKSB7CmlmIChub2RlLl9fc3R5bGVTY29wZWQpIHsKbm9kZS5fX3N0eWxlU2NvcGVkID0gZmFsc2U7Cn0gZWxzZSB7CnN0eWxlVHJhbnNmb3JtZXIuZG9tKG5vZGUsIHRoaXMuaXMsIHRoaXMuX3Njb3BlQ3NzVmlhQXR0cik7Cn0KfQp9LApfZWxlbWVudFJlbW92ZTogZnVuY3Rpb24gKG5vZGUpIHsKaWYgKHRoaXMuX2VuY2Fwc3VsYXRlU3R5bGUpIHsKc3R5bGVUcmFuc2Zvcm1lci5kb20obm9kZSwgdGhpcy5pcywgdGhpcy5fc2NvcGVDc3NWaWFBdHRyLCB0cnVlKTsKfQp9LApzY29wZVN1YnRyZWU6IGZ1bmN0aW9uIChjb250YWluZXIsIHNob3VsZE9ic2VydmUpIHsKaWYgKG5hdGl2ZVNoYWRvdykgewpyZXR1cm47Cn0KdmFyIHNlbGYgPSB0aGlzOwp2YXIgc2NvcGlmeSA9IGZ1bmN0aW9uIChub2RlKSB7CmlmIChub2RlLm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSkgewpub2RlLmNsYXNzTmFtZSA9IHNlbGYuX3Njb3BlRWxlbWVudENsYXNzKG5vZGUsIG5vZGUuY2xhc3NOYW1lKTsKdmFyIG4kID0gbm9kZS5xdWVyeVNlbGVjdG9yQWxsKCcqJyk7CkFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwobiQsIGZ1bmN0aW9uIChuKSB7Cm4uY2xhc3NOYW1lID0gc2VsZi5fc2NvcGVFbGVtZW50Q2xhc3Mobiwgbi5jbGFzc05hbWUpOwp9KTsKfQp9OwpzY29waWZ5KGNvbnRhaW5lcik7CmlmIChzaG91bGRPYnNlcnZlKSB7CnZhciBtbyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uIChteG5zKSB7Cm14bnMuZm9yRWFjaChmdW5jdGlvbiAobSkgewppZiAobS5hZGRlZE5vZGVzKSB7CmZvciAodmFyIGkgPSAwOyBpIDwgbS5hZGRlZE5vZGVzLmxlbmd0aDsgaSsrKSB7CnNjb3BpZnkobS5hZGRlZE5vZGVzW2ldKTsKfQp9Cn0pOwp9KTsKbW8ub2JzZXJ2ZShjb250YWluZXIsIHsKY2hpbGRMaXN0OiB0cnVlLApzdWJ0cmVlOiB0cnVlCn0pOwpyZXR1cm4gbW87Cn0KfQp9KTsKfSgpKTsKUG9seW1lci5TdHlsZVByb3BlcnRpZXMgPSBmdW5jdGlvbiAoKSB7Cid1c2Ugc3RyaWN0JzsKdmFyIG5hdGl2ZVNoYWRvdyA9IFBvbHltZXIuU2V0dGluZ3MudXNlTmF0aXZlU2hhZG93Owp2YXIgbWF0Y2hlc1NlbGVjdG9yID0gUG9seW1lci5Eb21BcGkubWF0Y2hlc1NlbGVjdG9yOwp2YXIgc3R5bGVVdGlsID0gUG9seW1lci5TdHlsZVV0aWw7CnZhciBzdHlsZVRyYW5zZm9ybWVyID0gUG9seW1lci5TdHlsZVRyYW5zZm9ybWVyOwpyZXR1cm4gewpkZWNvcmF0ZVN0eWxlczogZnVuY3Rpb24gKHN0eWxlcykgewp2YXIgc2VsZiA9IHRoaXMsIHByb3BzID0ge307CnN0eWxlVXRpbC5mb3JSdWxlc0luU3R5bGVzKHN0eWxlcywgZnVuY3Rpb24gKHJ1bGUpIHsKc2VsZi5kZWNvcmF0ZVJ1bGUocnVsZSk7CnNlbGYuY29sbGVjdFByb3BlcnRpZXNJbkNzc1RleHQocnVsZS5wcm9wZXJ0eUluZm8uY3NzVGV4dCwgcHJvcHMpOwp9KTsKdmFyIG5hbWVzID0gW107CmZvciAodmFyIGkgaW4gcHJvcHMpIHsKbmFtZXMucHVzaChpKTsKfQpyZXR1cm4gbmFtZXM7Cn0sCmRlY29yYXRlUnVsZTogZnVuY3Rpb24gKHJ1bGUpIHsKaWYgKHJ1bGUucHJvcGVydHlJbmZvKSB7CnJldHVybiBydWxlLnByb3BlcnR5SW5mbzsKfQp2YXIgaW5mbyA9IHt9LCBwcm9wZXJ0aWVzID0ge307CnZhciBoYXNQcm9wZXJ0aWVzID0gdGhpcy5jb2xsZWN0UHJvcGVydGllcyhydWxlLCBwcm9wZXJ0aWVzKTsKaWYgKGhhc1Byb3BlcnRpZXMpIHsKaW5mby5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKcnVsZS5ydWxlcyA9IG51bGw7Cn0KaW5mby5jc3NUZXh0ID0gdGhpcy5jb2xsZWN0Q3NzVGV4dChydWxlKTsKcnVsZS5wcm9wZXJ0eUluZm8gPSBpbmZvOwpyZXR1cm4gaW5mbzsKfSwKY29sbGVjdFByb3BlcnRpZXM6IGZ1bmN0aW9uIChydWxlLCBwcm9wZXJ0aWVzKSB7CnZhciBpbmZvID0gcnVsZS5wcm9wZXJ0eUluZm87CmlmIChpbmZvKSB7CmlmIChpbmZvLnByb3BlcnRpZXMpIHsKUG9seW1lci5CYXNlLm1peGluKHByb3BlcnRpZXMsIGluZm8ucHJvcGVydGllcyk7CnJldHVybiB0cnVlOwp9Cn0gZWxzZSB7CnZhciBtLCByeCA9IHRoaXMucnguVkFSX0FTU0lHTjsKdmFyIGNzc1RleHQgPSBydWxlLnBhcnNlZENzc1RleHQ7CnZhciBhbnk7CndoaWxlIChtID0gcnguZXhlYyhjc3NUZXh0KSkgewpwcm9wZXJ0aWVzW21bMV1dID0gKG1bMl0gfHwgbVszXSkudHJpbSgpOwphbnkgPSB0cnVlOwp9CnJldHVybiBhbnk7Cn0KfSwKY29sbGVjdENzc1RleHQ6IGZ1bmN0aW9uIChydWxlKSB7CnZhciBjdXN0b21Dc3NUZXh0ID0gJyc7CnZhciBjc3NUZXh0ID0gcnVsZS5wYXJzZWRDc3NUZXh0Owpjc3NUZXh0ID0gY3NzVGV4dC5yZXBsYWNlKHRoaXMucnguQlJBQ0tFVEVELCAnJykucmVwbGFjZSh0aGlzLnJ4LlZBUl9BU1NJR04sICcnKTsKdmFyIHBhcnRzID0gY3NzVGV4dC5zcGxpdCgnOycpOwpmb3IgKHZhciBpID0gMCwgcDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7CnAgPSBwYXJ0c1tpXTsKaWYgKHAubWF0Y2godGhpcy5yeC5NSVhJTl9NQVRDSCkgfHwgcC5tYXRjaCh0aGlzLnJ4LlZBUl9NQVRDSCkpIHsKY3VzdG9tQ3NzVGV4dCArPSBwICsgJztcbic7Cn0KfQpyZXR1cm4gY3VzdG9tQ3NzVGV4dDsKfSwKY29sbGVjdFByb3BlcnRpZXNJbkNzc1RleHQ6IGZ1bmN0aW9uIChjc3NUZXh0LCBwcm9wcykgewp2YXIgbTsKd2hpbGUgKG0gPSB0aGlzLnJ4LlZBUl9DQVBUVVJFLmV4ZWMoY3NzVGV4dCkpIHsKcHJvcHNbbVsxXV0gPSB0cnVlOwp2YXIgZGVmID0gbVsyXTsKaWYgKGRlZiAmJiBkZWYubWF0Y2godGhpcy5yeC5JU19WQVIpKSB7CnByb3BzW2RlZl0gPSB0cnVlOwp9Cn0KfSwKcmVpZnk6IGZ1bmN0aW9uIChwcm9wcykgewp2YXIgbmFtZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhwcm9wcyk7CmZvciAodmFyIGkgPSAwLCBuOyBpIDwgbmFtZXMubGVuZ3RoOyBpKyspIHsKbiA9IG5hbWVzW2ldOwpwcm9wc1tuXSA9IHRoaXMudmFsdWVGb3JQcm9wZXJ0eShwcm9wc1tuXSwgcHJvcHMpOwp9Cn0sCnZhbHVlRm9yUHJvcGVydHk6IGZ1bmN0aW9uIChwcm9wZXJ0eSwgcHJvcHMpIHsKaWYgKHByb3BlcnR5KSB7CmlmIChwcm9wZXJ0eS5pbmRleE9mKCc7JykgPj0gMCkgewpwcm9wZXJ0eSA9IHRoaXMudmFsdWVGb3JQcm9wZXJ0aWVzKHByb3BlcnR5LCBwcm9wcyk7Cn0gZWxzZSB7CnZhciBzZWxmID0gdGhpczsKdmFyIGZuID0gZnVuY3Rpb24gKGFsbCwgcHJlZml4LCB2YWx1ZSwgZmFsbGJhY2spIHsKdmFyIHByb3BlcnR5VmFsdWUgPSBzZWxmLnZhbHVlRm9yUHJvcGVydHkocHJvcHNbdmFsdWVdLCBwcm9wcykgfHwgKHByb3BzW2ZhbGxiYWNrXSA/IHNlbGYudmFsdWVGb3JQcm9wZXJ0eShwcm9wc1tmYWxsYmFja10sIHByb3BzKSA6IGZhbGxiYWNrKTsKcmV0dXJuIHByZWZpeCArIChwcm9wZXJ0eVZhbHVlIHx8ICcnKTsKfTsKcHJvcGVydHkgPSBwcm9wZXJ0eS5yZXBsYWNlKHRoaXMucnguVkFSX01BVENILCBmbik7Cn0KfQpyZXR1cm4gcHJvcGVydHkgJiYgcHJvcGVydHkudHJpbSgpIHx8ICcnOwp9LAp2YWx1ZUZvclByb3BlcnRpZXM6IGZ1bmN0aW9uIChwcm9wZXJ0eSwgcHJvcHMpIHsKdmFyIHBhcnRzID0gcHJvcGVydHkuc3BsaXQoJzsnKTsKZm9yICh2YXIgaSA9IDAsIHAsIG07IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykgewppZiAocCA9IHBhcnRzW2ldKSB7Cm0gPSBwLm1hdGNoKHRoaXMucnguTUlYSU5fTUFUQ0gpOwppZiAobSkgewpwID0gdGhpcy52YWx1ZUZvclByb3BlcnR5KHByb3BzW21bMV1dLCBwcm9wcyk7Cn0gZWxzZSB7CnZhciBwcCA9IHAuc3BsaXQoJzonKTsKaWYgKHBwWzFdKSB7CnBwWzFdID0gcHBbMV0udHJpbSgpOwpwcFsxXSA9IHRoaXMudmFsdWVGb3JQcm9wZXJ0eShwcFsxXSwgcHJvcHMpIHx8IHBwWzFdOwp9CnAgPSBwcC5qb2luKCc6Jyk7Cn0KcGFydHNbaV0gPSBwICYmIHAubGFzdEluZGV4T2YoJzsnKSA9PT0gcC5sZW5ndGggLSAxID8gcC5zbGljZSgwLCAtMSkgOiBwIHx8ICcnOwp9Cn0KcmV0dXJuIHBhcnRzLmpvaW4oJzsnKTsKfSwKYXBwbHlQcm9wZXJ0aWVzOiBmdW5jdGlvbiAocnVsZSwgcHJvcHMpIHsKdmFyIG91dHB1dCA9ICcnOwppZiAoIXJ1bGUucHJvcGVydHlJbmZvKSB7CnRoaXMuZGVjb3JhdGVSdWxlKHJ1bGUpOwp9CmlmIChydWxlLnByb3BlcnR5SW5mby5jc3NUZXh0KSB7Cm91dHB1dCA9IHRoaXMudmFsdWVGb3JQcm9wZXJ0aWVzKHJ1bGUucHJvcGVydHlJbmZvLmNzc1RleHQsIHByb3BzKTsKfQpydWxlLmNzc1RleHQgPSBvdXRwdXQ7Cn0sCnByb3BlcnR5RGF0YUZyb21TdHlsZXM6IGZ1bmN0aW9uIChzdHlsZXMsIGVsZW1lbnQpIHsKdmFyIHByb3BzID0ge30sIHNlbGYgPSB0aGlzOwp2YXIgbyA9IFtdLCBpID0gMDsKc3R5bGVVdGlsLmZvclJ1bGVzSW5TdHlsZXMoc3R5bGVzLCBmdW5jdGlvbiAocnVsZSkgewppZiAoIXJ1bGUucHJvcGVydHlJbmZvKSB7CnNlbGYuZGVjb3JhdGVSdWxlKHJ1bGUpOwp9CmlmIChlbGVtZW50ICYmIHJ1bGUucHJvcGVydHlJbmZvLnByb3BlcnRpZXMgJiYgbWF0Y2hlc1NlbGVjdG9yLmNhbGwoZWxlbWVudCwgcnVsZS50cmFuc2Zvcm1lZFNlbGVjdG9yIHx8IHJ1bGUucGFyc2VkU2VsZWN0b3IpKSB7CnNlbGYuY29sbGVjdFByb3BlcnRpZXMocnVsZSwgcHJvcHMpOwphZGRUb0JpdE1hc2soaSwgbyk7Cn0KaSsrOwp9KTsKcmV0dXJuIHsKcHJvcGVydGllczogcHJvcHMsCmtleTogbwp9Owp9LApzY29wZVByb3BlcnRpZXNGcm9tU3R5bGVzOiBmdW5jdGlvbiAoc3R5bGVzKSB7CmlmICghc3R5bGVzLl9zY29wZVN0eWxlUHJvcGVydGllcykgewpzdHlsZXMuX3Njb3BlU3R5bGVQcm9wZXJ0aWVzID0gdGhpcy5zZWxlY3RlZFByb3BlcnRpZXNGcm9tU3R5bGVzKHN0eWxlcywgdGhpcy5TQ09QRV9TRUxFQ1RPUlMpOwp9CnJldHVybiBzdHlsZXMuX3Njb3BlU3R5bGVQcm9wZXJ0aWVzOwp9LApob3N0UHJvcGVydGllc0Zyb21TdHlsZXM6IGZ1bmN0aW9uIChzdHlsZXMpIHsKaWYgKCFzdHlsZXMuX2hvc3RTdHlsZVByb3BlcnRpZXMpIHsKc3R5bGVzLl9ob3N0U3R5bGVQcm9wZXJ0aWVzID0gdGhpcy5zZWxlY3RlZFByb3BlcnRpZXNGcm9tU3R5bGVzKHN0eWxlcywgdGhpcy5IT1NUX1NFTEVDVE9SUyk7Cn0KcmV0dXJuIHN0eWxlcy5faG9zdFN0eWxlUHJvcGVydGllczsKfSwKc2VsZWN0ZWRQcm9wZXJ0aWVzRnJvbVN0eWxlczogZnVuY3Rpb24gKHN0eWxlcywgc2VsZWN0b3JzKSB7CnZhciBwcm9wcyA9IHt9LCBzZWxmID0gdGhpczsKc3R5bGVVdGlsLmZvclJ1bGVzSW5TdHlsZXMoc3R5bGVzLCBmdW5jdGlvbiAocnVsZSkgewppZiAoIXJ1bGUucHJvcGVydHlJbmZvKSB7CnNlbGYuZGVjb3JhdGVSdWxlKHJ1bGUpOwp9CmZvciAodmFyIGkgPSAwOyBpIDwgc2VsZWN0b3JzLmxlbmd0aDsgaSsrKSB7CmlmIChydWxlLnBhcnNlZFNlbGVjdG9yID09PSBzZWxlY3RvcnNbaV0pIHsKc2VsZi5jb2xsZWN0UHJvcGVydGllcyhydWxlLCBwcm9wcyk7CnJldHVybjsKfQp9Cn0pOwpyZXR1cm4gcHJvcHM7Cn0sCnRyYW5zZm9ybVN0eWxlczogZnVuY3Rpb24gKGVsZW1lbnQsIHByb3BlcnRpZXMsIHNjb3BlU2VsZWN0b3IpIHsKdmFyIHNlbGYgPSB0aGlzOwp2YXIgaG9zdFNlbGVjdG9yID0gc3R5bGVUcmFuc2Zvcm1lci5fY2FsY0hvc3RTY29wZShlbGVtZW50LmlzLCBlbGVtZW50LmV4dGVuZHMpOwp2YXIgcnhIb3N0U2VsZWN0b3IgPSBlbGVtZW50LmV4dGVuZHMgPyAnXFwnICsgaG9zdFNlbGVjdG9yLnNsaWNlKDAsIC0xKSArICdcXF0nIDogaG9zdFNlbGVjdG9yOwp2YXIgaG9zdFJ4ID0gbmV3IFJlZ0V4cCh0aGlzLnJ4LkhPU1RfUFJFRklYICsgcnhIb3N0U2VsZWN0b3IgKyB0aGlzLnJ4LkhPU1RfU1VGRklYKTsKcmV0dXJuIHN0eWxlVHJhbnNmb3JtZXIuZWxlbWVudFN0eWxlcyhlbGVtZW50LCBmdW5jdGlvbiAocnVsZSkgewpzZWxmLmFwcGx5UHJvcGVydGllcyhydWxlLCBwcm9wZXJ0aWVzKTsKaWYgKHJ1bGUuY3NzVGV4dCAmJiAhbmF0aXZlU2hhZG93KSB7CnNlbGYuX3Njb3BlU2VsZWN0b3IocnVsZSwgaG9zdFJ4LCBob3N0U2VsZWN0b3IsIGVsZW1lbnQuX3Njb3BlQ3NzVmlhQXR0ciwgc2NvcGVTZWxlY3Rvcik7Cn0KfSk7Cn0sCl9zY29wZVNlbGVjdG9yOiBmdW5jdGlvbiAocnVsZSwgaG9zdFJ4LCBob3N0U2VsZWN0b3IsIHZpYUF0dHIsIHNjb3BlSWQpIHsKcnVsZS50cmFuc2Zvcm1lZFNlbGVjdG9yID0gcnVsZS50cmFuc2Zvcm1lZFNlbGVjdG9yIHx8IHJ1bGUuc2VsZWN0b3I7CnZhciBzZWxlY3RvciA9IHJ1bGUudHJhbnNmb3JtZWRTZWxlY3RvcjsKdmFyIHNjb3BlID0gdmlhQXR0ciA/ICdbJyArIHN0eWxlVHJhbnNmb3JtZXIuU0NPUEVfTkFNRSArICd+PScgKyBzY29wZUlkICsgJ10nIDogJy4nICsgc2NvcGVJZDsKdmFyIHBhcnRzID0gc2VsZWN0b3Iuc3BsaXQoJywnKTsKZm9yICh2YXIgaSA9IDAsIGwgPSBwYXJ0cy5sZW5ndGgsIHA7IGkgPCBsICYmIChwID0gcGFydHNbaV0pOyBpKyspIHsKcGFydHNbaV0gPSBwLm1hdGNoKGhvc3RSeCkgPyBwLnJlcGxhY2UoaG9zdFNlbGVjdG9yLCBob3N0U2VsZWN0b3IgKyBzY29wZSkgOiBzY29wZSArICcgJyArIHA7Cn0KcnVsZS5zZWxlY3RvciA9IHBhcnRzLmpvaW4oJywnKTsKfSwKYXBwbHlFbGVtZW50U2NvcGVTZWxlY3RvcjogZnVuY3Rpb24gKGVsZW1lbnQsIHNlbGVjdG9yLCBvbGQsIHZpYUF0dHIpIHsKdmFyIGMgPSB2aWFBdHRyID8gZWxlbWVudC5nZXRBdHRyaWJ1dGUoc3R5bGVUcmFuc2Zvcm1lci5TQ09QRV9OQU1FKSA6IGVsZW1lbnQuY2xhc3NOYW1lOwp2YXIgdiA9IG9sZCA/IGMucmVwbGFjZShvbGQsIHNlbGVjdG9yKSA6IChjID8gYyArICcgJyA6ICcnKSArIHRoaXMuWFNDT1BFX05BTUUgKyAnICcgKyBzZWxlY3RvcjsKaWYgKGMgIT09IHYpIHsKaWYgKHZpYUF0dHIpIHsKZWxlbWVudC5zZXRBdHRyaWJ1dGUoc3R5bGVUcmFuc2Zvcm1lci5TQ09QRV9OQU1FLCB2KTsKfSBlbHNlIHsKZWxlbWVudC5jbGFzc05hbWUgPSB2Owp9Cn0KfSwKYXBwbHlFbGVtZW50U3R5bGU6IGZ1bmN0aW9uIChlbGVtZW50LCBwcm9wZXJ0aWVzLCBzZWxlY3Rvciwgc3R5bGUpIHsKdmFyIGNzc1RleHQgPSBzdHlsZSA/IHN0eWxlLnRleHRDb250ZW50IHx8ICcnIDogdGhpcy50cmFuc2Zvcm1TdHlsZXMoZWxlbWVudCwgcHJvcGVydGllcywgc2VsZWN0b3IpOwp2YXIgcyA9IGVsZW1lbnQuX2N1c3RvbVN0eWxlOwppZiAocyAmJiAhbmF0aXZlU2hhZG93ICYmIHMgIT09IHN0eWxlKSB7CnMuX3VzZUNvdW50LS07CmlmIChzLl91c2VDb3VudCA8PSAwICYmIHMucGFyZW50Tm9kZSkgewpzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocyk7Cn0KfQppZiAobmF0aXZlU2hhZG93IHx8ICghc3R5bGUgfHwgIXN0eWxlLnBhcmVudE5vZGUpKSB7CmlmIChuYXRpdmVTaGFkb3cgJiYgZWxlbWVudC5fY3VzdG9tU3R5bGUpIHsKZWxlbWVudC5fY3VzdG9tU3R5bGUudGV4dENvbnRlbnQgPSBjc3NUZXh0OwpzdHlsZSA9IGVsZW1lbnQuX2N1c3RvbVN0eWxlOwp9IGVsc2UgaWYgKGNzc1RleHQpIHsKc3R5bGUgPSBzdHlsZVV0aWwuYXBwbHlDc3MoY3NzVGV4dCwgc2VsZWN0b3IsIG5hdGl2ZVNoYWRvdyA/IGVsZW1lbnQucm9vdCA6IG51bGwsIGVsZW1lbnQuX3Njb3BlU3R5bGUpOwp9Cn0KaWYgKHN0eWxlKSB7CnN0eWxlLl91c2VDb3VudCA9IHN0eWxlLl91c2VDb3VudCB8fCAwOwppZiAoZWxlbWVudC5fY3VzdG9tU3R5bGUgIT0gc3R5bGUpIHsKc3R5bGUuX3VzZUNvdW50Kys7Cn0KZWxlbWVudC5fY3VzdG9tU3R5bGUgPSBzdHlsZTsKfQpyZXR1cm4gc3R5bGU7Cn0sCm1peGluQ3VzdG9tU3R5bGU6IGZ1bmN0aW9uIChwcm9wcywgY3VzdG9tU3R5bGUpIHsKdmFyIHY7CmZvciAodmFyIGkgaW4gY3VzdG9tU3R5bGUpIHsKdiA9IGN1c3RvbVN0eWxlW2ldOwppZiAodiB8fCB2ID09PSAwKSB7CnByb3BzW2ldID0gdjsKfQp9Cn0sCnJ4OiB7ClZBUl9BU1NJR046IC8oPzpefFs7XG5dXHMqKSgtLVtcdy1dKj8pOlxzKig/OihbXjt7XSopfHsoW159XSopfSkoPzooPz1bO1xuXSl8JCkvZ2ksCk1JWElOX01BVENIOiAvKD86XnxcVyspQGFwcGx5W1xzXSpcKChbXildKilcKS9pLApWQVJfTUFUQ0g6IC8oXnxcVyspdmFyXChbXHNdKihbXiwpXSopW1xzXSosP1tcc10qKCg/OlteLCldKil8KD86W147XSpcKFteOyldKlwpKSlbXHNdKj9cKS9naSwKVkFSX0NBUFRVUkU6IC9cKFtcc10qKC0tW14sXHMpXSopKD86LFtcc10qKC0tW14sXHMpXSopKT8oPzpcKXwsKS9naSwKSVNfVkFSOiAvXi0tLywKQlJBQ0tFVEVEOiAvXHtbXn1dKlx9L2csCkhPU1RfUFJFRklYOiAnKD86XnxbXi4jWzpdKScsCkhPU1RfU1VGRklYOiAnKCR8Wy46W1xccz4rfl0pJwp9LApIT1NUX1NFTEVDVE9SUzogWyc6aG9zdCddLApTQ09QRV9TRUxFQ1RPUlM6IFsnOnJvb3QnXSwKWFNDT1BFX05BTUU6ICd4LXNjb3BlJwp9OwpmdW5jdGlvbiBhZGRUb0JpdE1hc2sobiwgYml0cykgewp2YXIgbyA9IHBhcnNlSW50KG4gLyAzMik7CnZhciB2ID0gMSA8PCBuICUgMzI7CmJpdHNbb10gPSAoYml0c1tvXSB8fCAwKSB8IHY7Cn0KfSgpOwooZnVuY3Rpb24gKCkgewpQb2x5bWVyLlN0eWxlQ2FjaGUgPSBmdW5jdGlvbiAoKSB7CnRoaXMuY2FjaGUgPSB7fTsKfTsKUG9seW1lci5TdHlsZUNhY2hlLnByb3RvdHlwZSA9IHsKTUFYOiAxMDAsCnN0b3JlOiBmdW5jdGlvbiAoaXMsIGRhdGEsIGtleVZhbHVlcywga2V5U3R5bGVzKSB7CmRhdGEua2V5VmFsdWVzID0ga2V5VmFsdWVzOwpkYXRhLnN0eWxlcyA9IGtleVN0eWxlczsKdmFyIHMkID0gdGhpcy5jYWNoZVtpc10gPSB0aGlzLmNhY2hlW2lzXSB8fCBbXTsKcyQucHVzaChkYXRhKTsKaWYgKHMkLmxlbmd0aCA+IHRoaXMuTUFYKSB7CnMkLnNoaWZ0KCk7Cn0KfSwKcmV0cmlldmU6IGZ1bmN0aW9uIChpcywga2V5VmFsdWVzLCBrZXlTdHlsZXMpIHsKdmFyIGNhY2hlID0gdGhpcy5jYWNoZVtpc107CmlmIChjYWNoZSkgewpmb3IgKHZhciBpID0gY2FjaGUubGVuZ3RoIC0gMSwgZGF0YTsgaSA+PSAwOyBpLS0pIHsKZGF0YSA9IGNhY2hlW2ldOwppZiAoa2V5U3R5bGVzID09PSBkYXRhLnN0eWxlcyAmJiB0aGlzLl9vYmplY3RzRXF1YWwoa2V5VmFsdWVzLCBkYXRhLmtleVZhbHVlcykpIHsKcmV0dXJuIGRhdGE7Cn0KfQp9Cn0sCmNsZWFyOiBmdW5jdGlvbiAoKSB7CnRoaXMuY2FjaGUgPSB7fTsKfSwKX29iamVjdHNFcXVhbDogZnVuY3Rpb24gKHRhcmdldCwgc291cmNlKSB7CnZhciB0LCBzOwpmb3IgKHZhciBpIGluIHRhcmdldCkgewp0ID0gdGFyZ2V0W2ldLCBzID0gc291cmNlW2ldOwppZiAoISh0eXBlb2YgdCA9PT0gJ29iamVjdCcgJiYgdCA/IHRoaXMuX29iamVjdHNTdHJpY3RseUVxdWFsKHQsIHMpIDogdCA9PT0gcykpIHsKcmV0dXJuIGZhbHNlOwp9Cn0KaWYgKEFycmF5LmlzQXJyYXkodGFyZ2V0KSkgewpyZXR1cm4gdGFyZ2V0Lmxlbmd0aCA9PT0gc291cmNlLmxlbmd0aDsKfQpyZXR1cm4gdHJ1ZTsKfSwKX29iamVjdHNTdHJpY3RseUVxdWFsOiBmdW5jdGlvbiAodGFyZ2V0LCBzb3VyY2UpIHsKcmV0dXJuIHRoaXMuX29iamVjdHNFcXVhbCh0YXJnZXQsIHNvdXJjZSkgJiYgdGhpcy5fb2JqZWN0c0VxdWFsKHNvdXJjZSwgdGFyZ2V0KTsKfQp9Owp9KCkpOwpQb2x5bWVyLlN0eWxlRGVmYXVsdHMgPSBmdW5jdGlvbiAoKSB7CnZhciBzdHlsZVByb3BlcnRpZXMgPSBQb2x5bWVyLlN0eWxlUHJvcGVydGllczsKdmFyIHN0eWxlVXRpbCA9IFBvbHltZXIuU3R5bGVVdGlsOwp2YXIgU3R5bGVDYWNoZSA9IFBvbHltZXIuU3R5bGVDYWNoZTsKdmFyIGFwaSA9IHsKX3N0eWxlczogW10sCl9wcm9wZXJ0aWVzOiBudWxsLApjdXN0b21TdHlsZToge30sCl9zdHlsZUNhY2hlOiBuZXcgU3R5bGVDYWNoZSgpLAphZGRTdHlsZTogZnVuY3Rpb24gKHN0eWxlKSB7CnRoaXMuX3N0eWxlcy5wdXNoKHN0eWxlKTsKdGhpcy5fcHJvcGVydGllcyA9IG51bGw7Cn0sCmdldCBfc3R5bGVQcm9wZXJ0aWVzKCkgewppZiAoIXRoaXMuX3Byb3BlcnRpZXMpIHsKc3R5bGVQcm9wZXJ0aWVzLmRlY29yYXRlU3R5bGVzKHRoaXMuX3N0eWxlcyk7CnRoaXMuX3N0eWxlcy5fc2NvcGVTdHlsZVByb3BlcnRpZXMgPSBudWxsOwp0aGlzLl9wcm9wZXJ0aWVzID0gc3R5bGVQcm9wZXJ0aWVzLnNjb3BlUHJvcGVydGllc0Zyb21TdHlsZXModGhpcy5fc3R5bGVzKTsKc3R5bGVQcm9wZXJ0aWVzLm1peGluQ3VzdG9tU3R5bGUodGhpcy5fcHJvcGVydGllcywgdGhpcy5jdXN0b21TdHlsZSk7CnN0eWxlUHJvcGVydGllcy5yZWlmeSh0aGlzLl9wcm9wZXJ0aWVzKTsKfQpyZXR1cm4gdGhpcy5fcHJvcGVydGllczsKfSwKX25lZWRzU3R5bGVQcm9wZXJ0aWVzOiBmdW5jdGlvbiAoKSB7Cn0sCl9jb21wdXRlU3R5bGVQcm9wZXJ0aWVzOiBmdW5jdGlvbiAoKSB7CnJldHVybiB0aGlzLl9zdHlsZVByb3BlcnRpZXM7Cn0sCnVwZGF0ZVN0eWxlczogZnVuY3Rpb24gKHByb3BlcnRpZXMpIHsKdGhpcy5fcHJvcGVydGllcyA9IG51bGw7CmlmIChwcm9wZXJ0aWVzKSB7ClBvbHltZXIuQmFzZS5taXhpbih0aGlzLmN1c3RvbVN0eWxlLCBwcm9wZXJ0aWVzKTsKfQp0aGlzLl9zdHlsZUNhY2hlLmNsZWFyKCk7CmZvciAodmFyIGkgPSAwLCBzOyBpIDwgdGhpcy5fc3R5bGVzLmxlbmd0aDsgaSsrKSB7CnMgPSB0aGlzLl9zdHlsZXNbaV07CnMgPSBzLl9faW1wb3J0RWxlbWVudCB8fCBzOwpzLl9hcHBseSgpOwp9Cn0KfTsKcmV0dXJuIGFwaTsKfSgpOwooZnVuY3Rpb24gKCkgewondXNlIHN0cmljdCc7CnZhciBzZXJpYWxpemVWYWx1ZVRvQXR0cmlidXRlID0gUG9seW1lci5CYXNlLnNlcmlhbGl6ZVZhbHVlVG9BdHRyaWJ1dGU7CnZhciBwcm9wZXJ0eVV0aWxzID0gUG9seW1lci5TdHlsZVByb3BlcnRpZXM7CnZhciBzdHlsZVRyYW5zZm9ybWVyID0gUG9seW1lci5TdHlsZVRyYW5zZm9ybWVyOwp2YXIgc3R5bGVVdGlsID0gUG9seW1lci5TdHlsZVV0aWw7CnZhciBzdHlsZURlZmF1bHRzID0gUG9seW1lci5TdHlsZURlZmF1bHRzOwp2YXIgbmF0aXZlU2hhZG93ID0gUG9seW1lci5TZXR0aW5ncy51c2VOYXRpdmVTaGFkb3c7ClBvbHltZXIuQmFzZS5fYWRkRmVhdHVyZSh7Cl9wcmVwU3R5bGVQcm9wZXJ0aWVzOiBmdW5jdGlvbiAoKSB7CnRoaXMuX293blN0eWxlUHJvcGVydHlOYW1lcyA9IHRoaXMuX3N0eWxlcyA/IHByb3BlcnR5VXRpbHMuZGVjb3JhdGVTdHlsZXModGhpcy5fc3R5bGVzKSA6IFtdOwp9LApjdXN0b21TdHlsZToge30sCl9zZXR1cFN0eWxlUHJvcGVydGllczogZnVuY3Rpb24gKCkgewp0aGlzLmN1c3RvbVN0eWxlID0ge307Cn0sCl9uZWVkc1N0eWxlUHJvcGVydGllczogZnVuY3Rpb24gKCkgewpyZXR1cm4gQm9vbGVhbih0aGlzLl9vd25TdHlsZVByb3BlcnR5TmFtZXMgJiYgdGhpcy5fb3duU3R5bGVQcm9wZXJ0eU5hbWVzLmxlbmd0aCk7Cn0sCl9iZWZvcmVBdHRhY2hlZDogZnVuY3Rpb24gKCkgewppZiAoIXRoaXMuX3Njb3BlU2VsZWN0b3IgJiYgdGhpcy5fbmVlZHNTdHlsZVByb3BlcnRpZXMoKSkgewp0aGlzLl91cGRhdGVTdHlsZVByb3BlcnRpZXMoKTsKfQp9LApfZmluZFN0eWxlSG9zdDogZnVuY3Rpb24gKCkgewp2YXIgZSA9IHRoaXMsIHJvb3Q7CndoaWxlIChyb290ID0gUG9seW1lci5kb20oZSkuZ2V0T3duZXJSb290KCkpIHsKaWYgKFBvbHltZXIuaXNJbnN0YW5jZShyb290Lmhvc3QpKSB7CnJldHVybiByb290Lmhvc3Q7Cn0KZSA9IHJvb3QuaG9zdDsKfQpyZXR1cm4gc3R5bGVEZWZhdWx0czsKfSwKX3VwZGF0ZVN0eWxlUHJvcGVydGllczogZnVuY3Rpb24gKCkgewp2YXIgaW5mbywgc2NvcGUgPSB0aGlzLl9maW5kU3R5bGVIb3N0KCk7CmlmICghc2NvcGUuX3N0eWxlQ2FjaGUpIHsKc2NvcGUuX3N0eWxlQ2FjaGUgPSBuZXcgUG9seW1lci5TdHlsZUNhY2hlKCk7Cn0KdmFyIHNjb3BlRGF0YSA9IHByb3BlcnR5VXRpbHMucHJvcGVydHlEYXRhRnJvbVN0eWxlcyhzY29wZS5fc3R5bGVzLCB0aGlzKTsKc2NvcGVEYXRhLmtleS5jdXN0b21TdHlsZSA9IHRoaXMuY3VzdG9tU3R5bGU7CmluZm8gPSBzY29wZS5fc3R5bGVDYWNoZS5yZXRyaWV2ZSh0aGlzLmlzLCBzY29wZURhdGEua2V5LCB0aGlzLl9zdHlsZXMpOwp2YXIgc2NvcGVDYWNoZWQgPSBCb29sZWFuKGluZm8pOwppZiAoc2NvcGVDYWNoZWQpIHsKdGhpcy5fc3R5bGVQcm9wZXJ0aWVzID0gaW5mby5fc3R5bGVQcm9wZXJ0aWVzOwp9IGVsc2Ugewp0aGlzLl9jb21wdXRlU3R5bGVQcm9wZXJ0aWVzKHNjb3BlRGF0YS5wcm9wZXJ0aWVzKTsKfQp0aGlzLl9jb21wdXRlT3duU3R5bGVQcm9wZXJ0aWVzKCk7CmlmICghc2NvcGVDYWNoZWQpIHsKaW5mbyA9IHN0eWxlQ2FjaGUucmV0cmlldmUodGhpcy5pcywgdGhpcy5fb3duU3R5bGVQcm9wZXJ0aWVzLCB0aGlzLl9zdHlsZXMpOwp9CnZhciBnbG9iYWxDYWNoZWQgPSBCb29sZWFuKGluZm8pICYmICFzY29wZUNhY2hlZDsKdmFyIHN0eWxlID0gdGhpcy5fYXBwbHlTdHlsZVByb3BlcnRpZXMoaW5mbyk7CmlmICghc2NvcGVDYWNoZWQpIHsKc3R5bGUgPSBzdHlsZSAmJiBuYXRpdmVTaGFkb3cgPyBzdHlsZS5jbG9uZU5vZGUodHJ1ZSkgOiBzdHlsZTsKaW5mbyA9IHsKc3R5bGU6IHN0eWxlLApfc2NvcGVTZWxlY3RvcjogdGhpcy5fc2NvcGVTZWxlY3RvciwKX3N0eWxlUHJvcGVydGllczogdGhpcy5fc3R5bGVQcm9wZXJ0aWVzCn07CnNjb3BlRGF0YS5rZXkuY3VzdG9tU3R5bGUgPSB7fTsKdGhpcy5taXhpbihzY29wZURhdGEua2V5LmN1c3RvbVN0eWxlLCB0aGlzLmN1c3RvbVN0eWxlKTsKc2NvcGUuX3N0eWxlQ2FjaGUuc3RvcmUodGhpcy5pcywgaW5mbywgc2NvcGVEYXRhLmtleSwgdGhpcy5fc3R5bGVzKTsKaWYgKCFnbG9iYWxDYWNoZWQpIHsKc3R5bGVDYWNoZS5zdG9yZSh0aGlzLmlzLCBPYmplY3QuY3JlYXRlKGluZm8pLCB0aGlzLl9vd25TdHlsZVByb3BlcnRpZXMsIHRoaXMuX3N0eWxlcyk7Cn0KfQp9LApfY29tcHV0ZVN0eWxlUHJvcGVydGllczogZnVuY3Rpb24gKHNjb3BlUHJvcHMpIHsKdmFyIHNjb3BlID0gdGhpcy5fZmluZFN0eWxlSG9zdCgpOwppZiAoIXNjb3BlLl9zdHlsZVByb3BlcnRpZXMpIHsKc2NvcGUuX2NvbXB1dGVTdHlsZVByb3BlcnRpZXMoKTsKfQp2YXIgcHJvcHMgPSBPYmplY3QuY3JlYXRlKHNjb3BlLl9zdHlsZVByb3BlcnRpZXMpOwp0aGlzLm1peGluKHByb3BzLCBwcm9wZXJ0eVV0aWxzLmhvc3RQcm9wZXJ0aWVzRnJvbVN0eWxlcyh0aGlzLl9zdHlsZXMpKTsKc2NvcGVQcm9wcyA9IHNjb3BlUHJvcHMgfHwgcHJvcGVydHlVdGlscy5wcm9wZXJ0eURhdGFGcm9tU3R5bGVzKHNjb3BlLl9zdHlsZXMsIHRoaXMpLnByb3BlcnRpZXM7CnRoaXMubWl4aW4ocHJvcHMsIHNjb3BlUHJvcHMpOwp0aGlzLm1peGluKHByb3BzLCBwcm9wZXJ0eVV0aWxzLnNjb3BlUHJvcGVydGllc0Zyb21TdHlsZXModGhpcy5fc3R5bGVzKSk7CnByb3BlcnR5VXRpbHMubWl4aW5DdXN0b21TdHlsZShwcm9wcywgdGhpcy5jdXN0b21TdHlsZSk7CnByb3BlcnR5VXRpbHMucmVpZnkocHJvcHMpOwp0aGlzLl9zdHlsZVByb3BlcnRpZXMgPSBwcm9wczsKfSwKX2NvbXB1dGVPd25TdHlsZVByb3BlcnRpZXM6IGZ1bmN0aW9uICgpIHsKdmFyIHByb3BzID0ge307CmZvciAodmFyIGkgPSAwLCBuOyBpIDwgdGhpcy5fb3duU3R5bGVQcm9wZXJ0eU5hbWVzLmxlbmd0aDsgaSsrKSB7Cm4gPSB0aGlzLl9vd25TdHlsZVByb3BlcnR5TmFtZXNbaV07CnByb3BzW25dID0gdGhpcy5fc3R5bGVQcm9wZXJ0aWVzW25dOwp9CnRoaXMuX293blN0eWxlUHJvcGVydGllcyA9IHByb3BzOwp9LApfc2NvcGVDb3VudDogMCwKX2FwcGx5U3R5bGVQcm9wZXJ0aWVzOiBmdW5jdGlvbiAoaW5mbykgewp2YXIgb2xkU2NvcGVTZWxlY3RvciA9IHRoaXMuX3Njb3BlU2VsZWN0b3I7CnRoaXMuX3Njb3BlU2VsZWN0b3IgPSBpbmZvID8gaW5mby5fc2NvcGVTZWxlY3RvciA6IHRoaXMuaXMgKyAnLScgKyB0aGlzLl9fcHJvdG9fXy5fc2NvcGVDb3VudCsrOwp2YXIgc3R5bGUgPSBwcm9wZXJ0eVV0aWxzLmFwcGx5RWxlbWVudFN0eWxlKHRoaXMsIHRoaXMuX3N0eWxlUHJvcGVydGllcywgdGhpcy5fc2NvcGVTZWxlY3RvciwgaW5mbyAmJiBpbmZvLnN0eWxlKTsKaWYgKCFuYXRpdmVTaGFkb3cpIHsKcHJvcGVydHlVdGlscy5hcHBseUVsZW1lbnRTY29wZVNlbGVjdG9yKHRoaXMsIHRoaXMuX3Njb3BlU2VsZWN0b3IsIG9sZFNjb3BlU2VsZWN0b3IsIHRoaXMuX3Njb3BlQ3NzVmlhQXR0cik7Cn0KcmV0dXJuIHN0eWxlOwp9LApzZXJpYWxpemVWYWx1ZVRvQXR0cmlidXRlOiBmdW5jdGlvbiAodmFsdWUsIGF0dHJpYnV0ZSwgbm9kZSkgewpub2RlID0gbm9kZSB8fCB0aGlzOwppZiAoYXR0cmlidXRlID09PSAnY2xhc3MnICYmICFuYXRpdmVTaGFkb3cpIHsKdmFyIGhvc3QgPSBub2RlID09PSB0aGlzID8gdGhpcy5kb21Ib3N0IHx8IHRoaXMuZGF0YUhvc3QgOiB0aGlzOwppZiAoaG9zdCkgewp2YWx1ZSA9IGhvc3QuX3Njb3BlRWxlbWVudENsYXNzKG5vZGUsIHZhbHVlKTsKfQp9Cm5vZGUgPSBQb2x5bWVyLmRvbShub2RlKTsKc2VyaWFsaXplVmFsdWVUb0F0dHJpYnV0ZS5jYWxsKHRoaXMsIHZhbHVlLCBhdHRyaWJ1dGUsIG5vZGUpOwp9LApfc2NvcGVFbGVtZW50Q2xhc3M6IGZ1bmN0aW9uIChlbGVtZW50LCBzZWxlY3RvcikgewppZiAoIW5hdGl2ZVNoYWRvdyAmJiAhdGhpcy5fc2NvcGVDc3NWaWFBdHRyKSB7CnNlbGVjdG9yICs9IChzZWxlY3RvciA/ICcgJyA6ICcnKSArIFNDT1BFX05BTUUgKyAnICcgKyB0aGlzLmlzICsgKGVsZW1lbnQuX3Njb3BlU2VsZWN0b3IgPyAnICcgKyBYU0NPUEVfTkFNRSArICcgJyArIGVsZW1lbnQuX3Njb3BlU2VsZWN0b3IgOiAnJyk7Cn0KcmV0dXJuIHNlbGVjdG9yOwp9LAp1cGRhdGVTdHlsZXM6IGZ1bmN0aW9uIChwcm9wZXJ0aWVzKSB7CmlmICh0aGlzLmlzQXR0YWNoZWQpIHsKaWYgKHByb3BlcnRpZXMpIHsKdGhpcy5taXhpbih0aGlzLmN1c3RvbVN0eWxlLCBwcm9wZXJ0aWVzKTsKfQppZiAodGhpcy5fbmVlZHNTdHlsZVByb3BlcnRpZXMoKSkgewp0aGlzLl91cGRhdGVTdHlsZVByb3BlcnRpZXMoKTsKfSBlbHNlIHsKdGhpcy5fc3R5bGVQcm9wZXJ0aWVzID0gbnVsbDsKfQppZiAodGhpcy5fc3R5bGVDYWNoZSkgewp0aGlzLl9zdHlsZUNhY2hlLmNsZWFyKCk7Cn0KdGhpcy5fdXBkYXRlUm9vdFN0eWxlcygpOwp9Cn0sCl91cGRhdGVSb290U3R5bGVzOiBmdW5jdGlvbiAocm9vdCkgewpyb290ID0gcm9vdCB8fCB0aGlzLnJvb3Q7CnZhciBjJCA9IFBvbHltZXIuZG9tKHJvb3QpLl9xdWVyeShmdW5jdGlvbiAoZSkgewpyZXR1cm4gZS5zaGFkeVJvb3QgfHwgZS5zaGFkb3dSb290Owp9KTsKZm9yICh2YXIgaSA9IDAsIGwgPSBjJC5sZW5ndGgsIGM7IGkgPCBsICYmIChjID0gYyRbaV0pOyBpKyspIHsKaWYgKGMudXBkYXRlU3R5bGVzKSB7CmMudXBkYXRlU3R5bGVzKCk7Cn0KfQp9Cn0pOwpQb2x5bWVyLnVwZGF0ZVN0eWxlcyA9IGZ1bmN0aW9uIChwcm9wZXJ0aWVzKSB7CnN0eWxlRGVmYXVsdHMudXBkYXRlU3R5bGVzKHByb3BlcnRpZXMpOwpQb2x5bWVyLkJhc2UuX3VwZGF0ZVJvb3RTdHlsZXMoZG9jdW1lbnQpOwp9Owp2YXIgc3R5bGVDYWNoZSA9IG5ldyBQb2x5bWVyLlN0eWxlQ2FjaGUoKTsKUG9seW1lci5jdXN0b21TdHlsZUNhY2hlID0gc3R5bGVDYWNoZTsKdmFyIFNDT1BFX05BTUUgPSBzdHlsZVRyYW5zZm9ybWVyLlNDT1BFX05BTUU7CnZhciBYU0NPUEVfTkFNRSA9IHByb3BlcnR5VXRpbHMuWFNDT1BFX05BTUU7Cn0oKSk7ClBvbHltZXIuQmFzZS5fYWRkRmVhdHVyZSh7Cl9yZWdpc3RlckZlYXR1cmVzOiBmdW5jdGlvbiAoKSB7CnRoaXMuX3ByZXBJcygpOwp0aGlzLl9wcmVwQXR0cmlidXRlcygpOwp0aGlzLl9wcmVwQ29uc3RydWN0b3IoKTsKdGhpcy5fcHJlcFRlbXBsYXRlKCk7CnRoaXMuX3ByZXBTdHlsZXMoKTsKdGhpcy5fcHJlcFN0eWxlUHJvcGVydGllcygpOwp0aGlzLl9wcmVwQW5ub3RhdGlvbnMoKTsKdGhpcy5fcHJlcEVmZmVjdHMoKTsKdGhpcy5fcHJlcEJlaGF2aW9ycygpOwp0aGlzLl9wcmVwQmluZGluZ3MoKTsKdGhpcy5fcHJlcFNoYWR5KCk7Cn0sCl9wcmVwQmVoYXZpb3I6IGZ1bmN0aW9uIChiKSB7CnRoaXMuX2FkZFByb3BlcnR5RWZmZWN0cyhiLnByb3BlcnRpZXMpOwp0aGlzLl9hZGRDb21wbGV4T2JzZXJ2ZXJFZmZlY3RzKGIub2JzZXJ2ZXJzKTsKdGhpcy5fYWRkSG9zdEF0dHJpYnV0ZXMoYi5ob3N0QXR0cmlidXRlcyk7Cn0sCl9pbml0RmVhdHVyZXM6IGZ1bmN0aW9uICgpIHsKdGhpcy5fcG9vbENvbnRlbnQoKTsKdGhpcy5fc2V0dXBDb25maWd1cmUoKTsKdGhpcy5fc2V0dXBTdHlsZVByb3BlcnRpZXMoKTsKdGhpcy5fcHVzaEhvc3QoKTsKdGhpcy5fc3RhbXBUZW1wbGF0ZSgpOwp0aGlzLl9wb3BIb3N0KCk7CnRoaXMuX21hcnNoYWxBbm5vdGF0aW9uUmVmZXJlbmNlcygpOwp0aGlzLl9zZXR1cERlYm91bmNlcnMoKTsKdGhpcy5fbWFyc2hhbEluc3RhbmNlRWZmZWN0cygpOwp0aGlzLl9tYXJzaGFsSG9zdEF0dHJpYnV0ZXMoKTsKdGhpcy5fbWFyc2hhbEJlaGF2aW9ycygpOwp0aGlzLl9tYXJzaGFsQXR0cmlidXRlcygpOwp0aGlzLl90cnlSZWFkeSgpOwp9LApfbWFyc2hhbEJlaGF2aW9yOiBmdW5jdGlvbiAoYikgewp0aGlzLl9saXN0ZW5MaXN0ZW5lcnMoYi5saXN0ZW5lcnMpOwp9Cn0pOwooZnVuY3Rpb24gKCkgewp2YXIgbmF0aXZlU2hhZG93ID0gUG9seW1lci5TZXR0aW5ncy51c2VOYXRpdmVTaGFkb3c7CnZhciBwcm9wZXJ0eVV0aWxzID0gUG9seW1lci5TdHlsZVByb3BlcnRpZXM7CnZhciBzdHlsZVV0aWwgPSBQb2x5bWVyLlN0eWxlVXRpbDsKdmFyIGNzc1BhcnNlID0gUG9seW1lci5Dc3NQYXJzZTsKdmFyIHN0eWxlRGVmYXVsdHMgPSBQb2x5bWVyLlN0eWxlRGVmYXVsdHM7CnZhciBzdHlsZVRyYW5zZm9ybWVyID0gUG9seW1lci5TdHlsZVRyYW5zZm9ybWVyOwpQb2x5bWVyKHsKaXM6ICdjdXN0b20tc3R5bGUnLApleHRlbmRzOiAnc3R5bGUnLApwcm9wZXJ0aWVzOiB7IGluY2x1ZGU6IFN0cmluZyB9LApyZWFkeTogZnVuY3Rpb24gKCkgewp0aGlzLl90cnlBcHBseSgpOwp9LAphdHRhY2hlZDogZnVuY3Rpb24gKCkgewp0aGlzLl90cnlBcHBseSgpOwp9LApfdHJ5QXBwbHk6IGZ1bmN0aW9uICgpIHsKaWYgKCF0aGlzLl9hcHBsaWVzVG9Eb2N1bWVudCkgewppZiAodGhpcy5wYXJlbnROb2RlICYmIHRoaXMucGFyZW50Tm9kZS5sb2NhbE5hbWUgIT09ICdkb20tbW9kdWxlJykgewp0aGlzLl9hcHBsaWVzVG9Eb2N1bWVudCA9IHRydWU7CnZhciBlID0gdGhpcy5fX2FwcGxpZWRFbGVtZW50IHx8IHRoaXM7CnN0eWxlRGVmYXVsdHMuYWRkU3R5bGUoZSk7CmlmIChlLnRleHRDb250ZW50IHx8IHRoaXMuaW5jbHVkZSkgewp0aGlzLl9hcHBseSgpOwp9IGVsc2Ugewp2YXIgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbiAoKSB7Cm9ic2VydmVyLmRpc2Nvbm5lY3QoKTsKdGhpcy5fYXBwbHkoKTsKfS5iaW5kKHRoaXMpKTsKb2JzZXJ2ZXIub2JzZXJ2ZShlLCB7IGNoaWxkTGlzdDogdHJ1ZSB9KTsKfQp9Cn0KfSwKX2FwcGx5OiBmdW5jdGlvbiAoKSB7CnZhciBlID0gdGhpcy5fX2FwcGxpZWRFbGVtZW50IHx8IHRoaXM7CmlmICh0aGlzLmluY2x1ZGUpIHsKZS50ZXh0Q29udGVudCA9IHN0eWxlVXRpbC5jc3NGcm9tTW9kdWxlcyh0aGlzLmluY2x1ZGUsIHRydWUpICsgZS50ZXh0Q29udGVudDsKfQppZiAoZS50ZXh0Q29udGVudCkgewpzdHlsZVV0aWwuZm9yRWFjaFN0eWxlUnVsZShzdHlsZVV0aWwucnVsZXNGb3JTdHlsZShlKSwgZnVuY3Rpb24gKHJ1bGUpIHsKc3R5bGVUcmFuc2Zvcm1lci5kb2N1bWVudFJ1bGUocnVsZSk7Cn0pOwp0aGlzLl9hcHBseUN1c3RvbVByb3BlcnRpZXMoZSk7Cn0KfSwKX2FwcGx5Q3VzdG9tUHJvcGVydGllczogZnVuY3Rpb24gKGVsZW1lbnQpIHsKdGhpcy5fY29tcHV0ZVN0eWxlUHJvcGVydGllcygpOwp2YXIgcHJvcHMgPSB0aGlzLl9zdHlsZVByb3BlcnRpZXM7CnZhciBydWxlcyA9IHN0eWxlVXRpbC5ydWxlc0ZvclN0eWxlKGVsZW1lbnQpOwplbGVtZW50LnRleHRDb250ZW50ID0gc3R5bGVVdGlsLnRvQ3NzVGV4dChydWxlcywgZnVuY3Rpb24gKHJ1bGUpIHsKdmFyIGNzcyA9IHJ1bGUuY3NzVGV4dCA9IHJ1bGUucGFyc2VkQ3NzVGV4dDsKaWYgKHJ1bGUucHJvcGVydHlJbmZvICYmIHJ1bGUucHJvcGVydHlJbmZvLmNzc1RleHQpIHsKY3NzID0gY3NzUGFyc2UucmVtb3ZlQ3VzdG9tUHJvcEFzc2lnbm1lbnQoY3NzKTsKcnVsZS5jc3NUZXh0ID0gcHJvcGVydHlVdGlscy52YWx1ZUZvclByb3BlcnRpZXMoY3NzLCBwcm9wcyk7Cn0KfSk7Cn0KfSk7Cn0oKSk7ClBvbHltZXIuVGVtcGxhdGl6ZXIgPSB7CnByb3BlcnRpZXM6IHsgX19oaWRlVGVtcGxhdGVDaGlsZHJlbl9fOiB7IG9ic2VydmVyOiAnX3Nob3dIaWRlQ2hpbGRyZW4nIH0gfSwKX2luc3RhbmNlUHJvcHM6IFBvbHltZXIubm9iLApfcGFyZW50UHJvcFByZWZpeDogJ19wYXJlbnRfJywKdGVtcGxhdGl6ZTogZnVuY3Rpb24gKHRlbXBsYXRlKSB7CnRoaXMuX3RlbXBsYXRpemVkID0gdGVtcGxhdGU7CmlmICghdGVtcGxhdGUuX2NvbnRlbnQpIHsKdGVtcGxhdGUuX2NvbnRlbnQgPSB0ZW1wbGF0ZS5jb250ZW50Owp9CmlmICh0ZW1wbGF0ZS5fY29udGVudC5fY3Rvcikgewp0aGlzLmN0b3IgPSB0ZW1wbGF0ZS5fY29udGVudC5fY3RvcjsKdGhpcy5fcHJlcFBhcmVudFByb3BlcnRpZXModGhpcy5jdG9yLnByb3RvdHlwZSwgdGVtcGxhdGUpOwpyZXR1cm47Cn0KdmFyIGFyY2hldHlwZSA9IE9iamVjdC5jcmVhdGUoUG9seW1lci5CYXNlKTsKdGhpcy5fY3VzdG9tUHJlcEFubm90YXRpb25zKGFyY2hldHlwZSwgdGVtcGxhdGUpOwp0aGlzLl9wcmVwUGFyZW50UHJvcGVydGllcyhhcmNoZXR5cGUsIHRlbXBsYXRlKTsKYXJjaGV0eXBlLl9wcmVwRWZmZWN0cygpOwp0aGlzLl9jdXN0b21QcmVwRWZmZWN0cyhhcmNoZXR5cGUpOwphcmNoZXR5cGUuX3ByZXBCZWhhdmlvcnMoKTsKYXJjaGV0eXBlLl9wcmVwQmluZGluZ3MoKTsKYXJjaGV0eXBlLl9ub3RpZnlQYXRoID0gdGhpcy5fbm90aWZ5UGF0aEltcGw7CmFyY2hldHlwZS5fc2NvcGVFbGVtZW50Q2xhc3MgPSB0aGlzLl9zY29wZUVsZW1lbnRDbGFzc0ltcGw7CmFyY2hldHlwZS5saXN0ZW4gPSB0aGlzLl9saXN0ZW5JbXBsOwphcmNoZXR5cGUuX3Nob3dIaWRlQ2hpbGRyZW4gPSB0aGlzLl9zaG93SGlkZUNoaWxkcmVuSW1wbDsKdmFyIF9jb25zdHJ1Y3RvciA9IHRoaXMuX2NvbnN0cnVjdG9ySW1wbDsKdmFyIGN0b3IgPSBmdW5jdGlvbiBUZW1wbGF0ZUluc3RhbmNlKG1vZGVsLCBob3N0KSB7Cl9jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIG1vZGVsLCBob3N0KTsKfTsKY3Rvci5wcm90b3R5cGUgPSBhcmNoZXR5cGU7CmFyY2hldHlwZS5jb25zdHJ1Y3RvciA9IGN0b3I7CnRlbXBsYXRlLl9jb250ZW50Ll9jdG9yID0gY3RvcjsKdGhpcy5jdG9yID0gY3RvcjsKfSwKX2dldFJvb3REYXRhSG9zdDogZnVuY3Rpb24gKCkgewpyZXR1cm4gdGhpcy5kYXRhSG9zdCAmJiB0aGlzLmRhdGFIb3N0Ll9yb290RGF0YUhvc3QgfHwgdGhpcy5kYXRhSG9zdDsKfSwKX3Nob3dIaWRlQ2hpbGRyZW5JbXBsOiBmdW5jdGlvbiAoaGlkZSkgewp2YXIgYyA9IHRoaXMuX2NoaWxkcmVuOwpmb3IgKHZhciBpID0gMDsgaSA8IGMubGVuZ3RoOyBpKyspIHsKdmFyIG4gPSBjW2ldOwppZiAoQm9vbGVhbihoaWRlKSAhPSBCb29sZWFuKG4uX19oaWRlVGVtcGxhdGVDaGlsZHJlbl9fKSkgewppZiAobi5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUpIHsKaWYgKGhpZGUpIHsKbi5fX3BvbHltZXJUZXh0Q29udGVudF9fID0gbi50ZXh0Q29udGVudDsKbi50ZXh0Q29udGVudCA9ICcnOwp9IGVsc2UgewpuLnRleHRDb250ZW50ID0gbi5fX3BvbHltZXJUZXh0Q29udGVudF9fOwp9Cn0gZWxzZSBpZiAobi5zdHlsZSkgewppZiAoaGlkZSkgewpuLl9fcG9seW1lckRpc3BsYXlfXyA9IG4uc3R5bGUuZGlzcGxheTsKbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwp9IGVsc2UgewpuLnN0eWxlLmRpc3BsYXkgPSBuLl9fcG9seW1lckRpc3BsYXlfXzsKfQp9Cn0Kbi5fX2hpZGVUZW1wbGF0ZUNoaWxkcmVuX18gPSBoaWRlOwp9Cn0sCl9kZWJvdW5jZVRlbXBsYXRlOiBmdW5jdGlvbiAoZm4pIHsKUG9seW1lci5kb20uYWRkRGVib3VuY2VyKHRoaXMuZGVib3VuY2UoJ19kZWJvdW5jZVRlbXBsYXRlJywgZm4pKTsKfSwKX2ZsdXNoVGVtcGxhdGVzOiBmdW5jdGlvbiAoZGVib3VuY2VyRXhwaXJlZCkgewpQb2x5bWVyLmRvbS5mbHVzaCgpOwp9LApfY3VzdG9tUHJlcEVmZmVjdHM6IGZ1bmN0aW9uIChhcmNoZXR5cGUpIHsKdmFyIHBhcmVudFByb3BzID0gYXJjaGV0eXBlLl9wYXJlbnRQcm9wczsKZm9yICh2YXIgcHJvcCBpbiBwYXJlbnRQcm9wcykgewphcmNoZXR5cGUuX2FkZFByb3BlcnR5RWZmZWN0KHByb3AsICdmdW5jdGlvbicsIHRoaXMuX2NyZWF0ZUhvc3RQcm9wRWZmZWN0b3IocHJvcCkpOwp9CmZvciAodmFyIHByb3AgaW4gdGhpcy5faW5zdGFuY2VQcm9wcykgewphcmNoZXR5cGUuX2FkZFByb3BlcnR5RWZmZWN0KHByb3AsICdmdW5jdGlvbicsIHRoaXMuX2NyZWF0ZUluc3RhbmNlUHJvcEVmZmVjdG9yKHByb3ApKTsKfQp9LApfY3VzdG9tUHJlcEFubm90YXRpb25zOiBmdW5jdGlvbiAoYXJjaGV0eXBlLCB0ZW1wbGF0ZSkgewphcmNoZXR5cGUuX3RlbXBsYXRlID0gdGVtcGxhdGU7CnZhciBjID0gdGVtcGxhdGUuX2NvbnRlbnQ7CmlmICghYy5fbm90ZXMpIHsKdmFyIHJvb3REYXRhSG9zdCA9IGFyY2hldHlwZS5fcm9vdERhdGFIb3N0OwppZiAocm9vdERhdGFIb3N0KSB7ClBvbHltZXIuQW5ub3RhdGlvbnMucHJlcEVsZW1lbnQgPSByb290RGF0YUhvc3QuX3ByZXBFbGVtZW50LmJpbmQocm9vdERhdGFIb3N0KTsKfQpjLl9ub3RlcyA9IFBvbHltZXIuQW5ub3RhdGlvbnMucGFyc2VBbm5vdGF0aW9ucyh0ZW1wbGF0ZSk7ClBvbHltZXIuQW5ub3RhdGlvbnMucHJlcEVsZW1lbnQgPSBudWxsOwp0aGlzLl9wcm9jZXNzQW5ub3RhdGlvbnMoYy5fbm90ZXMpOwp9CmFyY2hldHlwZS5fbm90ZXMgPSBjLl9ub3RlczsKYXJjaGV0eXBlLl9wYXJlbnRQcm9wcyA9IGMuX3BhcmVudFByb3BzOwp9LApfcHJlcFBhcmVudFByb3BlcnRpZXM6IGZ1bmN0aW9uIChhcmNoZXR5cGUsIHRlbXBsYXRlKSB7CnZhciBwYXJlbnRQcm9wcyA9IHRoaXMuX3BhcmVudFByb3BzID0gYXJjaGV0eXBlLl9wYXJlbnRQcm9wczsKaWYgKHRoaXMuX2ZvcndhcmRQYXJlbnRQcm9wICYmIHBhcmVudFByb3BzKSB7CnZhciBwcm90byA9IGFyY2hldHlwZS5fcGFyZW50UHJvcFByb3RvOwp2YXIgcHJvcDsKaWYgKCFwcm90bykgewpmb3IgKHByb3AgaW4gdGhpcy5faW5zdGFuY2VQcm9wcykgewpkZWxldGUgcGFyZW50UHJvcHNbcHJvcF07Cn0KcHJvdG8gPSBhcmNoZXR5cGUuX3BhcmVudFByb3BQcm90byA9IE9iamVjdC5jcmVhdGUobnVsbCk7CmlmICh0ZW1wbGF0ZSAhPSB0aGlzKSB7ClBvbHltZXIuQmluZC5wcmVwYXJlTW9kZWwocHJvdG8pOwpQb2x5bWVyLkJhc2UucHJlcGFyZU1vZGVsTm90aWZ5UGF0aChwcm90byk7Cn0KZm9yIChwcm9wIGluIHBhcmVudFByb3BzKSB7CnZhciBwYXJlbnRQcm9wID0gdGhpcy5fcGFyZW50UHJvcFByZWZpeCArIHByb3A7CnZhciBlZmZlY3RzID0gWwp7CmtpbmQ6ICdmdW5jdGlvbicsCmVmZmVjdDogdGhpcy5fY3JlYXRlRm9yd2FyZFByb3BFZmZlY3Rvcihwcm9wKQp9LAp7IGtpbmQ6ICdub3RpZnknIH0KXTsKUG9seW1lci5CaW5kLl9jcmVhdGVBY2Nlc3NvcnMocHJvdG8sIHBhcmVudFByb3AsIGVmZmVjdHMpOwp9Cn0KaWYgKHRlbXBsYXRlICE9IHRoaXMpIHsKUG9seW1lci5CaW5kLnByZXBhcmVJbnN0YW5jZSh0ZW1wbGF0ZSk7CnRlbXBsYXRlLl9mb3J3YXJkUGFyZW50UHJvcCA9IHRoaXMuX2ZvcndhcmRQYXJlbnRQcm9wLmJpbmQodGhpcyk7Cn0KdGhpcy5fZXh0ZW5kVGVtcGxhdGUodGVtcGxhdGUsIHByb3RvKTsKdGVtcGxhdGUuX3BhdGhFZmZlY3RvciA9IHRoaXMuX3BhdGhFZmZlY3RvckltcGwuYmluZCh0aGlzKTsKfQp9LApfY3JlYXRlRm9yd2FyZFByb3BFZmZlY3RvcjogZnVuY3Rpb24gKHByb3ApIHsKcmV0dXJuIGZ1bmN0aW9uIChzb3VyY2UsIHZhbHVlKSB7CnRoaXMuX2ZvcndhcmRQYXJlbnRQcm9wKHByb3AsIHZhbHVlKTsKfTsKfSwKX2NyZWF0ZUhvc3RQcm9wRWZmZWN0b3I6IGZ1bmN0aW9uIChwcm9wKSB7CnZhciBwcmVmaXggPSB0aGlzLl9wYXJlbnRQcm9wUHJlZml4OwpyZXR1cm4gZnVuY3Rpb24gKHNvdXJjZSwgdmFsdWUpIHsKdGhpcy5kYXRhSG9zdC5fdGVtcGxhdGl6ZWRbcHJlZml4ICsgcHJvcF0gPSB2YWx1ZTsKfTsKfSwKX2NyZWF0ZUluc3RhbmNlUHJvcEVmZmVjdG9yOiBmdW5jdGlvbiAocHJvcCkgewpyZXR1cm4gZnVuY3Rpb24gKHNvdXJjZSwgdmFsdWUsIG9sZCwgZnJvbUFib3ZlKSB7CmlmICghZnJvbUFib3ZlKSB7CnRoaXMuZGF0YUhvc3QuX2ZvcndhcmRJbnN0YW5jZVByb3AodGhpcywgcHJvcCwgdmFsdWUpOwp9Cn07Cn0sCl9leHRlbmRUZW1wbGF0ZTogZnVuY3Rpb24gKHRlbXBsYXRlLCBwcm90bykgewpPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhwcm90bykuZm9yRWFjaChmdW5jdGlvbiAobikgewp2YXIgdmFsID0gdGVtcGxhdGVbbl07CnZhciBwZCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocHJvdG8sIG4pOwpPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcGxhdGUsIG4sIHBkKTsKaWYgKHZhbCAhPT0gdW5kZWZpbmVkKSB7CnRlbXBsYXRlLl9wcm9wZXJ0eVNldHRlcihuLCB2YWwpOwp9Cn0pOwp9LApfc2hvd0hpZGVDaGlsZHJlbjogZnVuY3Rpb24gKGhpZGRlbikgewp9LApfZm9yd2FyZEluc3RhbmNlUGF0aDogZnVuY3Rpb24gKGluc3QsIHBhdGgsIHZhbHVlKSB7Cn0sCl9mb3J3YXJkSW5zdGFuY2VQcm9wOiBmdW5jdGlvbiAoaW5zdCwgcHJvcCwgdmFsdWUpIHsKfSwKX25vdGlmeVBhdGhJbXBsOiBmdW5jdGlvbiAocGF0aCwgdmFsdWUpIHsKdmFyIGRhdGFIb3N0ID0gdGhpcy5kYXRhSG9zdDsKdmFyIGRvdCA9IHBhdGguaW5kZXhPZignLi4vZGljdGlvbmFyeS1kNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZS5udWxsJyk7CnZhciByb290ID0gZG90IDwgMCA/IHBhdGggOiBwYXRoLnNsaWNlKDAsIGRvdCk7CmRhdGFIb3N0Ll9mb3J3YXJkSW5zdGFuY2VQYXRoLmNhbGwoZGF0YUhvc3QsIHRoaXMsIHBhdGgsIHZhbHVlKTsKaWYgKHJvb3QgaW4gZGF0YUhvc3QuX3BhcmVudFByb3BzKSB7CmRhdGFIb3N0Ll90ZW1wbGF0aXplZC5ub3RpZnlQYXRoKGRhdGFIb3N0Ll9wYXJlbnRQcm9wUHJlZml4ICsgcGF0aCwgdmFsdWUpOwp9Cn0sCl9wYXRoRWZmZWN0b3JJbXBsOiBmdW5jdGlvbiAocGF0aCwgdmFsdWUsIGZyb21BYm92ZSkgewppZiAodGhpcy5fZm9yd2FyZFBhcmVudFBhdGgpIHsKaWYgKHBhdGguaW5kZXhPZih0aGlzLl9wYXJlbnRQcm9wUHJlZml4KSA9PT0gMCkgewp2YXIgc3ViUGF0aCA9IHBhdGguc3Vic3RyaW5nKHRoaXMuX3BhcmVudFByb3BQcmVmaXgubGVuZ3RoKTsKdGhpcy5fZm9yd2FyZFBhcmVudFBhdGgoc3ViUGF0aCwgdmFsdWUpOwp9Cn0KUG9seW1lci5CYXNlLl9wYXRoRWZmZWN0b3IuY2FsbCh0aGlzLl90ZW1wbGF0aXplZCwgcGF0aCwgdmFsdWUsIGZyb21BYm92ZSk7Cn0sCl9jb25zdHJ1Y3RvckltcGw6IGZ1bmN0aW9uIChtb2RlbCwgaG9zdCkgewp0aGlzLl9yb290RGF0YUhvc3QgPSBob3N0Ll9nZXRSb290RGF0YUhvc3QoKTsKdGhpcy5fc2V0dXBDb25maWd1cmUobW9kZWwpOwp0aGlzLl9wdXNoSG9zdChob3N0KTsKdGhpcy5yb290ID0gdGhpcy5pbnN0YW5jZVRlbXBsYXRlKHRoaXMuX3RlbXBsYXRlKTsKdGhpcy5yb290Ll9fbm9Db250ZW50ID0gIXRoaXMuX25vdGVzLl9oYXNDb250ZW50Owp0aGlzLnJvb3QuX19zdHlsZVNjb3BlZCA9IHRydWU7CnRoaXMuX3BvcEhvc3QoKTsKdGhpcy5fbWFyc2hhbEFubm90YXRlZE5vZGVzKCk7CnRoaXMuX21hcnNoYWxJbnN0YW5jZUVmZmVjdHMoKTsKdGhpcy5fbWFyc2hhbEFubm90YXRlZExpc3RlbmVycygpOwp2YXIgY2hpbGRyZW4gPSBbXTsKZm9yICh2YXIgbiA9IHRoaXMucm9vdC5maXJzdENoaWxkOyBuOyBuID0gbi5uZXh0U2libGluZykgewpjaGlsZHJlbi5wdXNoKG4pOwpuLl90ZW1wbGF0ZUluc3RhbmNlID0gdGhpczsKfQp0aGlzLl9jaGlsZHJlbiA9IGNoaWxkcmVuOwppZiAoaG9zdC5fX2hpZGVUZW1wbGF0ZUNoaWxkcmVuX18pIHsKdGhpcy5fc2hvd0hpZGVDaGlsZHJlbih0cnVlKTsKfQp0aGlzLl90cnlSZWFkeSgpOwp9LApfbGlzdGVuSW1wbDogZnVuY3Rpb24gKG5vZGUsIGV2ZW50TmFtZSwgbWV0aG9kTmFtZSkgewp2YXIgbW9kZWwgPSB0aGlzOwp2YXIgaG9zdCA9IHRoaXMuX3Jvb3REYXRhSG9zdDsKdmFyIGhhbmRsZXIgPSBob3N0Ll9jcmVhdGVFdmVudEhhbmRsZXIobm9kZSwgZXZlbnROYW1lLCBtZXRob2ROYW1lKTsKdmFyIGRlY29yYXRlZCA9IGZ1bmN0aW9uIChlKSB7CmUubW9kZWwgPSBtb2RlbDsKaGFuZGxlcihlKTsKfTsKaG9zdC5fbGlzdGVuKG5vZGUsIGV2ZW50TmFtZSwgZGVjb3JhdGVkKTsKfSwKX3Njb3BlRWxlbWVudENsYXNzSW1wbDogZnVuY3Rpb24gKG5vZGUsIHZhbHVlKSB7CnZhciBob3N0ID0gdGhpcy5fcm9vdERhdGFIb3N0OwppZiAoaG9zdCkgewpyZXR1cm4gaG9zdC5fc2NvcGVFbGVtZW50Q2xhc3Mobm9kZSwgdmFsdWUpOwp9Cn0sCnN0YW1wOiBmdW5jdGlvbiAobW9kZWwpIHsKbW9kZWwgPSBtb2RlbCB8fCB7fTsKaWYgKHRoaXMuX3BhcmVudFByb3BzKSB7CnZhciB0ZW1wbGF0aXplZCA9IHRoaXMuX3RlbXBsYXRpemVkOwpmb3IgKHZhciBwcm9wIGluIHRoaXMuX3BhcmVudFByb3BzKSB7Cm1vZGVsW3Byb3BdID0gdGVtcGxhdGl6ZWRbdGhpcy5fcGFyZW50UHJvcFByZWZpeCArIHByb3BdOwp9Cn0KcmV0dXJuIG5ldyB0aGlzLmN0b3IobW9kZWwsIHRoaXMpOwp9LAptb2RlbEZvckVsZW1lbnQ6IGZ1bmN0aW9uIChlbCkgewp2YXIgbW9kZWw7CndoaWxlIChlbCkgewppZiAobW9kZWwgPSBlbC5fdGVtcGxhdGVJbnN0YW5jZSkgewppZiAobW9kZWwuZGF0YUhvc3QgIT0gdGhpcykgewplbCA9IG1vZGVsLmRhdGFIb3N0Owp9IGVsc2UgewpyZXR1cm4gbW9kZWw7Cn0KfSBlbHNlIHsKZWwgPSBlbC5wYXJlbnROb2RlOwp9Cn0KfQp9OwpQb2x5bWVyKHsKaXM6ICdkb20tdGVtcGxhdGUnLApleHRlbmRzOiAndGVtcGxhdGUnLApiZWhhdmlvcnM6IFtQb2x5bWVyLlRlbXBsYXRpemVyXSwKcmVhZHk6IGZ1bmN0aW9uICgpIHsKdGhpcy50ZW1wbGF0aXplKHRoaXMpOwp9Cn0pOwpQb2x5bWVyLl9jb2xsZWN0aW9ucyA9IG5ldyBXZWFrTWFwKCk7ClBvbHltZXIuQ29sbGVjdGlvbiA9IGZ1bmN0aW9uICh1c2VyQXJyYXkpIHsKUG9seW1lci5fY29sbGVjdGlvbnMuc2V0KHVzZXJBcnJheSwgdGhpcyk7CnRoaXMudXNlckFycmF5ID0gdXNlckFycmF5Owp0aGlzLnN0b3JlID0gdXNlckFycmF5LnNsaWNlKCk7CnRoaXMuaW5pdE1hcCgpOwp9OwpQb2x5bWVyLkNvbGxlY3Rpb24ucHJvdG90eXBlID0gewpjb25zdHJ1Y3RvcjogUG9seW1lci5Db2xsZWN0aW9uLAppbml0TWFwOiBmdW5jdGlvbiAoKSB7CnZhciBvbWFwID0gdGhpcy5vbWFwID0gbmV3IFdlYWtNYXAoKTsKdmFyIHBtYXAgPSB0aGlzLnBtYXAgPSB7fTsKdmFyIHMgPSB0aGlzLnN0b3JlOwpmb3IgKHZhciBpID0gMDsgaSA8IHMubGVuZ3RoOyBpKyspIHsKdmFyIGl0ZW0gPSBzW2ldOwppZiAoaXRlbSAmJiB0eXBlb2YgaXRlbSA9PSAnb2JqZWN0JykgewpvbWFwLnNldChpdGVtLCBpKTsKfSBlbHNlIHsKcG1hcFtpdGVtXSA9IGk7Cn0KfQp9LAphZGQ6IGZ1bmN0aW9uIChpdGVtKSB7CnZhciBrZXkgPSB0aGlzLnN0b3JlLnB1c2goaXRlbSkgLSAxOwppZiAoaXRlbSAmJiB0eXBlb2YgaXRlbSA9PSAnb2JqZWN0Jykgewp0aGlzLm9tYXAuc2V0KGl0ZW0sIGtleSk7Cn0gZWxzZSB7CnRoaXMucG1hcFtpdGVtXSA9IGtleTsKfQpyZXR1cm4ga2V5Owp9LApyZW1vdmVLZXk6IGZ1bmN0aW9uIChrZXkpIHsKdGhpcy5fcmVtb3ZlRnJvbU1hcCh0aGlzLnN0b3JlW2tleV0pOwpkZWxldGUgdGhpcy5zdG9yZVtrZXldOwp9LApfcmVtb3ZlRnJvbU1hcDogZnVuY3Rpb24gKGl0ZW0pIHsKaWYgKGl0ZW0gJiYgdHlwZW9mIGl0ZW0gPT0gJ29iamVjdCcpIHsKdGhpcy5vbWFwLmRlbGV0ZShpdGVtKTsKfSBlbHNlIHsKZGVsZXRlIHRoaXMucG1hcFtpdGVtXTsKfQp9LApyZW1vdmU6IGZ1bmN0aW9uIChpdGVtKSB7CnZhciBrZXkgPSB0aGlzLmdldEtleShpdGVtKTsKdGhpcy5yZW1vdmVLZXkoa2V5KTsKcmV0dXJuIGtleTsKfSwKZ2V0S2V5OiBmdW5jdGlvbiAoaXRlbSkgewppZiAoaXRlbSAmJiB0eXBlb2YgaXRlbSA9PSAnb2JqZWN0JykgewpyZXR1cm4gdGhpcy5vbWFwLmdldChpdGVtKTsKfSBlbHNlIHsKcmV0dXJuIHRoaXMucG1hcFtpdGVtXTsKfQp9LApnZXRLZXlzOiBmdW5jdGlvbiAoKSB7CnJldHVybiBPYmplY3Qua2V5cyh0aGlzLnN0b3JlKTsKfSwKc2V0SXRlbTogZnVuY3Rpb24gKGtleSwgaXRlbSkgewp2YXIgb2xkID0gdGhpcy5zdG9yZVtrZXldOwppZiAob2xkKSB7CnRoaXMuX3JlbW92ZUZyb21NYXAob2xkKTsKfQppZiAoaXRlbSAmJiB0eXBlb2YgaXRlbSA9PSAnb2JqZWN0Jykgewp0aGlzLm9tYXAuc2V0KGl0ZW0sIGtleSk7Cn0gZWxzZSB7CnRoaXMucG1hcFtpdGVtXSA9IGtleTsKfQp0aGlzLnN0b3JlW2tleV0gPSBpdGVtOwp9LApnZXRJdGVtOiBmdW5jdGlvbiAoa2V5KSB7CnJldHVybiB0aGlzLnN0b3JlW2tleV07Cn0sCmdldEl0ZW1zOiBmdW5jdGlvbiAoKSB7CnZhciBpdGVtcyA9IFtdLCBzdG9yZSA9IHRoaXMuc3RvcmU7CmZvciAodmFyIGtleSBpbiBzdG9yZSkgewppdGVtcy5wdXNoKHN0b3JlW2tleV0pOwp9CnJldHVybiBpdGVtczsKfSwKX2FwcGx5U3BsaWNlczogZnVuY3Rpb24gKHNwbGljZXMpIHsKdmFyIGtleU1hcCA9IHt9LCBrZXksIGk7CnNwbGljZXMuZm9yRWFjaChmdW5jdGlvbiAocykgewpzLmFkZGVkS2V5cyA9IFtdOwpmb3IgKGkgPSAwOyBpIDwgcy5yZW1vdmVkLmxlbmd0aDsgaSsrKSB7CmtleSA9IHRoaXMuZ2V0S2V5KHMucmVtb3ZlZFtpXSk7CmtleU1hcFtrZXldID0ga2V5TWFwW2tleV0gPyBudWxsIDogLTE7Cn0KZm9yIChpID0gMDsgaSA8IHMuYWRkZWRDb3VudDsgaSsrKSB7CnZhciBpdGVtID0gdGhpcy51c2VyQXJyYXlbcy5pbmRleCArIGldOwprZXkgPSB0aGlzLmdldEtleShpdGVtKTsKa2V5ID0ga2V5ID09PSB1bmRlZmluZWQgPyB0aGlzLmFkZChpdGVtKSA6IGtleTsKa2V5TWFwW2tleV0gPSBrZXlNYXBba2V5XSA/IG51bGwgOiAxOwpzLmFkZGVkS2V5cy5wdXNoKGtleSk7Cn0KfSwgdGhpcyk7CnZhciByZW1vdmVkID0gW107CnZhciBhZGRlZCA9IFtdOwpmb3IgKHZhciBrZXkgaW4ga2V5TWFwKSB7CmlmIChrZXlNYXBba2V5XSA8IDApIHsKdGhpcy5yZW1vdmVLZXkoa2V5KTsKcmVtb3ZlZC5wdXNoKGtleSk7Cn0KaWYgKGtleU1hcFtrZXldID4gMCkgewphZGRlZC5wdXNoKGtleSk7Cn0KfQpyZXR1cm4gW3sKcmVtb3ZlZDogcmVtb3ZlZCwKYWRkZWQ6IGFkZGVkCn1dOwp9Cn07ClBvbHltZXIuQ29sbGVjdGlvbi5nZXQgPSBmdW5jdGlvbiAodXNlckFycmF5KSB7CnJldHVybiBQb2x5bWVyLl9jb2xsZWN0aW9ucy5nZXQodXNlckFycmF5KSB8fCBuZXcgUG9seW1lci5Db2xsZWN0aW9uKHVzZXJBcnJheSk7Cn07ClBvbHltZXIuQ29sbGVjdGlvbi5hcHBseVNwbGljZXMgPSBmdW5jdGlvbiAodXNlckFycmF5LCBzcGxpY2VzKSB7CnZhciBjb2xsID0gUG9seW1lci5fY29sbGVjdGlvbnMuZ2V0KHVzZXJBcnJheSk7CnJldHVybiBjb2xsID8gY29sbC5fYXBwbHlTcGxpY2VzKHNwbGljZXMpIDogbnVsbDsKfTsKUG9seW1lcih7CmlzOiAnZG9tLXJlcGVhdCcsCmV4dGVuZHM6ICd0ZW1wbGF0ZScsCnByb3BlcnRpZXM6IHsKaXRlbXM6IHsgdHlwZTogQXJyYXkgfSwKYXM6IHsKdHlwZTogU3RyaW5nLAp2YWx1ZTogJ2l0ZW0nCn0sCmluZGV4QXM6IHsKdHlwZTogU3RyaW5nLAp2YWx1ZTogJ2luZGV4Jwp9LApzb3J0OiB7CnR5cGU6IEZ1bmN0aW9uLApvYnNlcnZlcjogJ19zb3J0Q2hhbmdlZCcKfSwKZmlsdGVyOiB7CnR5cGU6IEZ1bmN0aW9uLApvYnNlcnZlcjogJ19maWx0ZXJDaGFuZ2VkJwp9LApvYnNlcnZlOiB7CnR5cGU6IFN0cmluZywKb2JzZXJ2ZXI6ICdfb2JzZXJ2ZUNoYW5nZWQnCn0sCmRlbGF5OiBOdW1iZXIKfSwKYmVoYXZpb3JzOiBbUG9seW1lci5UZW1wbGF0aXplcl0sCm9ic2VydmVyczogWydfaXRlbXNDaGFuZ2VkKGl0ZW1zLiopJ10sCmNyZWF0ZWQ6IGZ1bmN0aW9uICgpIHsKdGhpcy5faW5zdGFuY2VzID0gW107Cn0sCmRldGFjaGVkOiBmdW5jdGlvbiAoKSB7CmZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5faW5zdGFuY2VzLmxlbmd0aDsgaSsrKSB7CnRoaXMuX2RldGFjaFJvdyhpKTsKfQp9LAphdHRhY2hlZDogZnVuY3Rpb24gKCkgewp2YXIgcGFyZW50Tm9kZSA9IFBvbHltZXIuZG9tKHRoaXMpLnBhcmVudE5vZGU7CmZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5faW5zdGFuY2VzLmxlbmd0aDsgaSsrKSB7ClBvbHltZXIuZG9tKHBhcmVudE5vZGUpLmluc2VydEJlZm9yZSh0aGlzLl9pbnN0YW5jZXNbaV0ucm9vdCwgdGhpcyk7Cn0KfSwKcmVhZHk6IGZ1bmN0aW9uICgpIHsKdGhpcy5faW5zdGFuY2VQcm9wcyA9IHsgX19rZXlfXzogdHJ1ZSB9Owp0aGlzLl9pbnN0YW5jZVByb3BzW3RoaXMuYXNdID0gdHJ1ZTsKdGhpcy5faW5zdGFuY2VQcm9wc1t0aGlzLmluZGV4QXNdID0gdHJ1ZTsKaWYgKCF0aGlzLmN0b3IpIHsKdGhpcy50ZW1wbGF0aXplKHRoaXMpOwp9Cn0sCl9zb3J0Q2hhbmdlZDogZnVuY3Rpb24gKCkgewp2YXIgZGF0YUhvc3QgPSB0aGlzLl9nZXRSb290RGF0YUhvc3QoKTsKdmFyIHNvcnQgPSB0aGlzLnNvcnQ7CnRoaXMuX3NvcnRGbiA9IHNvcnQgJiYgKHR5cGVvZiBzb3J0ID09ICdmdW5jdGlvbicgPyBzb3J0IDogZnVuY3Rpb24gKCkgewpyZXR1cm4gZGF0YUhvc3Rbc29ydF0uYXBwbHkoZGF0YUhvc3QsIGFyZ3VtZW50cyk7Cn0pOwp0aGlzLl9uZWVkRnVsbFJlZnJlc2ggPSB0cnVlOwppZiAodGhpcy5pdGVtcykgewp0aGlzLl9kZWJvdW5jZVRlbXBsYXRlKHRoaXMuX3JlbmRlcik7Cn0KfSwKX2ZpbHRlckNoYW5nZWQ6IGZ1bmN0aW9uICgpIHsKdmFyIGRhdGFIb3N0ID0gdGhpcy5fZ2V0Um9vdERhdGFIb3N0KCk7CnZhciBmaWx0ZXIgPSB0aGlzLmZpbHRlcjsKdGhpcy5fZmlsdGVyRm4gPSBmaWx0ZXIgJiYgKHR5cGVvZiBmaWx0ZXIgPT0gJ2Z1bmN0aW9uJyA/IGZpbHRlciA6IGZ1bmN0aW9uICgpIHsKcmV0dXJuIGRhdGFIb3N0W2ZpbHRlcl0uYXBwbHkoZGF0YUhvc3QsIGFyZ3VtZW50cyk7Cn0pOwp0aGlzLl9uZWVkRnVsbFJlZnJlc2ggPSB0cnVlOwppZiAodGhpcy5pdGVtcykgewp0aGlzLl9kZWJvdW5jZVRlbXBsYXRlKHRoaXMuX3JlbmRlcik7Cn0KfSwKX29ic2VydmVDaGFuZ2VkOiBmdW5jdGlvbiAoKSB7CnRoaXMuX29ic2VydmVQYXRocyA9IHRoaXMub2JzZXJ2ZSAmJiB0aGlzLm9ic2VydmUucmVwbGFjZSgnLionLCAnLi4vZGljdGlvbmFyeS1kNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZS5udWxsJykuc3BsaXQoJyAnKTsKfSwKX2l0ZW1zQ2hhbmdlZDogZnVuY3Rpb24gKGNoYW5nZSkgewppZiAoY2hhbmdlLnBhdGggPT0gJ2l0ZW1zJykgewppZiAoQXJyYXkuaXNBcnJheSh0aGlzLml0ZW1zKSkgewp0aGlzLmNvbGxlY3Rpb24gPSBQb2x5bWVyLkNvbGxlY3Rpb24uZ2V0KHRoaXMuaXRlbXMpOwp9IGVsc2UgaWYgKCF0aGlzLml0ZW1zKSB7CnRoaXMuY29sbGVjdGlvbiA9IG51bGw7Cn0gZWxzZSB7CnRoaXMuX2Vycm9yKHRoaXMuX2xvZ2YoJ2RvbS1yZXBlYXQnLCAnZXhwZWN0ZWQgYXJyYXkgZm9yIGBpdGVtc2AsJyArICcgZm91bmQnLCB0aGlzLml0ZW1zKSk7Cn0KdGhpcy5fa2V5U3BsaWNlcyA9IFtdOwp0aGlzLl9pbmRleFNwbGljZXMgPSBbXTsKdGhpcy5fbmVlZEZ1bGxSZWZyZXNoID0gdHJ1ZTsKdGhpcy5fZGVib3VuY2VUZW1wbGF0ZSh0aGlzLl9yZW5kZXIpOwp9IGVsc2UgaWYgKGNoYW5nZS5wYXRoID09ICdpdGVtcy5zcGxpY2VzJykgewp0aGlzLl9rZXlTcGxpY2VzID0gdGhpcy5fa2V5U3BsaWNlcy5jb25jYXQoY2hhbmdlLnZhbHVlLmtleVNwbGljZXMpOwp0aGlzLl9pbmRleFNwbGljZXMgPSB0aGlzLl9pbmRleFNwbGljZXMuY29uY2F0KGNoYW5nZS52YWx1ZS5pbmRleFNwbGljZXMpOwp0aGlzLl9kZWJvdW5jZVRlbXBsYXRlKHRoaXMuX3JlbmRlcik7Cn0gZWxzZSB7CnZhciBzdWJwYXRoID0gY2hhbmdlLnBhdGguc2xpY2UoNik7CnRoaXMuX2ZvcndhcmRJdGVtUGF0aChzdWJwYXRoLCBjaGFuZ2UudmFsdWUpOwp0aGlzLl9jaGVja09ic2VydmVkUGF0aHMoc3VicGF0aCk7Cn0KfSwKX2NoZWNrT2JzZXJ2ZWRQYXRoczogZnVuY3Rpb24gKHBhdGgpIHsKaWYgKHRoaXMuX29ic2VydmVQYXRocykgewpwYXRoID0gcGF0aC5zdWJzdHJpbmcocGF0aC5pbmRleE9mKCcuLi9kaWN0aW9uYXJ5LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlLm51bGwnKSArIDEpOwp2YXIgcGF0aHMgPSB0aGlzLl9vYnNlcnZlUGF0aHM7CmZvciAodmFyIGkgPSAwOyBpIDwgcGF0aHMubGVuZ3RoOyBpKyspIHsKaWYgKHBhdGguaW5kZXhPZihwYXRoc1tpXSkgPT09IDApIHsKdGhpcy5fbmVlZEZ1bGxSZWZyZXNoID0gdHJ1ZTsKaWYgKHRoaXMuZGVsYXkpIHsKdGhpcy5kZWJvdW5jZSgncmVuZGVyJywgdGhpcy5fcmVuZGVyLCB0aGlzLmRlbGF5KTsKfSBlbHNlIHsKdGhpcy5fZGVib3VuY2VUZW1wbGF0ZSh0aGlzLl9yZW5kZXIpOwp9CnJldHVybjsKfQp9Cn0KfSwKcmVuZGVyOiBmdW5jdGlvbiAoKSB7CnRoaXMuX25lZWRGdWxsUmVmcmVzaCA9IHRydWU7CnRoaXMuX2RlYm91bmNlVGVtcGxhdGUodGhpcy5fcmVuZGVyKTsKdGhpcy5fZmx1c2hUZW1wbGF0ZXMoKTsKfSwKX3JlbmRlcjogZnVuY3Rpb24gKCkgewp2YXIgYyA9IHRoaXMuY29sbGVjdGlvbjsKaWYgKHRoaXMuX25lZWRGdWxsUmVmcmVzaCkgewp0aGlzLl9hcHBseUZ1bGxSZWZyZXNoKCk7CnRoaXMuX25lZWRGdWxsUmVmcmVzaCA9IGZhbHNlOwp9IGVsc2UgewppZiAodGhpcy5fc29ydEZuKSB7CnRoaXMuX2FwcGx5U3BsaWNlc1VzZXJTb3J0KHRoaXMuX2tleVNwbGljZXMpOwp9IGVsc2UgewppZiAodGhpcy5fZmlsdGVyRm4pIHsKdGhpcy5fYXBwbHlGdWxsUmVmcmVzaCgpOwp9IGVsc2Ugewp0aGlzLl9hcHBseVNwbGljZXNBcnJheU9yZGVyKHRoaXMuX2luZGV4U3BsaWNlcyk7Cn0KfQp9CnRoaXMuX2tleVNwbGljZXMgPSBbXTsKdGhpcy5faW5kZXhTcGxpY2VzID0gW107CnZhciBrZXlUb0lkeCA9IHRoaXMuX2tleVRvSW5zdElkeCA9IHt9Owpmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2luc3RhbmNlcy5sZW5ndGg7IGkrKykgewp2YXIgaW5zdCA9IHRoaXMuX2luc3RhbmNlc1tpXTsKa2V5VG9JZHhbaW5zdC5fX2tleV9fXSA9IGk7Cmluc3QuX19zZXRQcm9wZXJ0eSh0aGlzLmluZGV4QXMsIGksIHRydWUpOwp9CnRoaXMuZmlyZSgnZG9tLWNoYW5nZScpOwp9LApfYXBwbHlGdWxsUmVmcmVzaDogZnVuY3Rpb24gKCkgewp2YXIgYyA9IHRoaXMuY29sbGVjdGlvbjsKdmFyIGtleXM7CmlmICh0aGlzLl9zb3J0Rm4pIHsKa2V5cyA9IGMgPyBjLmdldEtleXMoKSA6IFtdOwp9IGVsc2UgewprZXlzID0gW107CnZhciBpdGVtcyA9IHRoaXMuaXRlbXM7CmlmIChpdGVtcykgewpmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7CmtleXMucHVzaChjLmdldEtleShpdGVtc1tpXSkpOwp9Cn0KfQppZiAodGhpcy5fZmlsdGVyRm4pIHsKa2V5cyA9IGtleXMuZmlsdGVyKGZ1bmN0aW9uIChhKSB7CnJldHVybiB0aGlzLl9maWx0ZXJGbihjLmdldEl0ZW0oYSkpOwp9LCB0aGlzKTsKfQppZiAodGhpcy5fc29ydEZuKSB7CmtleXMuc29ydChmdW5jdGlvbiAoYSwgYikgewpyZXR1cm4gdGhpcy5fc29ydEZuKGMuZ2V0SXRlbShhKSwgYy5nZXRJdGVtKGIpKTsKfS5iaW5kKHRoaXMpKTsKfQpmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKdmFyIGtleSA9IGtleXNbaV07CnZhciBpbnN0ID0gdGhpcy5faW5zdGFuY2VzW2ldOwppZiAoaW5zdCkgewppbnN0Ll9fc2V0UHJvcGVydHkoJ19fa2V5X18nLCBrZXksIHRydWUpOwppbnN0Ll9fc2V0UHJvcGVydHkodGhpcy5hcywgYy5nZXRJdGVtKGtleSksIHRydWUpOwp9IGVsc2Ugewp0aGlzLl9pbnN0YW5jZXMucHVzaCh0aGlzLl9pbnNlcnRSb3coaSwga2V5KSk7Cn0KfQpmb3IgKDsgaSA8IHRoaXMuX2luc3RhbmNlcy5sZW5ndGg7IGkrKykgewp0aGlzLl9kZXRhY2hSb3coaSk7Cn0KdGhpcy5faW5zdGFuY2VzLnNwbGljZShrZXlzLmxlbmd0aCwgdGhpcy5faW5zdGFuY2VzLmxlbmd0aCAtIGtleXMubGVuZ3RoKTsKfSwKX2tleVNvcnQ6IGZ1bmN0aW9uIChhLCBiKSB7CnJldHVybiB0aGlzLmNvbGxlY3Rpb24uZ2V0S2V5KGEpIC0gdGhpcy5jb2xsZWN0aW9uLmdldEtleShiKTsKfSwKX251bWVyaWNTb3J0OiBmdW5jdGlvbiAoYSwgYikgewpyZXR1cm4gYSAtIGI7Cn0sCl9hcHBseVNwbGljZXNVc2VyU29ydDogZnVuY3Rpb24gKHNwbGljZXMpIHsKdmFyIGMgPSB0aGlzLmNvbGxlY3Rpb247CnZhciBpbnN0YW5jZXMgPSB0aGlzLl9pbnN0YW5jZXM7CnZhciBrZXlNYXAgPSB7fTsKdmFyIHBvb2wgPSBbXTsKdmFyIHNvcnRGbiA9IHRoaXMuX3NvcnRGbiB8fCB0aGlzLl9rZXlTb3J0LmJpbmQodGhpcyk7CnNwbGljZXMuZm9yRWFjaChmdW5jdGlvbiAocykgewpmb3IgKHZhciBpID0gMDsgaSA8IHMucmVtb3ZlZC5sZW5ndGg7IGkrKykgewp2YXIga2V5ID0gcy5yZW1vdmVkW2ldOwprZXlNYXBba2V5XSA9IGtleU1hcFtrZXldID8gbnVsbCA6IC0xOwp9CmZvciAodmFyIGkgPSAwOyBpIDwgcy5hZGRlZC5sZW5ndGg7IGkrKykgewp2YXIga2V5ID0gcy5hZGRlZFtpXTsKa2V5TWFwW2tleV0gPSBrZXlNYXBba2V5XSA/IG51bGwgOiAxOwp9Cn0sIHRoaXMpOwp2YXIgcmVtb3ZlZElkeHMgPSBbXTsKdmFyIGFkZGVkS2V5cyA9IFtdOwpmb3IgKHZhciBrZXkgaW4ga2V5TWFwKSB7CmlmIChrZXlNYXBba2V5XSA9PT0gLTEpIHsKcmVtb3ZlZElkeHMucHVzaCh0aGlzLl9rZXlUb0luc3RJZHhba2V5XSk7Cn0KaWYgKGtleU1hcFtrZXldID09PSAxKSB7CmFkZGVkS2V5cy5wdXNoKGtleSk7Cn0KfQppZiAocmVtb3ZlZElkeHMubGVuZ3RoKSB7CnJlbW92ZWRJZHhzLnNvcnQodGhpcy5fbnVtZXJpY1NvcnQpOwpmb3IgKHZhciBpID0gcmVtb3ZlZElkeHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKdmFyIGlkeCA9IHJlbW92ZWRJZHhzW2ldOwppZiAoaWR4ICE9PSB1bmRlZmluZWQpIHsKcG9vbC5wdXNoKHRoaXMuX2RldGFjaFJvdyhpZHgpKTsKaW5zdGFuY2VzLnNwbGljZShpZHgsIDEpOwp9Cn0KfQppZiAoYWRkZWRLZXlzLmxlbmd0aCkgewppZiAodGhpcy5fZmlsdGVyRm4pIHsKYWRkZWRLZXlzID0gYWRkZWRLZXlzLmZpbHRlcihmdW5jdGlvbiAoYSkgewpyZXR1cm4gdGhpcy5fZmlsdGVyRm4oYy5nZXRJdGVtKGEpKTsKfSwgdGhpcyk7Cn0KYWRkZWRLZXlzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKcmV0dXJuIHRoaXMuX3NvcnRGbihjLmdldEl0ZW0oYSksIGMuZ2V0SXRlbShiKSk7Cn0uYmluZCh0aGlzKSk7CnZhciBzdGFydCA9IDA7CmZvciAodmFyIGkgPSAwOyBpIDwgYWRkZWRLZXlzLmxlbmd0aDsgaSsrKSB7CnN0YXJ0ID0gdGhpcy5faW5zZXJ0Um93VXNlclNvcnQoc3RhcnQsIGFkZGVkS2V5c1tpXSwgcG9vbCk7Cn0KfQp9LApfaW5zZXJ0Um93VXNlclNvcnQ6IGZ1bmN0aW9uIChzdGFydCwga2V5LCBwb29sKSB7CnZhciBjID0gdGhpcy5jb2xsZWN0aW9uOwp2YXIgaXRlbSA9IGMuZ2V0SXRlbShrZXkpOwp2YXIgZW5kID0gdGhpcy5faW5zdGFuY2VzLmxlbmd0aCAtIDE7CnZhciBpZHggPSAtMTsKdmFyIHNvcnRGbiA9IHRoaXMuX3NvcnRGbiB8fCB0aGlzLl9rZXlTb3J0LmJpbmQodGhpcyk7CndoaWxlIChzdGFydCA8PSBlbmQpIHsKdmFyIG1pZCA9IHN0YXJ0ICsgZW5kID4+IDE7CnZhciBtaWRLZXkgPSB0aGlzLl9pbnN0YW5jZXNbbWlkXS5fX2tleV9fOwp2YXIgY21wID0gc29ydEZuKGMuZ2V0SXRlbShtaWRLZXkpLCBpdGVtKTsKaWYgKGNtcCA8IDApIHsKc3RhcnQgPSBtaWQgKyAxOwp9IGVsc2UgaWYgKGNtcCA+IDApIHsKZW5kID0gbWlkIC0gMTsKfSBlbHNlIHsKaWR4ID0gbWlkOwpicmVhazsKfQp9CmlmIChpZHggPCAwKSB7CmlkeCA9IGVuZCArIDE7Cn0KdGhpcy5faW5zdGFuY2VzLnNwbGljZShpZHgsIDAsIHRoaXMuX2luc2VydFJvdyhpZHgsIGtleSwgcG9vbCkpOwpyZXR1cm4gaWR4Owp9LApfYXBwbHlTcGxpY2VzQXJyYXlPcmRlcjogZnVuY3Rpb24gKHNwbGljZXMpIHsKdmFyIHBvb2wgPSBbXTsKdmFyIGMgPSB0aGlzLmNvbGxlY3Rpb247CnNwbGljZXMuZm9yRWFjaChmdW5jdGlvbiAocykgewpmb3IgKHZhciBpID0gMDsgaSA8IHMucmVtb3ZlZC5sZW5ndGg7IGkrKykgewp2YXIgaW5zdCA9IHRoaXMuX2RldGFjaFJvdyhzLmluZGV4ICsgaSk7CmlmICghaW5zdC5pc1BsYWNlaG9sZGVyKSB7CnBvb2wucHVzaChpbnN0KTsKfQp9CnRoaXMuX2luc3RhbmNlcy5zcGxpY2Uocy5pbmRleCwgcy5yZW1vdmVkLmxlbmd0aCk7CmZvciAodmFyIGkgPSAwOyBpIDwgcy5hZGRlZEtleXMubGVuZ3RoOyBpKyspIHsKdmFyIGluc3QgPSB7CmlzUGxhY2Vob2xkZXI6IHRydWUsCmtleTogcy5hZGRlZEtleXNbaV0KfTsKdGhpcy5faW5zdGFuY2VzLnNwbGljZShzLmluZGV4ICsgaSwgMCwgaW5zdCk7Cn0KfSwgdGhpcyk7CmZvciAodmFyIGkgPSB0aGlzLl9pbnN0YW5jZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKdmFyIGluc3QgPSB0aGlzLl9pbnN0YW5jZXNbaV07CmlmIChpbnN0LmlzUGxhY2Vob2xkZXIpIHsKdGhpcy5faW5zdGFuY2VzW2ldID0gdGhpcy5faW5zZXJ0Um93KGksIGluc3Qua2V5LCBwb29sLCB0cnVlKTsKfQp9Cn0sCl9kZXRhY2hSb3c6IGZ1bmN0aW9uIChpZHgpIHsKdmFyIGluc3QgPSB0aGlzLl9pbnN0YW5jZXNbaWR4XTsKaWYgKCFpbnN0LmlzUGxhY2Vob2xkZXIpIHsKdmFyIHBhcmVudE5vZGUgPSBQb2x5bWVyLmRvbSh0aGlzKS5wYXJlbnROb2RlOwpmb3IgKHZhciBpID0gMDsgaSA8IGluc3QuX2NoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CnZhciBlbCA9IGluc3QuX2NoaWxkcmVuW2ldOwpQb2x5bWVyLmRvbShpbnN0LnJvb3QpLmFwcGVuZENoaWxkKGVsKTsKfQp9CnJldHVybiBpbnN0Owp9LApfaW5zZXJ0Um93OiBmdW5jdGlvbiAoaWR4LCBrZXksIHBvb2wsIHJlcGxhY2UpIHsKdmFyIGluc3Q7CmlmIChpbnN0ID0gcG9vbCAmJiBwb29sLnBvcCgpKSB7Cmluc3QuX19zZXRQcm9wZXJ0eSh0aGlzLmFzLCB0aGlzLmNvbGxlY3Rpb24uZ2V0SXRlbShrZXkpLCB0cnVlKTsKaW5zdC5fX3NldFByb3BlcnR5KCdfX2tleV9fJywga2V5LCB0cnVlKTsKfSBlbHNlIHsKaW5zdCA9IHRoaXMuX2dlbmVyYXRlUm93KGlkeCwga2V5KTsKfQp2YXIgYmVmb3JlUm93ID0gdGhpcy5faW5zdGFuY2VzW3JlcGxhY2UgPyBpZHggKyAxIDogaWR4XTsKdmFyIGJlZm9yZU5vZGUgPSBiZWZvcmVSb3cgPyBiZWZvcmVSb3cuX2NoaWxkcmVuWzBdIDogdGhpczsKdmFyIHBhcmVudE5vZGUgPSBQb2x5bWVyLmRvbSh0aGlzKS5wYXJlbnROb2RlOwpQb2x5bWVyLmRvbShwYXJlbnROb2RlKS5pbnNlcnRCZWZvcmUoaW5zdC5yb290LCBiZWZvcmVOb2RlKTsKcmV0dXJuIGluc3Q7Cn0sCl9nZW5lcmF0ZVJvdzogZnVuY3Rpb24gKGlkeCwga2V5KSB7CnZhciBtb2RlbCA9IHsgX19rZXlfXzoga2V5IH07Cm1vZGVsW3RoaXMuYXNdID0gdGhpcy5jb2xsZWN0aW9uLmdldEl0ZW0oa2V5KTsKbW9kZWxbdGhpcy5pbmRleEFzXSA9IGlkeDsKdmFyIGluc3QgPSB0aGlzLnN0YW1wKG1vZGVsKTsKcmV0dXJuIGluc3Q7Cn0sCl9zaG93SGlkZUNoaWxkcmVuOiBmdW5jdGlvbiAoaGlkZGVuKSB7CmZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5faW5zdGFuY2VzLmxlbmd0aDsgaSsrKSB7CnRoaXMuX2luc3RhbmNlc1tpXS5fc2hvd0hpZGVDaGlsZHJlbihoaWRkZW4pOwp9Cn0sCl9mb3J3YXJkSW5zdGFuY2VQcm9wOiBmdW5jdGlvbiAoaW5zdCwgcHJvcCwgdmFsdWUpIHsKaWYgKHByb3AgPT0gdGhpcy5hcykgewp2YXIgaWR4OwppZiAodGhpcy5fc29ydEZuIHx8IHRoaXMuX2ZpbHRlckZuKSB7CmlkeCA9IHRoaXMuaXRlbXMuaW5kZXhPZih0aGlzLmNvbGxlY3Rpb24uZ2V0SXRlbShpbnN0Ll9fa2V5X18pKTsKfSBlbHNlIHsKaWR4ID0gaW5zdFt0aGlzLmluZGV4QXNdOwp9CnRoaXMuc2V0KCdpdGVtcy4nICsgaWR4LCB2YWx1ZSk7Cn0KfSwKX2ZvcndhcmRJbnN0YW5jZVBhdGg6IGZ1bmN0aW9uIChpbnN0LCBwYXRoLCB2YWx1ZSkgewppZiAocGF0aC5pbmRleE9mKHRoaXMuYXMgKyAnLi4vZGljdGlvbmFyeS1kNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZS5udWxsJykgPT09IDApIHsKdGhpcy5ub3RpZnlQYXRoKCdpdGVtcy4nICsgaW5zdC5fX2tleV9fICsgJy4uL2RpY3Rpb25hcnktZDQxZDhjZDk4ZjAwYjIwNGU5ODAwOTk4ZWNmODQyN2UubnVsbCcgKyBwYXRoLnNsaWNlKHRoaXMuYXMubGVuZ3RoICsgMSksIHZhbHVlKTsKfQp9LApfZm9yd2FyZFBhcmVudFByb3A6IGZ1bmN0aW9uIChwcm9wLCB2YWx1ZSkgewp0aGlzLl9pbnN0YW5jZXMuZm9yRWFjaChmdW5jdGlvbiAoaW5zdCkgewppbnN0Ll9fc2V0UHJvcGVydHkocHJvcCwgdmFsdWUsIHRydWUpOwp9LCB0aGlzKTsKfSwKX2ZvcndhcmRQYXJlbnRQYXRoOiBmdW5jdGlvbiAocGF0aCwgdmFsdWUpIHsKdGhpcy5faW5zdGFuY2VzLmZvckVhY2goZnVuY3Rpb24gKGluc3QpIHsKaW5zdC5ub3RpZnlQYXRoKHBhdGgsIHZhbHVlLCB0cnVlKTsKfSwgdGhpcyk7Cn0sCl9mb3J3YXJkSXRlbVBhdGg6IGZ1bmN0aW9uIChwYXRoLCB2YWx1ZSkgewppZiAodGhpcy5fa2V5VG9JbnN0SWR4KSB7CnZhciBkb3QgPSBwYXRoLmluZGV4T2YoJy4uL2RpY3Rpb25hcnktZDQxZDhjZDk4ZjAwYjIwNGU5ODAwOTk4ZWNmODQyN2UubnVsbCcpOwp2YXIga2V5ID0gcGF0aC5zdWJzdHJpbmcoMCwgZG90IDwgMCA/IHBhdGgubGVuZ3RoIDogZG90KTsKdmFyIGlkeCA9IHRoaXMuX2tleVRvSW5zdElkeFtrZXldOwp2YXIgaW5zdCA9IHRoaXMuX2luc3RhbmNlc1tpZHhdOwppZiAoaW5zdCkgewppZiAoZG90ID49IDApIHsKcGF0aCA9IHRoaXMuYXMgKyAnLi4vZGljdGlvbmFyeS1kNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZS5udWxsJyArIHBhdGguc3Vic3RyaW5nKGRvdCArIDEpOwppbnN0Lm5vdGlmeVBhdGgocGF0aCwgdmFsdWUsIHRydWUpOwp9IGVsc2UgewppbnN0Ll9fc2V0UHJvcGVydHkodGhpcy5hcywgdmFsdWUsIHRydWUpOwp9Cn0KfQp9LAppdGVtRm9yRWxlbWVudDogZnVuY3Rpb24gKGVsKSB7CnZhciBpbnN0YW5jZSA9IHRoaXMubW9kZWxGb3JFbGVtZW50KGVsKTsKcmV0dXJuIGluc3RhbmNlICYmIGluc3RhbmNlW3RoaXMuYXNdOwp9LAprZXlGb3JFbGVtZW50OiBmdW5jdGlvbiAoZWwpIHsKdmFyIGluc3RhbmNlID0gdGhpcy5tb2RlbEZvckVsZW1lbnQoZWwpOwpyZXR1cm4gaW5zdGFuY2UgJiYgaW5zdGFuY2UuX19rZXlfXzsKfSwKaW5kZXhGb3JFbGVtZW50OiBmdW5jdGlvbiAoZWwpIHsKdmFyIGluc3RhbmNlID0gdGhpcy5tb2RlbEZvckVsZW1lbnQoZWwpOwpyZXR1cm4gaW5zdGFuY2UgJiYgaW5zdGFuY2VbdGhpcy5pbmRleEFzXTsKfQp9KTsKUG9seW1lcih7CmlzOiAnYXJyYXktc2VsZWN0b3InLApwcm9wZXJ0aWVzOiB7Cml0ZW1zOiB7CnR5cGU6IEFycmF5LApvYnNlcnZlcjogJ2NsZWFyU2VsZWN0aW9uJwp9LAptdWx0aTogewp0eXBlOiBCb29sZWFuLAp2YWx1ZTogZmFsc2UsCm9ic2VydmVyOiAnY2xlYXJTZWxlY3Rpb24nCn0sCnNlbGVjdGVkOiB7CnR5cGU6IE9iamVjdCwKbm90aWZ5OiB0cnVlCn0sCnNlbGVjdGVkSXRlbTogewp0eXBlOiBPYmplY3QsCm5vdGlmeTogdHJ1ZQp9LAp0b2dnbGU6IHsKdHlwZTogQm9vbGVhbiwKdmFsdWU6IGZhbHNlCn0KfSwKY2xlYXJTZWxlY3Rpb246IGZ1bmN0aW9uICgpIHsKaWYgKEFycmF5LmlzQXJyYXkodGhpcy5zZWxlY3RlZCkpIHsKZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNlbGVjdGVkLmxlbmd0aDsgaSsrKSB7CnRoaXMudW5saW5rUGF0aHMoJ3NlbGVjdGVkLicgKyBpKTsKfQp9IGVsc2Ugewp0aGlzLnVubGlua1BhdGhzKCdzZWxlY3RlZCcpOwp9CmlmICh0aGlzLm11bHRpKSB7CmlmICghdGhpcy5zZWxlY3RlZCB8fCB0aGlzLnNlbGVjdGVkLmxlbmd0aCkgewp0aGlzLnNlbGVjdGVkID0gW107CnRoaXMuX3NlbGVjdGVkQ29sbCA9IFBvbHltZXIuQ29sbGVjdGlvbi5nZXQodGhpcy5zZWxlY3RlZCk7Cn0KfSBlbHNlIHsKdGhpcy5zZWxlY3RlZCA9IG51bGw7CnRoaXMuX3NlbGVjdGVkQ29sbCA9IG51bGw7Cn0KdGhpcy5zZWxlY3RlZEl0ZW0gPSBudWxsOwp9LAppc1NlbGVjdGVkOiBmdW5jdGlvbiAoaXRlbSkgewppZiAodGhpcy5tdWx0aSkgewpyZXR1cm4gdGhpcy5fc2VsZWN0ZWRDb2xsLmdldEtleShpdGVtKSAhPT0gdW5kZWZpbmVkOwp9IGVsc2UgewpyZXR1cm4gdGhpcy5zZWxlY3RlZCA9PSBpdGVtOwp9Cn0sCmRlc2VsZWN0OiBmdW5jdGlvbiAoaXRlbSkgewppZiAodGhpcy5tdWx0aSkgewppZiAodGhpcy5pc1NlbGVjdGVkKGl0ZW0pKSB7CnZhciBza2V5ID0gdGhpcy5fc2VsZWN0ZWRDb2xsLmdldEtleShpdGVtKTsKdGhpcy5hcnJheURlbGV0ZSgnc2VsZWN0ZWQnLCBpdGVtKTsKdGhpcy51bmxpbmtQYXRocygnc2VsZWN0ZWQuJyArIHNrZXkpOwp9Cn0gZWxzZSB7CnRoaXMuc2VsZWN0ZWQgPSBudWxsOwp0aGlzLnNlbGVjdGVkSXRlbSA9IG51bGw7CnRoaXMudW5saW5rUGF0aHMoJ3NlbGVjdGVkJyk7CnRoaXMudW5saW5rUGF0aHMoJ3NlbGVjdGVkSXRlbScpOwp9Cn0sCnNlbGVjdDogZnVuY3Rpb24gKGl0ZW0pIHsKdmFyIGljb2wgPSBQb2x5bWVyLkNvbGxlY3Rpb24uZ2V0KHRoaXMuaXRlbXMpOwp2YXIga2V5ID0gaWNvbC5nZXRLZXkoaXRlbSk7CmlmICh0aGlzLm11bHRpKSB7CmlmICh0aGlzLmlzU2VsZWN0ZWQoaXRlbSkpIHsKaWYgKHRoaXMudG9nZ2xlKSB7CnRoaXMuZGVzZWxlY3QoaXRlbSk7Cn0KfSBlbHNlIHsKdGhpcy5wdXNoKCdzZWxlY3RlZCcsIGl0ZW0pOwp2YXIgc2tleSA9IHRoaXMuX3NlbGVjdGVkQ29sbC5nZXRLZXkoaXRlbSk7CnRoaXMubGlua1BhdGhzKCdzZWxlY3RlZC4nICsgc2tleSwgJ2l0ZW1zLicgKyBrZXkpOwp9Cn0gZWxzZSB7CmlmICh0aGlzLnRvZ2dsZSAmJiBpdGVtID09IHRoaXMuc2VsZWN0ZWQpIHsKdGhpcy5kZXNlbGVjdCgpOwp9IGVsc2Ugewp0aGlzLnNlbGVjdGVkID0gaXRlbTsKdGhpcy5zZWxlY3RlZEl0ZW0gPSBpdGVtOwp0aGlzLmxpbmtQYXRocygnc2VsZWN0ZWQnLCAnaXRlbXMuJyArIGtleSk7CnRoaXMubGlua1BhdGhzKCdzZWxlY3RlZEl0ZW0nLCAnaXRlbXMuJyArIGtleSk7Cn0KfQp9Cn0pOwpQb2x5bWVyKHsKaXM6ICdkb20taWYnLApleHRlbmRzOiAndGVtcGxhdGUnLApwcm9wZXJ0aWVzOiB7CidpZic6IHsKdHlwZTogQm9vbGVhbiwKdmFsdWU6IGZhbHNlLApvYnNlcnZlcjogJ19xdWV1ZVJlbmRlcicKfSwKcmVzdGFtcDogewp0eXBlOiBCb29sZWFuLAp2YWx1ZTogZmFsc2UsCm9ic2VydmVyOiAnX3F1ZXVlUmVuZGVyJwp9Cn0sCmJlaGF2aW9yczogW1BvbHltZXIuVGVtcGxhdGl6ZXJdLApfcXVldWVSZW5kZXI6IGZ1bmN0aW9uICgpIHsKdGhpcy5fZGVib3VuY2VUZW1wbGF0ZSh0aGlzLl9yZW5kZXIpOwp9LApkZXRhY2hlZDogZnVuY3Rpb24gKCkgewp0aGlzLl90ZWFyZG93bkluc3RhbmNlKCk7Cn0sCmF0dGFjaGVkOiBmdW5jdGlvbiAoKSB7CmlmICh0aGlzLmlmICYmIHRoaXMuY3Rvcikgewp0aGlzLmFzeW5jKHRoaXMuX2Vuc3VyZUluc3RhbmNlKTsKfQp9LApyZW5kZXI6IGZ1bmN0aW9uICgpIHsKdGhpcy5fZmx1c2hUZW1wbGF0ZXMoKTsKfSwKX3JlbmRlcjogZnVuY3Rpb24gKCkgewppZiAodGhpcy5pZikgewppZiAoIXRoaXMuY3Rvcikgewp0aGlzLnRlbXBsYXRpemUodGhpcyk7Cn0KdGhpcy5fZW5zdXJlSW5zdGFuY2UoKTsKdGhpcy5fc2hvd0hpZGVDaGlsZHJlbigpOwp9IGVsc2UgaWYgKHRoaXMucmVzdGFtcCkgewp0aGlzLl90ZWFyZG93bkluc3RhbmNlKCk7Cn0KaWYgKCF0aGlzLnJlc3RhbXAgJiYgdGhpcy5faW5zdGFuY2UpIHsKdGhpcy5fc2hvd0hpZGVDaGlsZHJlbigpOwp9CmlmICh0aGlzLmlmICE9IHRoaXMuX2xhc3RJZikgewp0aGlzLmZpcmUoJ2RvbS1jaGFuZ2UnKTsKdGhpcy5fbGFzdElmID0gdGhpcy5pZjsKfQp9LApfZW5zdXJlSW5zdGFuY2U6IGZ1bmN0aW9uICgpIHsKaWYgKCF0aGlzLl9pbnN0YW5jZSkgewp0aGlzLl9pbnN0YW5jZSA9IHRoaXMuc3RhbXAoKTsKdmFyIHJvb3QgPSB0aGlzLl9pbnN0YW5jZS5yb290Owp2YXIgcGFyZW50ID0gUG9seW1lci5kb20oUG9seW1lci5kb20odGhpcykucGFyZW50Tm9kZSk7CnBhcmVudC5pbnNlcnRCZWZvcmUocm9vdCwgdGhpcyk7Cn0KfSwKX3RlYXJkb3duSW5zdGFuY2U6IGZ1bmN0aW9uICgpIHsKaWYgKHRoaXMuX2luc3RhbmNlKSB7CnZhciBjID0gdGhpcy5faW5zdGFuY2UuX2NoaWxkcmVuOwppZiAoYykgewp2YXIgcGFyZW50ID0gUG9seW1lci5kb20oUG9seW1lci5kb20oY1swXSkucGFyZW50Tm9kZSk7CmMuZm9yRWFjaChmdW5jdGlvbiAobikgewpwYXJlbnQucmVtb3ZlQ2hpbGQobik7Cn0pOwp9CnRoaXMuX2luc3RhbmNlID0gbnVsbDsKfQp9LApfc2hvd0hpZGVDaGlsZHJlbjogZnVuY3Rpb24gKCkgewp2YXIgaGlkZGVuID0gdGhpcy5fX2hpZGVUZW1wbGF0ZUNoaWxkcmVuX18gfHwgIXRoaXMuaWY7CmlmICh0aGlzLl9pbnN0YW5jZSkgewp0aGlzLl9pbnN0YW5jZS5fc2hvd0hpZGVDaGlsZHJlbihoaWRkZW4pOwp9Cn0sCl9mb3J3YXJkUGFyZW50UHJvcDogZnVuY3Rpb24gKHByb3AsIHZhbHVlKSB7CmlmICh0aGlzLl9pbnN0YW5jZSkgewp0aGlzLl9pbnN0YW5jZVtwcm9wXSA9IHZhbHVlOwp9Cn0sCl9mb3J3YXJkUGFyZW50UGF0aDogZnVuY3Rpb24gKHBhdGgsIHZhbHVlKSB7CmlmICh0aGlzLl9pbnN0YW5jZSkgewp0aGlzLl9pbnN0YW5jZS5ub3RpZnlQYXRoKHBhdGgsIHZhbHVlLCB0cnVlKTsKfQp9Cn0pOwpQb2x5bWVyKHsKaXM6ICdkb20tYmluZCcsCmV4dGVuZHM6ICd0ZW1wbGF0ZScsCmNyZWF0ZWQ6IGZ1bmN0aW9uICgpIHsKUG9seW1lci5SZW5kZXJTdGF0dXMud2hlblJlYWR5KHRoaXMuX21hcmtJbXBvcnRzUmVhZHkuYmluZCh0aGlzKSk7Cn0sCl9lbnN1cmVSZWFkeTogZnVuY3Rpb24gKCkgewppZiAoIXRoaXMuX3JlYWRpZWQpIHsKdGhpcy5fcmVhZHlTZWxmKCk7Cn0KfSwKX21hcmtJbXBvcnRzUmVhZHk6IGZ1bmN0aW9uICgpIHsKdGhpcy5faW1wb3J0c1JlYWR5ID0gdHJ1ZTsKdGhpcy5fZW5zdXJlUmVhZHkoKTsKfSwKX3JlZ2lzdGVyRmVhdHVyZXM6IGZ1bmN0aW9uICgpIHsKdGhpcy5fcHJlcENvbnN0cnVjdG9yKCk7Cn0sCl9pbnNlcnRDaGlsZHJlbjogZnVuY3Rpb24gKCkgewp2YXIgcGFyZW50RG9tID0gUG9seW1lci5kb20oUG9seW1lci5kb20odGhpcykucGFyZW50Tm9kZSk7CnBhcmVudERvbS5pbnNlcnRCZWZvcmUodGhpcy5yb290LCB0aGlzKTsKfSwKX3JlbW92ZUNoaWxkcmVuOiBmdW5jdGlvbiAoKSB7CmlmICh0aGlzLl9jaGlsZHJlbikgewpmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2NoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CnRoaXMucm9vdC5hcHBlbmRDaGlsZCh0aGlzLl9jaGlsZHJlbltpXSk7Cn0KfQp9LApfaW5pdEZlYXR1cmVzOiBmdW5jdGlvbiAoKSB7Cn0sCl9zY29wZUVsZW1lbnRDbGFzczogZnVuY3Rpb24gKGVsZW1lbnQsIHNlbGVjdG9yKSB7CmlmICh0aGlzLmRhdGFIb3N0KSB7CnJldHVybiB0aGlzLmRhdGFIb3N0Ll9zY29wZUVsZW1lbnRDbGFzcyhlbGVtZW50LCBzZWxlY3Rvcik7Cn0gZWxzZSB7CnJldHVybiBzZWxlY3RvcjsKfQp9LApfcHJlcENvbmZpZ3VyZTogZnVuY3Rpb24gKCkgewp2YXIgY29uZmlnID0ge307CmZvciAodmFyIHByb3AgaW4gdGhpcy5fcHJvcGVydHlFZmZlY3RzKSB7CmNvbmZpZ1twcm9wXSA9IHRoaXNbcHJvcF07Cn0KdGhpcy5fc2V0dXBDb25maWd1cmUgPSB0aGlzLl9zZXR1cENvbmZpZ3VyZS5iaW5kKHRoaXMsIGNvbmZpZyk7Cn0sCmF0dGFjaGVkOiBmdW5jdGlvbiAoKSB7CmlmICh0aGlzLl9pbXBvcnRzUmVhZHkpIHsKdGhpcy5yZW5kZXIoKTsKfQp9LApkZXRhY2hlZDogZnVuY3Rpb24gKCkgewp0aGlzLl9yZW1vdmVDaGlsZHJlbigpOwp9LApyZW5kZXI6IGZ1bmN0aW9uICgpIHsKdGhpcy5fZW5zdXJlUmVhZHkoKTsKaWYgKCF0aGlzLl9jaGlsZHJlbikgewp0aGlzLl90ZW1wbGF0ZSA9IHRoaXM7CnRoaXMuX3ByZXBBbm5vdGF0aW9ucygpOwp0aGlzLl9wcmVwRWZmZWN0cygpOwp0aGlzLl9wcmVwQmVoYXZpb3JzKCk7CnRoaXMuX3ByZXBDb25maWd1cmUoKTsKdGhpcy5fcHJlcEJpbmRpbmdzKCk7ClBvbHltZXIuQmFzZS5faW5pdEZlYXR1cmVzLmNhbGwodGhpcyk7CnRoaXMuX2NoaWxkcmVuID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5yb290LmNoaWxkTm9kZXMpOwp9CnRoaXMuX2luc2VydENoaWxkcmVuKCk7CnRoaXMuZmlyZSgnZG9tLWNoYW5nZScpOwp9Cn0pOzwvc2NyaXB0PgoK</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>