$(document).ready(function(){init_calendar("#calendar");focusFirst();$(".calendar").on("keypress","td.fc-day",function(b){13===b.keyCode&&$("#createEventModal").modal()});$("#actionItemModal").find(".datepicker").datepicker({allowPastDates:!0,momentConfig:{format:DEFAULT_DATE_DISPLAY_FORMAT}});$("#createActionItem").click(function(){actionItem.actionItemModal.init_action_item_modal(!0,PR_Calendar)});hideCalendarModal()});
var editAction=function(b){$.ajax({url:"/signal/action/getById?id="+b.id,async:!1,cache:!1}).done(function(a){a.action_types=action_select_values.types;a.action_configs=action_select_values.configs;a.all_status=action_select_values.allStatus;a.alertId=void 0;a.actionStatus={name:a.actionStatus};var c=signal.utils.render("action_editor",a);$("#action-editor-container").html(c);$("#action-editor-container #due-date-picker").datepicker({date:$("#due-date-picker").val()?new Date($("#due-date-picker").val()):
null,momentConfig:{culture:userLocale,format:DEFAULT_DATE_DISPLAY_FORMAT}});a=moment(a.dueDate,"DD-MMM-YYYY").format(DEFAULT_DATE_FORMAT);$("#action-editor-container").find("#due-date-picker").find("#dueDate").val(a);a=$("#action-edit-modal");"undefined"!=typeof alertId&&a.find(".id-element").attr("data-id",b.id);a.modal({});$("#action-edit-modal #cancel-bt").unbind().click(handle_action_editor_cancel);$("#action-edit-modal #update-bt").unbind().click(handle_action_editor_update)})},editMeeting=function(b){var a=
$("#meetingMinutesModal"),c="/signal/meeting/getById?meetingId="+b.id,e=b.id,f=$("#meetingModalForm");$.ajax({url:c,async:!1,cache:!1,dataType:"json"}).success(function(b){var d=$(".meetingMinutes");fillModalDataWithText(b,a,!1,"meeting-minutes");fillModalData(b,a,!1);disableFormFields(f);d.removeAttr("disabled");d.val(b.meetingMinutes);a.modal({})});$(".update-meeting").unbind().click(function(b){b=$("#meetingModalForm #appType").val();var d=$("#meetingModalForm #alertId").val();b="/signal/meeting/saveMeetingMinutes?appType="+
b+"&alertId="+d+"&meetingId="+e;var d=f.find("textarea.meetingMinutes").val(),c=new FormData;c.append("meetingMinutes",d);$.ajax({url:b,type:"POST",data:c,async:!1,processData:!1,contentType:!1,dataType:"json",cache:!1}).success(function(b){a.find(".form-control").val("");a.find("#attachments").val("");a.modal("hide");b="#"+signal.utils.localStorageUtil.getJSON("dashboardWidgetsConfig")["pvWidgetChart-6"].content.id;$(b).fullCalendar("destroy");init_calendar(b)})})},fillModalDataWithText=function(b,
a,c,e){var f=b.attendees;clearModal(a);for(var g=[],d=0;d<f.length;d++)g.push(f[d].id);f="";for(d=0;d<b.meetingAttachments.length;d++)f=f+"<div class='attachment-name'><a target='_blank' href='"+("/signal/meeting/viewAttachments?attachmentId="+b.meetingAttachments[d].id+"&meetingId="+b.id)+"' download='"+b.meetingAttachments[d].name+"' <i class='fa fa-file' aria-hidden='true' style='font-size: medium'> </i>"+b.meetingAttachments[d].name+"</a></div>";a.find(".attachments .attachment-body").html(f);
a.find(".id-element").attr("data-id",alertId);a.find(".meeting-id-element").attr("data-is-edit-series",c);c?(a.find(".meeting-id-element").attr("data-master-id",b.masterId),$("#cancelMeetingLink").hide(),$("#cancelMeetingSeriesLink").show(),a.find(".recurrence-checkbox-container").show(),$("#edit-meeting-title-container").text("Edit Series"),$(".isRecurringMeeting").attr("checked","checked"),$(".meetingDate").attr("disabled","disabled"),$(".meetingTime").attr("disabled","disabled"),$(".schedular-container").collapse("show")):
(a.find(".meeting-id-element").attr("data-meeting-id",b.id),$("#cancelMeetingLink").show(),$("#cancelMeetingSeriesLink").hide(),a.find(".recurrence-checkbox-container").hide(),$("#edit-meeting-title-container").text("Edit Meeting"),$(".isRecurringMeeting").removeAttr("checked"),$(".meetingDate").removeAttr("disabled"),$(".meetingTime").removeAttr("disabled"),$(".schedular-container").collapse("hide"));a.find("#meetingTitle").val(b.meetingTitle);a.find("#meetingOwner").val(b.ownerId);a.find("#meetingDate").val(moment(b.meetingDate).format("MM/DD/YYYY"));
a.find("#meetingTime").val(moment(b.meetingDate).format("HH:mm"));a.find("#due-date-picker").datepicker();a.find("#meetingAgenda").val(b.meetingAgenda);b.guestAttendees&&$.each(b.guestAttendees,function(b,c){a.find("#meetingAttendees-"+e).append("<option value='"+c+"'>"+c+"</option>");g.push(c)});a.find("#meetingAttendees-"+e).val("");a.find("#meetingAttendees-"+e).find("option.guestAttendee").remove();a.find("#meetingAttendees-"+e).val(g);showTagWidget("#meetingAttendees-"+e);a.find("#duration").val(b.duration)},
fillModalData=function(b,a,c){fillModalDataWithText(b,a,c,"edit")};function disableFormFields(b){b.find("input").attr("disabled",!0);b.find("select").attr("disabled",!0);b.find("textarea").attr("disabled",!0);b.find(".searchMeetingTimes").addClass("disabled")}function clearModal(b){b.find("input[type=text]").val("");b.find("textarea").val("")}
function showTagWidget(b){$(b).select2({placeholder:"Select Attendees",allowClear:!0,width:"100%",createTag:function(a){a=$.trim(a.term);return""!=a?{id:a,text:a}:null}})}
var init_calendar=function(b){$(b).fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},firstDay:1,eventLimit:!0,dayClick:function(a,b,e){a=moment(a).format(DEFAULT_DATE_DISPLAY_FORMAT);$("#dueDateHidden").val(a);$("#createEventModal #modalTitle").text("Add Events ( "+a+" )");$("#createEventModal").modal()},eventClick:function(a,b,e){switch(a.eventType){case "AGGREGATE_CASE_ALERT":window.open("/signal/aggregateCaseAlert/view?id="+a.id,"_blank");break;case "SINGLE_CASE_ALERT":window.open("/signal/singleCaseAlert/view?id="+
a.id,"_blank");break;case "ACTION_ITEM":editAction(a);break;case "MEETING":editMeeting(a)}},eventMouseover:function(a,b,e){$(this).css({"border-color":"#ba3939","border-width":"1px","border-style":"dashed"})},eventMouseout:function(a,b,e){$(this).css({"border-color":"#cccccc","border-width":"1px","border-style":"solid"})},events:function(a,b,e,f){jQuery.ajax({url:eventsUrl,type:"POST",dataType:"json",data:{start:a.format(DEFAULT_DATE_DISPLAY_FORMAT),end:b.format(DEFAULT_DATE_DISPLAY_FORMAT)},success:function(a){var b=
[];a&&$.map(a,function(a){b.push({id:a.id,title:a.title,start:moment.utc(a.startDate).tz(userTimeZone),end:a.endDate?moment.utc(a.endDate).tz(userTimeZone):void 0,url:getEventUrl(a.eventType,a.id),allDay:"MEETING"===a.eventType?a.allDay:!0,color:a.color,textColor:a.textColor,eventType:a.eventType})});f(b)}})},loading:function(a,b){a?$(".alert-info").removeClass("hide"):$(".alert-info").addClass("hide")}})};
function bindActionItemCRUD(b){$("#actionItemModal").find("#deleteActionItem").removeClass("hide");actionItem.actionItemModal.view_action_item(b);$(".action-item-delete").on("click",function(){actionItem.actionItemModal.delete_action_item(b,!0,PR_Calendar)});$(".edit-action-item").on("click",function(){actionItem.actionItemModal.edit_action_item(b,!0,null,null)});$(".update-action-item").on("click",function(){actionItem.actionItemModal.update_action_item(!0,$("#actionItemModal"),PR_Calendar)})}
function reloadCalendar(b,a){var c;c=$('<span title="Refresh Calender" class="glyphicon calendar-reloader-btn glyphicon-refresh"></span>');b.prepend(c);void 0!=a&&$(".calendar-reloader-btn").click(function(){$(".calendar-reloader-btn").addClass("glyphicon-refresh-animate");$(a).fullCalendar("refetchEvents")})}function hideCalendarModal(){$(".prModalHide").on("click",function(){$("#createEventModal").modal("hide")})}
function getEventUrl(b,a){if(b==EVENTS_TYPE_CONSTANTS.REPORT_REQUEST)return reportRequestShowURL+"/"+a;if(b==EVENTS_TYPE_CONSTANTS.EXECUTED_PERIODIC_REPORT)return executedPeriodicReportShowURL+"/"+a;if(b==EVENTS_TYPE_CONSTANTS.EXECUTED_ADHOC_REPORT)return executedAdhocReportShowURL+"/"+a;if(b==EVENTS_TYPE_CONSTANTS.SCHEDULED_ADHOC_REPORT)return adhocReportShowURL+"/"+a;if(b==EVENTS_TYPE_CONSTANTS.SCHEDULED_PERIODIC_REPORT)return periodicReportShowURL+"/"+a}
var EVENTS_TYPE_CONSTANTS={EXECUTED_ADHOC_REPORT:"EXECUTED_ADHOC_REPORT",SCHEDULED_ADHOC_REPORT:"SCHEDULED_ADHOC_REPORT",EXECUTED_PERIODIC_REPORT:"EXECUTED_PERIODIC_REPORT",SCHEDULED_PERIODIC_REPORT:"SCHEDULED_PERIODIC_REPORT",REPORT_REQUEST:"REPORT_REQUEST",ACTION_ITEM:"ACTION_ITEM"};