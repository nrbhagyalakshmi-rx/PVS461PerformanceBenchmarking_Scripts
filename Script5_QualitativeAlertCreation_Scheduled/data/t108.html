var EVENT_DICTIONARY="event",PRODUCT_DICTIONARY="product",STUDY_DICTIONARY="study",SMQBROAD="Broad",eventDictionaryObj,productDictionaryObj,studyDictionaryObj,selectedDictionaryValue=[],Dictionary=function(b,c,f,d,l,k,h){var m,a,e,g={};this.currentSelectedLevel=0;var n,p,q={},t,u,v=function(a){a&&(a.disabled=!0,a=a.style,document.location.href.split(),a.backgroundImage="url('"+u+"')",a.backgroundPosition="right center",a.backgroundRepeat="no-repeat")},w=function(a,b){return _.filter(a,function(a){if(a.id&&
b.id){if(a.id===b.id)return!1}else if(a.name===b.name)return!1;return!0})},r=function(a){for(var b={},e=1;e<=a;e++)b[e]=[];return b};this.setDictionaryLevelText=function(a,b){if(0<a){var e;switch(m){case EVENT_DICTIONARY:e=$(".selectedEventDictionaryValue")[0];break;case PRODUCT_DICTIONARY:e=$(".selectedProductDictionaryValue")[0];break;case STUDY_DICTIONARY:e=$(".selectedStudyDictionaryValue")[0]}e=$(e).find(".level"+a)[0];var g=$("<span class='dictionaryItem'>"+(" "==b.id?b.name:b.name+" ("+b.id+
")")+"<span class='closebtn removeSingleDictionaryValue'>\u00d7</span></span>"),c=g.find(".closebtn");c.attr("data-type",m);c.attr("data-level",a);c.attr("data-element",JSON.stringify(b));$(e).append(g)}};this.source=function(b,e,g,c,d,f){d=!0;var n=getDataSource();m===PRODUCT_DICTIONARY&&"pva"!=n&&(d=!1);if(b&&d){$(".addEventValues").prop("disabled",!0);$(".addProductValues").prop("disabled",!0);$(".addAllProductValues").prop("disabled",!0);$(".addStudyValues").prop("disabled",!0);$(".addAllStudyValues").prop("disabled",
!0);$(".addAllEvents").prop("disabled",!0);$(".addAllEventValues").prop("disabled",!0);$(".addAllProducts").prop("disabled",!0);$(".addAllStudies").prop("disabled",!0);$(".clearProductValues").prop("disabled",!0);$(".clearEventValues").prop("disabled",!0);$(".clearStudyValues").prop("disabled",!0);$(".modal-footer .loading").css("display","inline");var h=this;$.ajax({type:"POST",url:a+b+"&dataSource="+n+"&dictionaryLevel="+g+(f?"&currentLang="+f:""),dataType:"json",success:function(a){c&&(selectedDictionaryValue.id=
a.id,selectedDictionaryValue.name=a.name,selectedDictionaryValue.level=g,h.currentSelectedLevel=g,m===EVENT_DICTIONARY&&4==g&&(a.primarySOC?(selectedDictionaryValue.primarySOC=a.primarySOC,selectedDictionaryValue.primaryHLT=a.primaryHLT,selectedDictionaryValue.primaryHLGT=a.primaryHLGT):(selectedDictionaryValue.primarySOC=null,selectedDictionaryValue.primaryHLT=null,selectedDictionaryValue.primaryHLGT=null)));a.nextLevelItems.length?e({items:a.nextLevelItems,lang:a.lang},g):e({items:[],lang:a.lang},
g);$(".addEventValues").prop("disabled",!1);$(".addProductValues").prop("disabled",!1);$(".addAllProductValues").prop("disabled",!1);$(".addStudyValues").prop("disabled",!1);$(".addAllStudyValues").prop("disabled",!1);$(".addAllEvents").prop("disabled",!1);$(".addAllEventValues").prop("disabled",!1);$(".addAllProducts").prop("disabled",!1);$(".addAllStudies").prop("disabled",!1);$(".clearProductValues").prop("disabled",!1);$(".clearEventValues").prop("disabled",!1);$(".clearStudyValues").prop("disabled",
!1);$(".modal-footer .loading").css("display","none")}})}};this.sourceParents=function(a,b,g,c){var d=getDataSource(),f=e.split("?"),n=f[1].split("=")[0],d={dataSource:d,dictionaryLevel:b,currentLang:c?c:""};d[n]=""+a+"";a&&$.ajax({type:"POST",url:f[0],data:d,dataType:"json",success:function(a){0<a.length&&g({items:a,lang:c},b)}})};this.forSearch=function(a,b,e,g,c,d){this.currentSelectedLevel=b;v(d);var f=$("#event_exactSearch").is(":checked"),h=!1;m===PRODUCT_DICTIONARY?f=$("#product_exactSearch").is(":checked"):
m===STUDY_DICTIONARY&&(f=$("#study_exactSearch").is(":checked"),h=$("#study_imp").is(":checked"));var k=getDataSource();a=null!=delimiter&&"string"==typeof delimiter?{contains:a,dictionaryLevel:b,delimiter:delimiter,ref_level:e,exact_search:f,imp:h}:{contains:a,dictionaryLevel:b,ref_level:e,exact_search:f,imp:h};a.dataSource=k;if(g){var l={};$.each(g,function(a,b){l[b.key]=b.val});a.filters=JSON.stringify(l)}$.ajax({type:"POST",url:n,data:a,dataType:"json",success:function(a){a&&(addAllStudyValues(),
addAllProductValues());c({items:a},b);d&&(d.disabled=!1,d.style.backgroundImage="none")}})};this.addAllOptions=function(a){var b=this;a.each(function(){var a=$(this).text(),e=$(this).attr("dictionarylevel"),c=$(this).attr("data-value"),a={name:a,id:c,level:e};a:{e=a.level;for(c=0;c<g[e].length;c++)if(g[e][c].id==a.id){e=!0;break a}e=!1}e||(g[a.level].push({name:a.name,id:a.id}),b.setDictionaryLevelText(a.level,a))})};this.clearSearchInputs=function(a){_.each($(p),function(b,e){e==a||$(b).hasClass("additionalCriteria")||
(b.value="")})};var x=function(){_.each($("#productModal").find(".additionalCriteria"),function(a,b){$(a).html("")})};this.clearAdditionalFilters=function(){var a=$("#event_exactSearch");m==PRODUCT_DICTIONARY?(a=$("#product_exactSearch"),x()):m==STUDY_DICTIONARY?(a=$("#study_exactSearch"),$("#studyDrugs").select2("val","")):m==EVENT_DICTIONARY&&$("#eventSmqSelect").select2("val","");a.prop("checked",!1)};this.clearAllText=function(){var a=$(".eventDictionaryValue");m==PRODUCT_DICTIONARY?a=$(".productDictionaryValue"):
m==STUDY_DICTIONARY&&(a=$(".studyDictionaryValue"));_.each(a,function(a){a.innerHTML=""})};this.resetDictionaryList=function(){g=r(t)};this.setColumnViewText=function(a){var b=this,e;for(e in a)a.hasOwnProperty(e)&&_.each(a[e],function(a){b.setDictionaryLevelText(e,a)})};this.refresh=function(){var a=this,b;for(b in g)g.hasOwnProperty(b)&&_.each(g[b],function(e){a.setDictionaryLevelText(b,e)})};this.removeValue=function(a,b){g[a]=w(g[a],b);this.refresh()};this.getValues=function(){return g};this.setValues=
function(a){g=a};this.getLevels=function(){return q};this.setLevels=function(a){q=a};this.resetValues=function(){g=r(f)};this.construct=function(b,c,d,f,h,k,l){n=k;m=b;b===EVENT_DICTIONARY&&(a=f+"?eventId=",e=h+"?eventIds=",p="input.searchEvents");b===PRODUCT_DICTIONARY&&(a=f+"?productId=",e=h+"?productIds=",p="input.searchProducts");b===STUDY_DICTIONARY&&(a=f+"?studyId=",e=h+"?studyIds=",p="input.searchStudies");$.each(c.split(","),function(a,b){q[a+1]=b});t=d;g=r(d);u=l};return this.construct(b,
c,f,d,l,k,h)};
function intializeDictionaries(b){b.event&&(eventDictionaryObj=new Dictionary(EVENT_DICTIONARY,b.event.levelNames,b.event.dicColumnCount,b.event.selectUrl,b.event.preLevelParentsUrl,b.event.searchUrl,b.spinnerPath));b.product&&(productDictionaryObj=new Dictionary(PRODUCT_DICTIONARY,b.product.levelNames,b.product.dicColumnCount,b.product.selectUrl,b.product.preLevelParentsUrl,b.product.searchUrl,b.spinnerPath));b.study&&(studyDictionaryObj=new Dictionary(STUDY_DICTIONARY,b.study.levelNames,b.study.dicColumnCount,
b.study.selectUrl,b.study.preLevelParentsUrl,b.study.searchUrl,b.spinnerPath))}function getDictionaryObject(b){if(b){if(b.toLowerCase()===EVENT_DICTIONARY)return eventDictionaryObj;if(b.toLowerCase()===PRODUCT_DICTIONARY)return productDictionaryObj;if(b.toLowerCase()===STUDY_DICTIONARY)return studyDictionaryObj}}function source(b,c,f,d,l,k,h){getDictionaryObject(d).source(b,c,f,l,k,h)}function sourceParents(b,c,f,d,l){getDictionaryObject(d).sourceParents(b,c,f,l)}
function forSearch(b,c,f,d,l,k,h){getDictionaryObject(k).forSearch(b,c,f,d,l,h)}function addAllStudyValues(){$(document).on("click",".addAllStudyValues",function(){var b=getDictionaryObject(STUDY_DICTIONARY),c=$(this).parents("#studyModal").find('[class*="dicLi"][dictionarylevel="2"]');b.addAllOptions(c)})}
function addAllProductValues(){$(document).on("click",".addAllProductValues",function(){var b=getDictionaryObject(PRODUCT_DICTIONARY),c=$(this).parents("#productModal").find('[class*="dicLi"][dictionarylevel="'+b.currentSelectedLevel+'"]');b.addAllOptions(c)})}function clearSearchInputs(b,c){getDictionaryObject(c).clearSearchInputs(b)}function clearAdditionalFilters(b){getDictionaryObject(b).clearAdditionalFilters()}function clearAllText(b){getDictionaryObject(b).clearAllText()}
function resetDictionaryList(b){getDictionaryObject(b).resetDictionaryList()}function resetMultiSearchModal(){var b=$("#copyAndPasteDicModal");b.find(".copyPasteContent").val("");b.find(".c_n_p_other_delimiter").val("");b.find(":radio[value=none]").prop("checked",!0);$("#study_imp").is(":checked")&&$("#study_imp").prop("checked",!1)}function generateIdList(b){return _.map(b.items,function(b){return b.id.toString()})}
function generateColList(b){return _.map(b,function(b){return b.getAttribute("data-value")})}function collectNextCol(b){var c={},f=[];_.each(b,function(b){b={id:b.getAttribute("data-value"),name:b.innerText,level:b.getAttribute("dictionaryLevel")};f.push(b)});c.items=f;return c}
function generateNewDataForCol(b,c){var f=generateIdList(b),d=generateColList(c.querySelectorAll("li")),f=_.intersection(f,d),d=collectNextCol(c.querySelectorAll("li"));f?d.selectedPath=f[0]:(d=b,d.selectedPath=c.querySelector(".highlighted").getAttribute("data-value"));d.highlightedValue=c.querySelector(".highlighted").getAttribute("data-value");return d}
function setProductEventDictionary(){if(0<$("input[name=optradio]").size()){var b=$("input[name=optradio]:checked")[0];$(b).hasClass("productRadio")?$("#studySelection").val(""):$("#productSelection").val("").trigger("change")}}function getReportFieldLevel(){return $("#selectField option:selected").attr("data-level")}function getReportFieldDicType(){return $("#selectField option:selected").attr("data-dictionary")}function showEventDicIcon(b){b?$("#searchEvents").show():$("#searchEvents").hide()}
function showProductDicIcon(b){b?$("#searchProducts").show():$("#searchProducts").hide()}function showStudyDicIcon(b){b?$("#searchStudies").show():$("#searchStudies").hide()}function checkSuspectProduct(){checkProductDependedntCheckboxes("#suspectProduct")}function checkIncludeAllStudyDrugsCases(){checkProductDependedntCheckboxes("#includeAllStudyDrugsCases")}function checkHeaderProductSelection(){checkProductDependedntCheckboxes("input[id$='headerProductSelection']")}
function checkProductDependedntCheckboxes(b){""!==$("#productSelection").val()||$("#isTemplate").is(":checked")?$(b).removeAttr("disabled"):($(b).prop("checked",!1),$(b).attr("disabled",!0))}function getFieldLevelFromExpression(b){return $(b.querySelector("select.expressionField")).find("option:selected").attr("data-level")}
function showDictionaryValues(b,c,f,d){var l="";b.innerHTML="";for(var k in c)c.hasOwnProperty(k)&&_.each(c[k],function(b){l+=b.name+" ("+f[k]+"), "});c=document.createElement("div");d&&(c.style.padding="5px");c.innerHTML=l.substring(0,l.length-2);b.appendChild(c);checkSuspectProduct();checkIncludeAllStudyDrugsCases();checkHeaderProductSelection()}function getDataSource(){var b=$(".selectedDatasource");return 0<b.length?b.val():"pva"}
$(document).ready(function(){function b(a){var b=$("#eventSmqSelect").select2("data");if(b&&0<b.length)if(void 0!=a&&_.find(b,function(b){return a!=(d.type===SMQBROAD?7:8)}))$(".errorMessage").show();else{var g=getDictionaryObject(EVENT_DICTIONARY),c=g.getValues();null==c[7]&&(c[7]=[]);null==c[8]&&(c[8]=[]);for(var f=0;f<b.length;f++){var d=b[f],h=d.type==SMQBROAD?7:8;if(!_.find(c[h],function(a){return a.id==d.code})){var k={name:d.name,id:d.code};c[h].push(k);g.setDictionaryLevelText(h,k)}}g.setValues(c)}}
function c(a){var b="",c=!0,d;for(d in a)a.hasOwnProperty(d)&&0<a[d].length&&(c=!1);c||(b=JSON.stringify(a));return b}function f(a){a=$(a).closest("[class*='toAddContainer']").first();if(0<a.size())return getFieldLevelFromExpression(a[0])}function d(a){var b="";$.each(a,function(){b+=this.name+";"});return b.substring(0,b.length-1)}function l(a){var b=[];a&&$.each(a.split(";"),function(){b.push({name:this,id:" "})});return b}var k,h="true"===$("#editable").val();"true"!==$("#fromTemplate").val()&&
(checkSuspectProduct(),checkIncludeAllStudyDrugsCases(),checkHeaderProductSelection());$("#productSearchIconLoading").remove();$("#productSearchIcon").show();$("input:radio[name=optradio]").prop("disabled",!1);dictionaryBindMultipleSelect2WithUrl($(".eventSmq"),getSmqDropdownListUrl,!0);$(document).on("click",".addEventValues",function(){var a=f(k),e=$(this).parents("#eventModal").find(".dicLi.selectedBackground");$(".errorMessage").hide();if(void 0!=a)for(var c=0;c<e.length;c++)if($(e[c]).attr("dictionarylevel")!=
a){$(".errorMessage").show();return}b(a);getDictionaryObject(EVENT_DICTIONARY).addAllOptions(e)});$(document).on("click",".addProductValues",function(){var a=$(this).parents("#productModal").find(".dicLi.selectedBackground");getDictionaryObject(PRODUCT_DICTIONARY).addAllOptions(a)});$(document).on("click",".addAllProductValues",function(){var a=getDictionaryObject(PRODUCT_DICTIONARY),b=$(this).parents("#productModal").find('[class*="dicLi"][dictionarylevel="'+a.currentSelectedLevel+'"]');a.addAllOptions(b)});
$(document).on("click",".addStudyValues",function(){var a=$(this).parents("#studyModal").find(".dicLi.selectedBackground");getDictionaryObject(STUDY_DICTIONARY).addAllOptions(a)});$(document).on("click",".addAllStudyValues",function(){var a=getDictionaryObject(STUDY_DICTIONARY),b=$(this).parents("#studyModal").find('[class*="dicLi"][dictionarylevel="'+a.currentSelectedLevel+'"]');a.addAllOptions(b)});$(document).on("click",".addAllEvents",function(){var a=k,b=getDictionaryObject(EVENT_DICTIONARY),
a=$(a).closest("[class*='toAddContainer']").first(),g=b.getValues();0<a.size()?(b=getFieldLevelFromExpression(a[0]),$(getValueTextFromExpression(a[0])).val(d(g[b]))):($("#eventSelection").val(c(g)),showDictionaryValues(document.getElementById("showEventSelection"),g,b.getLevels(),h))});$(document).on("click",".addAllEventValues",function(){var a=f(k),c=getDictionaryObject(EVENT_DICTIONARY),g=$(this).parents("#eventModal").find('[class*="dicLi"][dictionarylevel="'+c.currentSelectedLevel+'"]');$(".errorMessage").hide();
if(void 0!=a)for(var d=0;d<g.length;d++)if($(g[d]).attr("dictionarylevel")!=a){$(".errorMessage").show();return}b(a);c.addAllOptions(g)});$(document).on("click",".addAllProducts",function(){var a=getDictionaryObject(PRODUCT_DICTIONARY);$("#productSelection").val(c(a.getValues())).trigger("change");checkSuspectProduct();checkIncludeAllStudyDrugsCases();checkHeaderProductSelection();showDictionaryValues(document.getElementById("showProductSelection"),a.getValues(),a.getLevels(),h)});$(document).on("click",
".addAllStudies",function(){var a=getDictionaryObject(STUDY_DICTIONARY);$("#studySelection").val(c(a.getValues()));checkSuspectProduct();checkIncludeAllStudyDrugsCases();checkHeaderProductSelection();showDictionaryValues(document.getElementById("showStudySelection"),a.getValues(),a.getLevels(),h)});$("#productSelection").change(function(){checkSuspectProduct();checkIncludeAllStudyDrugsCases();checkHeaderProductSelection()});(function(){if($("#eventSelection").val()){var a=getDictionaryObject(EVENT_DICTIONARY);
a.setValues(JSON.parse($("#eventSelection").val()));h&&a.setColumnViewText(a.getValues());showDictionaryValues(document.getElementById("showEventSelection"),a.getValues(),a.getLevels(),h)}$("#productSelection").val()&&(a=getDictionaryObject(PRODUCT_DICTIONARY),a.setValues(JSON.parse($("#productSelection").val())),h&&a.setColumnViewText(a.getValues()),showDictionaryValues(document.getElementById("showProductSelection"),a.getValues(),a.getLevels(),h));$("#studySelection").val()&&(a=getDictionaryObject(STUDY_DICTIONARY),
a.setValues(JSON.parse($("#studySelection").val())),h&&a.setColumnViewText(a.getValues()),showDictionaryValues(document.getElementById("showStudySelection"),a.getValues(),a.getLevels(),h))})();var m=!1;$(window).keydown(function(a){13==a.keyCode&&m&&a.preventDefault()});$("#productModal, #eventModal, #studyModal").on("shown.bs.modal",function(a){m=!0});$("#productModal, #eventModal, #studyModal").on("hidden.bs.modal",function(a){m=!1});$("#eventModal").on("show.bs.modal",function(a){k=$(a.relatedTarget);
$("#mainContent").trigger("columnView.reset."+EVENT_DICTIONARY);var b=k;a=getDictionaryObject(EVENT_DICTIONARY);var c=$(b).closest("[class*='toAddContainer']").first();a.resetValues();b=a.getValues();if(0<c.size()){var d=getFieldLevelFromExpression(c[0]),c=$(getValueTextFromExpression(c[0])).val();b[d]=l(c)}else $("#eventSelection").val()&&(b=JSON.parse($("#eventSelection").val()));a.setValues(b);a=getDictionaryObject(EVENT_DICTIONARY);a.setColumnViewText(a.getValues())});$(document).on("click",".removeSingleDictionaryValue",
function(a){var b=$(this),c=b.attr("data-type");a=b.attr("data-level");b=JSON.parse(b.attr("data-element"));c=getDictionaryObject(c);c.clearAllText();c.removeValue(a,b)});$("ul").on("keypress","li",function(a){92===a.keyCode&&$(this).click()});$(".prodDictFilterColCalc").on("keypress","i.modal-link",function(a){92===a.keyCode&&$(this).click()})});