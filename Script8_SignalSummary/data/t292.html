var signal=signal||{};
signal.alertdoc_util=function(){var d=function(c){$("#alert-document-table").DataTable().ajax.url("/signal/alertDocument/listByAlert?alertId="+c).load();signal.activities_utils.reload_activity_table()},f=function(c){$("#alert-document-table").DataTable().ajax.url("/signal/alertDocument/listBySignal?signalId="+c).load();signal.activities_utils.reload_activity_table()},g=function(){$("#documentModal #productNameFilter").val("");$("#documentModal #documentTypeFilter").val("")};return{init_doc_modal:function(c){return $("#documentModalTable").DataTable({language:{url:"../assets/i18n/dataTables_"+
userLocale+".json"},initComplete:function(){},ajax:{url:c,dataSrc:""},aaSorting:[[3,"desc"]],bLengthChange:!0,bProcessing:!0,oLanguage:{sProcessing:'<div class="grid-loading"><img src="/signal/assets/spinner.gif" width="30" align="middle" /></div>',sZeroRecords:"",sEmptyTable:""},bAutoWidth:!0,iDisplayLength:10,aLengthMenu:[[10,20,50,-1],[10,20,50,"All"]],scrollX:!0,aoColumns:[{mData:"",orderable:!1,className:"col-min-25",mRender:function(a,b,e){return"<input type='checkbox' data-chronical-id='"+
e.chronicleId+"'/>"}},{mData:"chronicleId",className:"col-min-100"},{mData:"documentType",className:"col-min-150"},{mData:"documentLink",className:"col-min-150"},{mData:"productName",className:"col-min-150"},{mData:"startDate",className:"col-min-100",mRender:function(a,b,e){return e.startDate}},{mData:"documentStatus",className:"col-min-150"},{mData:"author",className:"col-min-150"},{mData:"statusDate",className:"col-min-100"}],fnInitComplete:function(){$(".filterDocuments").click(function(){var a=
$("#productNameFilter").val(),b=$("#documentTypeFilter").val();$("#documentModalTable").DataTable().ajax.url("/signal/alertDocument/filterAlerts?productName="+a+"&documentType="+b).load()});$(".resetFilter").click(function(){var a=$("#documentModalTable").DataTable();g();a.ajax.url("/signal/alertDocument/getUnlinkedDocuments").load()})},columnDefs:[{targets:"_all",render:$.fn.dataTable.render.text()}]})},init_doc_list:function(c){return $("#alert-document-table").DataTable({language:{url:"../assets/i18n/dataTables_"+
userLocale+".json"},fnDrawCallback:function(){$(".document-update").unbind().click(function(){var a=$(this).parents("tr"),b=a.find("#comments").val();a.find("#documentType").val();a=a.find("#chronicleId").html();b={comment:b,chronicleId:a,alertId:alertId};$(this).closest("tr").find(".iconContainer .fa-check").addClass("fa-spin fa-circle-o-notch");$(this).closest("tr").find(".iconContainer .fa-check").removeClass("fa-check");$.ajax({url:"/signal/alertDocument/updateAlertDocument",type:"post",data:b,
error:function(){console.log("Error!!!!")},success:function(){"undefined"!=typeof signalId&&null!=signalId?f(signalId):d($("#alertId").val());$(this).closest("tr").find(".iconContainer .fa-cirlcle-o-notch").addClass("fa-check");$(this).closest("tr").find(".iconContainer .fa-cirlcle-o-notch").removeClass("fa-spin fa-circle-o-notch")}})});$(".document-unbind").unbind().click(function(){var a=$(this).parents("tr").find("#chronicleId").html(),b=null,b="undefined"!=typeof signalId&&null!=signalId?{chronicleId:a,
signalId:signalId}:{chronicleId:a,alertId:alertId};$.ajax({url:"/signal/alertDocument/unlinkDocument",type:"post",data:b,error:function(){console.log("Error!!!!")},success:function(){"undefined"!=typeof signalId&&null!=signalId?f(signalId):d($("#alertId").val())}})});$('input[name="comments"]').keydown(function(a){$(this).closest("tr").find(".iconContainer .fa-check").addClass("activated")})},ajax:{url:c,dataSrc:""},searching:!0,bLengthChange:!0,iDisplayLength:10,aLengthMenu:[[10,20,50,-1],[10,20,
50,"All"]],dom:"",aoColumns:[{mData:"chronicleId",mRender:function(a,b,e){return'<span id="chronicleId">'+e.chronicleId+"</span>"}},{mData:"documentType"},{mData:"documentLink"},{mData:"productName"},{mData:"startDate"},{mData:"documentStatus"},{mData:"author"},{mData:"statusDate"},{mData:"targetDate"},{mData:"comments",mRender:function(a,b,e){a="";"undefined"!=typeof e.comments&&null!=e.comments&&(a=e.comments);return'<input type="text" name="comments" id="comments" class="form-control" value="'+
a+'"/>'}},{mData:"",mRender:function(){return'<div class="iconContainer" style="width:45px;"><span class="document-update" style="cursor: pointer"><i class="fa fa-check"></i></span><span class="document-unbind closed"  style="cursor: pointer"><i class="fa fa-trash-o"></i></span></div>'}}],scrollX:!0,columnDefs:[{targets:"_all",render:$.fn.dataTable.render.text()}]})},select_doc:function(){var c=$('#documentModalTable input:checked[type="checkbox"]');return _.map(c,function(a){return $(a).attr("data-chronical-id")}).join(",")},
reset_filter:g}}();
$(document).ready(function(){var d=!1,f=function(){var b=$("#documentModal");signal.alertdoc_util.reset_filter();b.modal({});d?$("#documentModalTable").DataTable().ajax.url("/signal/alertDocument/getUnlinkedDocuments").load():(signal.alertdoc_util.init_doc_modal("/signal/alertDocument/getUnlinkedDocuments"),d=!0)},g=function(){var b=$("#documentModal");signal.alertdoc_util.reset_filter();b.modal({});d?$("#documentModalTable").DataTable().ajax.url("/signal/alertDocument/getUnlinkedsignalDocuments").load():(signal.alertdoc_util.init_doc_modal("/signal/alertDocument/getUnlinkedsignalDocuments"),
d=!0)},c=function(b,a){b=signal.alertdoc_util.select_doc();$.ajax({url:"/signal/alertDocument/addToAlert",type:"post",data:{chronicle_ids:b,alertId:alertId},error:function(){console.log("Error!!!!")},success:function(){$("#documentModal").modal("hide");$("#alert-document-table").DataTable().ajax.url("/signal/alertDocument/listByAlert?alertId="+alertId).load();signal.activities_utils.reload_activity_table()}})},a=function(){var b={chronicle_ids:signal.alertdoc_util.select_doc(),signalId:signalId};
$.ajax({url:"/signal/alertDocument/addToSignal",type:"post",data:b,error:function(){console.log("Error!!!!")},success:function(){$("#documentModal").modal("hide");$("#alert-document-table").DataTable().ajax.url("/signal/alertDocument/listBySignal?signalId="+signalId).load();signal.activities_utils.reload_activity_table()}})};$(".downloadReport").click(function(){var b;$(this).hasClass("pdf")?b=downloadSummaryReportPDFUrl:$(this).hasClass("xlsx")?b=downloadSummaryReportXLSXUrl:$(this).hasClass("word")&&
(b=downloadSummaryReportDocXUrl);if(b){var a={},c=$("#eventSelectionAssessment").val(),d=$("#productSelectionAssessment").val();a.dataSource=$("#dataSources").val();a.dateRange=$("#dateRange").val();a.productSelection=d;a.eventSelection=c;a["validatedSignal.id"]=$("#signalIdPartner").val();signal.utils.postUrl(b,a)}});"undefined"!=typeof signalId&&null!=signalId?(signal.alertdoc_util.init_doc_list("/signal/alertDocument/listBySignal?signalId="+signalId),$(".modal-add-btn").unbind().click(a),$("#show-doc-list-bt").unbind().click(g)):
(signal.alertdoc_util.init_doc_list("/signal/alertDocument/listByAlert?alertId="+alertId),$(".modal-add-btn").unbind().click(c),$("#show-doc-list-bt").unbind().click(f))});